function SettingsBarPreviewCtrl(_,$rootScope,$scope,$state,$stateParams,$timeout,$modal,UsersService,Settings,ProjectsService,PagesService,DOMService,Engine){function activate(){$scope.shareURL=getShareUrl(),$scope.params={isResponsive:Settings.isResponsive,isLogged:!UsersService.isAnonymous(),isDocument:ProjectsService.isDocument(),isUXTestDocument:ProjectsService.isUXTestDocument(),isOwner:ApplicationConfiguration.userData.is_owner,features:ApplicationConfiguration.project.features||{},includeSitemapComments:!Settings.disableComments&&!Settings.disableSitemap,isExport:Settings.isExport()}}function onClickHighlight(){Preview.highlightInteractive(Engine.getPage())}function onClickPlanUpgrade(event){event.preventDefault(),$modal.open({templateUrl:"/scripts/modules/core/views/planUpgrade/modal.view.html",controller:"PlanUpgradeController"})}function onResponsive(){var value=$scope.params.isResponsive;Settings.setResponsive(value),value&&PagesService.setPageResponsive(DOMService.getWindowWidth())}function onClickCopy(event){event.preventDefault(),$scope.isCopied=!0,$timeout(function(){$scope.isCopied=!1,$scope.params.shareOpen=!1},1e3)}function onShareSettingsChanged(){$scope.shareURL=getShareUrl()}function selectText(event){event.target.select()}function getShareUrl(){var idPage=$stateParams.pageId,idComment=$stateParams.commentId,url=window.location.origin+window.location.pathname+"#";return idPage&&(url+="/pages/"+idPage),$scope.params.includeSitemapComments&&idComment&&(url+="/comments/"+idComment),$scope.params.includeSitemapComments||(url+="?mode=cm"),url}$scope.params={},$scope.shareURL="",$scope.onClickHighlight=onClickHighlight,$scope.onClickPlanUpgrade=onClickPlanUpgrade,$scope.onResponsive=onResponsive,$scope.selectText=selectText,$scope.onClickCopy=onClickCopy,$scope.onShareSettingsChanged=onShareSettingsChanged,activate();var onStateChangeSuccess=$rootScope.$on("$stateChangeSuccess",function(){$scope.shareURL=getShareUrl()});$scope.$on("$destroy",function(){onStateChangeSuccess()})}!function(global){"use strict";var FormEvents={wrapperSelector:".preview-container",dispatchFormEvent:function(e,additionalData){if(LIVE_SHARE&&LIVE_SHARE.eventDispatcher)try{LIVE_SHARE.eventDispatcher.handleEvent(e,_.extend({selector:this.getElementUniqueSelector(e.target),time:+new Date},additionalData||{}))}catch(e){return void console.error(e)}},getElementUniqueSelector:function(el){var path=[];do{if(el.id){/^el[0-9]+\_/.test(el.id)?path.unshift("[id^=el"+this.getIdByElement(el)+"_]"):path.unshift("#"+el.id);break}path.unshift(el.nodeName.toLowerCase()+(el.className?"."+el.className.replace(" ","."):""))}while("html"!==el.nodeName.toLowerCase()&&(el=el.parentNode));return path.join(">")}};LIVE_SHARE&&(FormEvents=_.extend(LIVE_SHARE.FormEvents,FormEvents)),global.FormEvents=FormEvents}(window),function(global){"use strict";var Interactions=function(){return{ori_styles:{},active_node_id:"canvas-wrapper",els:{},events:[],scrolls:[],scrollable_els:null,scroll_offset_prev:0,scroll_offset:0,on_scroll_ref:null,loading_el:null,attachScrollEvent:function(){var i;if(this.scrollable_els&&this.scrollable_els instanceof Array){if(this.on_scroll_ref){for(i=0;i<this.scrollable_els.length;i++)this.scrollable_els[i].removeEventListener("scroll",this.on_scroll_ref),this.scrollable_els[i].scrollTop&&(this.scroll_offset=this.scrollable_els[i].scrollTop);this.on_scroll_ref=null}for(this.scroll_offset_prev=0,this.on_scroll_ref=this.onContentScrolled.bind(this),i=0;i<this.scrollable_els.length;i++)this.scrollable_els[i].addEventListener("scroll",this.on_scroll_ref)}},getLoadElement:function(){return this.loading_el||(this.loading_el=document.createElement("img"),this.loading_el.style.opacity=0),this.loading_el},onContentLoaded:function(loadEvents){_.forEach(loadEvents,function(event){"function"==typeof event&&event("load")})},onContentScrolled:function(e){this.scroll_offset_prev=this.scroll_offset,this.scroll_offset=0;for(var i=0;i<this.scrollable_els.length;i++)this.scroll_offset+=this.scrollable_els[i].scrollTop;this.scrolls.forEach(function(callback){"function"==typeof callback&&callback(e)})},getIdByElement:function(el){var id=null;return _.forEach(Preview.mElements.mIndex,function(value,key){if(value.mEl===el)return id=key,!1}),id},shouldBeFired:function(e){if("load"===e)return!0;var target_node_name=e.target.nodeName.toLowerCase();return!(e.keyCode&&["input","textarea","select"].indexOf(target_node_name)>-1)},handleEvent:function(e,processed){if("load"!==e&&"scroll"!==e.type){var id=this.getIdByElement(e.currentTarget);if(LIVE_SHARE&&LIVE_SHARE.eventDispatcher){var selector=id?"[id^=el"+id+"_]":"window";try{LIVE_SHARE.eventDispatcher.handleEvent(e,{selector:selector})}catch(e){return void console.error(e)}}var target_node_name=e.target.nodeName.toLowerCase(),notProcessedCallback=function(pValue){return!1===pValue};if(!e.keyCode||!(["input","textarea","select"].indexOf(target_node_name)>-1||processed.every(notProcessedCallback))){if("click"===e.type){if("label"===target_node_name)return;if("input"===target_node_name&&["checkbox","radio"].indexOf(e.target.getAttribute("type").toLowerCase())>-1)return}e.preventDefault()}}},getSetElRef:function(id){var node_id=Interactions.active_node_id;return"undefined"==typeof Interactions.els[node_id]&&(Interactions.els[node_id]={}),"object"!=typeof Interactions.els[node_id][id]&&(Interactions.els[node_id][id]=document.getElementById(node_id).querySelector("*[id^=el"+id+"_]"),Interactions.els[node_id][id].classList.contains("ElTooltip")?Interactions.els[node_id][id]=Interactions.els[node_id][id].parentNode:Interactions.els[node_id][id].classList.contains("ElTableContainer")&&(Interactions.els[node_id][id]=Interactions.els[node_id][id].querySelector(".ElTable"))),Interactions.els[node_id][id]},ifFireOneTimeScroll:function(id,action,offset,reverse){var return_value=0;return this.scroll_offset>=offset&&this.scroll_offset_prev<offset?return_value=1:this.scroll_offset<offset&&this.scroll_offset_prev>=offset&&(return_value=-1),reverse&&(return_value*=-1),return_value}}}();global.MD5=md5,global.Interactions=_.extend(Interactions,FormEvents)}(window),function(global){"use strict";var Preview=function(){var FADE_IN_DURATION=.5,FADE_OUT_DURATION=.5,HIGHLIGHT_DURATION=1.5,isHighlighted=!1,onScroll=function(e){for(var scrollTop=0,scrollLeft=0,i=0,l=Interactions.scrollable_els.length;i<l;i++)scrollTop+=Interactions.scrollable_els[i].scrollTop,scrollLeft+=Interactions.scrollable_els[i].scrollLeft;_.forEach(this.mFixedElems,function(fixed){fixed.style.top=scrollTop+parseInt(fixed.originalTop)+"px",fixed.style.left=scrollLeft+parseInt(fixed.originalLeft)+"px"}.bind(this))},parseLinks=function(hrefs){var pages;_.forEach(hrefs,function(href){pages=/\/([\d]+)c?d?m?$/g.exec(href.href),pages&&pages.length&&(href.onclick=function(pageId){return function(e){e.preventDefault(),Preview.gotoPage(pageId)}}(pages[1]))})},copyStyle=function(companion,interactive){var interactiveDomElement=interactive.view.domElement,interactiveTransform=getInteractiveDomElementTransform(interactive),border=parseInt(interactiveDomElement.style.borderWidth),width="canvas"===interactive.id?interactiveDomElement.style.width:interactive.width+"px",height="canvas"===interactive.id?interactiveDomElement.style.height:interactive.height+"px";companion.style.transform=interactiveTransform,companion.style.transformOrigin="inherit",companion.style.width=width,companion.style.height=height,companion.style.position="absolute",border&&(companion.style.width=parseInt(interactiveDomElement.style.width)+2*border+"px",companion.style.height=parseInt(interactiveDomElement.style.height)+2*border+"px")},getInteractiveDomElementTransform=function(interactive){var interactiveDomElement=interactive.view.domElement,interactiveDomElementTransform=document.defaultView.getComputedStyle(interactiveDomElement).transform;return(interactive.parent&&interactive.parent.isMultistate()||!interactiveDomElementTransform||"none"===interactiveDomElementTransform)&&(interactiveDomElementTransform="translate("+interactive.x+"px, "+interactive.y+"px) rotate("+interactive.angle+"deg)"),interactiveDomElementTransform},animate=function(container,companion){TweenLite.to(companion,FADE_IN_DURATION,{className:"+=visible-highlighted"}),TweenLite.to(companion,FADE_OUT_DURATION,{className:"-=visible-highlighted",delay:HIGHLIGHT_DURATION,onComplete:removeHighlight.bind(this,container,companion)})},removeHighlight=function(container,companion){isHighlighted=!1,container.removeChild(companion)},getElementsWithInteractions=function(elements,elementsWithInteractions){var interactives=elementsWithInteractions||[];return _.each(elements,function(element){_.isEmpty(element.actions)||interactives.push(element),_.isEmpty(element.children)||getElementsWithInteractions(element.children,interactives)}),interactives},highlight=function(page){if(!isHighlighted){var companion,interactives=getElementsWithInteractions([page.getCanvas()]),canvasNode=document.querySelector(".ng-canvas");isHighlighted=!0,_.forEach(interactives,function(interactive){companion=document.createElement("DIV"),companion.className="interactive highlighted companion",copyStyle(companion,interactive),animate(canvasNode,companion),canvasNode.appendChild(companion)})}},clearTimeouts=function(){if(Interactions.timeouts)for(;Interactions.timeouts.length;)clearTimeout(Interactions.timeouts.pop())},initFixed=function(){if(this.mFixedElems=document.querySelectorAll(".FixedPos"),_.forEach(this.mFixedElems,function(fixed){fixed.originalTop=fixed.style.top,fixed.originalLeft=fixed.style.left}),!this.onScroll&&Interactions.scrollable_els){this.onScroll=onScroll.bind(this);for(var i=0,l=Interactions.scrollable_els.length;i<l;i++)Interactions.scrollable_els[i].addEventListener("scroll",this.onScroll)}},parseNavigationHrefs=function(){parseLinks(document.querySelector("section.preview-container").querySelectorAll("a"))},parsePageLinks=function(){var arr,hrefs=document.querySelectorAll('[onclick^="location"]');_.forEach(hrefs,function(href){"function"==typeof href.onclick&&(arr=/\/([\d]+)c?d?m?\'/g.exec(href.onclick.toString()),arr&&arr.length>1&&(href.onclick=function(pageId){return function(e){e.preventDefault(),Preview.gotoPage(pageId)}}(arr[1])))})},initDocument=function(container,cb){if("W"!==ApplicationConfiguration.project.type){_.forEach(container.querySelectorAll("textarea, input"),function(el){el.setAttribute("readonly","readonly"),el.removeAttribute("placeholder")});var margin;_.forEach(container.querySelectorAll("textarea"),function(el){margin=el.classList.contains("type-text")||"quote"===el.id?15:el.classList.contains("block")?13:0,autoGrow(el,{margin:margin})})}},autoGrow=function(el,options){options.minHeight=0,options.maxHeight=0;var style=window.getComputedStyle(el),dummy=document.createElement("div");dummy.style.overflowX="hidden",dummy.style.position="absolute",dummy.style.top=0,dummy.style.left="-9999px",dummy.style.whiteSpace="pre-wrap",dummy.style.fontSize=style.fontSize,dummy.style.fontFamily=style.fontFamily,dummy.style.fontStyle=style.fontStyle,dummy.style.fontVariant=style.fontVariant,dummy.style.fontWeight=style.fontWeight,dummy.style.width=style.width,dummy.style.lineHeight=style.lineHeight,dummy.style.padding=style.padding,document.body.appendChild(dummy);var html=el.value.replace(/\n|\r\n/g,"<br>X")+"X";if(dummy&&dummy.innerHTML.toLowerCase()!==html.toLowerCase()){dummy.innerHTML=html;var triggerHeight=dummy.getBoundingClientRect().height+options.margin,newHeight=Math.max(options.minHeight,triggerHeight);options.maxHeight&&newHeight>options.maxHeight&&(newHeight=options.maxHeight),el.clientHeight!==newHeight&&(el.style.height=newHeight+"px")}};return{mElements:new Preview_Elements,mFixedElems:null,onScroll:null,highlightInteractive:function(page){highlight(page)},onLoadPage:function(container,cb){initDocument(container,cb),initFixed.call(this),parseNavigationHrefs(),parsePageLinks()},onChangePage:function(){clearTimeouts();var i;if(Interactions.loading_el=null,this.onScroll&&Interactions.scrollable_els){for(i=0;i<Interactions.scrollable_els.length;i++)Interactions.scrollable_els[i].removeEventListener("scroll",this.onScroll);this.onScroll=null}if(Interactions.scrolls)for(;Interactions.scrolls.length;)for(i=0;i<Interactions.scrollable_els.length;i++)Interactions.scrollable_els[i].removeEventListener("scroll",Interactions.scrolls.pop())},gotoPage:function(pageUrl){if(pageUrl.match(/^http/))window.location=pageUrl;else{var pageId=parseInt(pageUrl.replace(/.*\/(\d+)c?d?m?$/,"$1"));angular.element(document.getElementById("page-controller")).scope().gotoPage(pageId)}}}}();global.Preview=Preview}(window),function(global){"use strict";global.SocketServiceHelper=function(socketUrl,$rootScope){if("undefined"==typeof io)return{on:angular.noop,emit:angular.noop};var socket=io(socketUrl);return{on:function(eventName,callback){socket.on(eventName,function(){var args=arguments;$rootScope.$apply(function(){"function"==typeof callback&&callback.apply(socket,args)})})},emit:function(eventName,data,callback){socket.emit(eventName,data,function(){var args=arguments;$rootScope.$apply(function(){"function"==typeof callback&&callback.apply(socket,args)})})}}}}(window),function(global){"use strict";var configuration=function(){var applicationModuleName="uxpin-preview",applicationModuleVendorDependencies=["restangular","ui.router","pascalprecht.translate","LocalStorageModule","ngClipboard","custom.ui.bootstrap","youtube-embed","ngSanitize","angulartics","angulartics.google.analytics","angulartics.kissmetrics","ngCookies","cfp.hotkeys"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule,project:{hash:0},extension:{id:"bgibmbhbcdfckbcbdkihlclfildbaehc",isInstalled:!1}}}();global.ApplicationConfiguration=_.defaults(global.ApplicationConfiguration||{},configuration),"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage(global.ApplicationConfiguration.extension.id,global.ApplicationConfiguration,function(response){response&&(global.ApplicationConfiguration.extension.isInstalled=!0)})}(window),function(angular){"use strict";angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])})}(window.angular),ApplicationConfiguration.registerModule("core"),function(){"use strict";function config($stateProvider,$urlRouterProvider){"W"===ApplicationConfiguration.project.type?$urlRouterProvider.otherwise("/pages").when("/pages","/pages/{pageId}").when("/pages/{pageId}/usability-test/","/pages/{pageId}/usability-test/1"):$urlRouterProvider.otherwise("/documents").when("/documents","/documents/{documentId}");var isHostSession=function($state,$stateParams,LiveShareService){LiveShareService.isSession()&&!LiveShareService.isHostSession()&&$state.go($state.current.name,$stateParams)};$stateProvider.state("home",{url:"","abstract":!0,views:{"":{templateUrl:"/scripts/modules/core/views/home.view.html",controller:function($scope){}},commentsFilter:{templateUrl:"/scripts/modules/core/views/commentsFilter.view.html",controller:"CommentsFilterCtrl",controllerAs:"vm"},comments:{templateUrl:"/scripts/modules/core/views/comments-notes.view.html",controller:"CommentsNotesController"},sitemap:{templateUrl:"/scripts/modules/core/views/sidebar.view.html",controller:"SidebarController"},nav:{templateUrl:"/scripts/modules/core/views/nav.view.html",controller:"NavController"},canvas:{templateUrl:"/scripts/modules/core/views/canvas.view.html",controller:"CanvasController"},breadcrumbs:{templateUrl:"/scripts/modules/core/views/breadcrumbs.view.html",controller:"BreadcrumbsController"},settings:{templateUrl:"/scripts/modules/core/views/settingsBar/settings.view.html",controller:"SettingsBarController"}},resolve:{pages:function($q,PagesService,ProjectsService){var d=$q.defer();return ProjectsService.isDocument()?d.resolve(null):PagesService.getPages().then(function(pages){d.resolve(pages)},function(error){d.reject(error)}),d.promise},breakpoints:function($q,BreakpointsService,ProjectsService){var d=$q.defer();return ProjectsService.isDocument()?d.resolve(null):BreakpointsService.getBreakpoints().then(function(breakpoints){d.resolve(breakpoints)},function(error){d.reject(error)}),d.promise},collaborators:function($q,UsersService){var d=$q.defer();return UsersService.getCollaborators().then(function(collaborators){d.resolve(collaborators)},function(error){d.reject(error)}),d.promise},documents:function($q,DocumentsService,ProjectsService){var d=$q.defer();return ProjectsService.isDocument()?DocumentsService.getDocuments().then(function(documents){d.resolve(documents)},function(error){d.reject(error)}):d.resolve(null),d.promise},isMobile:function(){return"mobile"===new UAParser(navigator.userAgent).getDevice().type}}}).state("home.page",{url:"/pages/{pageId}?mode",template:'<div id="page-controller" ui-view></div>',controller:"PageController"}).state("home.page.nosidebar",{url:"/nosidebar"}).state("home.page.panel",{url:"/panel"}).state("home.page.panel.nosidebar",{url:"/nosidebar"}).state("home.page.sitemap",{url:"/sitemap",resolve:{isHostSession:isHostSession}}).state("home.page.sitemap.nosidebar",{url:"/nosidebar"}).state("home.page.comment",{url:"/comments/{commentId}",controller:"CommentController"}).state("home.page.comment.nosidebar",{url:"/nosidebar"}).state("home.page.comment.panel",{url:"/panel"}).state("home.page.comment.panel.nosidebar",{url:"/nosidebar"}).state("home.page.comment.sitemap",{url:"/sitemap",resolve:{isHostSession:isHostSession}}).state("home.page.comment.sitemap.nosidebar",{url:"/nosidebar",resolve:{isHostSession:isHostSession}}).state("home.page.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.add-comment.nosidebar",{url:"/nosidebar"}).state("home.page.panel.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.panel.add-comment.nosidebar",{url:"/nosidebar"}).state("home.page.sitemap.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.sitemap.add-comment.nosidebar",{url:"/nosidebar",resolve:{isHostSession:isHostSession}}).state("home.page.comment.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.comment.panel.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.comment.panel.add-comment.nosidebar",{url:"/nosidebar",resolve:{isHostSession:isHostSession}}).state("home.page.comment.sitemap.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.comment.sitemap.add-comment.nosidebar",{url:"/nosidebar",resolve:{isHostSession:isHostSession}}).state("home.document",{url:"/documents/{documentId}?mode",template:'<div id="document-controller" ui-view></div>',controller:"DocumentController"}).state("home.document.panel",{url:"/panel"}).state("home.document.comment",{url:"/comments/{commentId}",controller:"CommentController"}).state("home.document.comment.panel",{url:"/panel"}).state("home.document.add-comment",{url:"/add-comment"}).state("home.document.panel.add-comment",{url:"/add-comment"}).state("home.document.comment.add-comment",{url:"/add-comment"}).state("home.document.comment.panel.add-comment",{url:"/add-comment"});var isAuthenticated=function(UsersService,$location){if(UsersService.me.is_anonymous)return $location.path("/")};$stateProvider.state("home.page.live-share-configuration",{url:"/live-presentation-configuration",controller:function($modal,$state,$stateParams){var dialog=$modal.open({templateUrl:"/scripts/modules/core/views/liveShare/configuration.view.html",controller:"LiveShareConfigurationController"});dialog.result["finally"](function(){$state.go("home.page",$stateParams)})},resolve:{isAuthenticated:isAuthenticated}}).state("home.page.live-share-start",{url:"/live-presentation-start?options&type",templateUrl:"/scripts/modules/core/views/liveShare/initialize.view.html",controller:"LiveShareInitializeController",resolve:{isAuthenticated:isAuthenticated}}).state("home.page.live-share-join",{url:"/live-presentation-join/{sessionId}?type",templateUrl:"/scripts/modules/core/views/liveShare/initialize.view.html",controller:"LiveShareInitializeController"}).state("home.page.live-share-finish",{url:"/live-presentation-finish/{type}/",templateUrl:"/scripts/modules/core/views/liveShare/finish.view.html",controller:"LiveShareFinishController"}).state("home.page.usability-test",{url:"/usability-test/{step:[1-5]{1}}",controller:"UsabilityTestController",resolve:{isAuthenticated:isAuthenticated}})}angular.module("core").config(config),config.$inject=["$stateProvider","$urlRouterProvider"]}(),angular.module("core").config(["$translateProvider",function($translateProvider){"use strict";$translateProvider.preferredLanguage("en"),$translateProvider.translations("en",{BTN_REPLY:"Reply",BTN_RESOLVE:"Resolve",BTN_UNRESOLVE:"Unresolve",BTN_DELETE:"Delete",BTN_ADD_COMMENT:"Add comment",BTN_NOTIFY:"Notify those people",BTN_ADD_USER:"Notify also",BTN_SEND_NOTIFICATION:"Send notification",BTN_UNDO:"Undo",LBL_COMMENTS:"Comments",LBL_NOTES:"Notes",LBL_SHOW_RESOLVED:"Show resolved comments",LBL_CURRENT_PAGE:"Current page only",LBL_SEARCH:"Search",LBL_RESOLVED:"Resolved",INFO_DELETED:"You've deleted this comment.",INFO_NO_COMMENTS:"There are no comments yet.",INFO_ADD_FIRST:"Add first comment",INFO_ENTER_COMMENT_MODE:"Enter comment mode",INFO_ADD_FIRST_NOTE:"Add your first note",INFO_NO_NOTES:"This is your private notepad.\nNo one can see it.",INFO_SEARCH:"Search in comments",INFO_SEARCH_SITEMAP:"Search for page",INFO_FEEDBACK:"Put your feedback",TIP_COMMENT_MODE:"Comment mode",TIP_ADD_NEW_COMMENT:"Add new comment",TIP_COLLABORATION:"Collaboration",TIP_COMMENTS_NOTES:"Comments / Notes",TIP_SITEMAP:"Sitemap",TIP_LIVE_SHARE:"Start Live Presentation",TIP_USABILITY_TEST:"Create usability test",TIP_RESOLVE:"Resolve",TIP_DELETE:"Delete",TIP_CANT_DELETE:"Only owner can delete his comments",TIP_FINISH_SESSION:"Finish session",LOVE_IT:"Love it",DONT_LOVE_IT:"Love it not",RESOLVED_BY:"Resolved by {{name}}",LS_OPTION_CAN_COMMENT:"Viewers can comment during session",LS_OPTION_SHOW_CURSOR:"Show viewers' cursors",LS_OPTION_FOLLOW_CURSOR:"Viewers always follow my cursor",LS_OPTION_DISABLE_VOICE:"Disable voice calls",LS_SESSION_QUIT:"You left {{projectName}} session. Redirecting to preview...",LS_SESSION_BANNED:"You've been banned from {{projectName}}.",LS_SESSION_OVER:"{{projectName}} session is over.",LS_SESSION_404:"No session found.",LS_USERS:"Live Presentation users",LS_FOLLOW_CURSOR:"Follow cursor",LS_SETTINGS:"Live Presentation settings",LS_SESSION_SETTINGS:"Session settings",LS_LINK_TO_SESSION:"Link to session",LS_LINK_HAS_BEEN_COPIED:"Link has been copied to your clipboard!",LS_TOGGLE_MUTE:"Toggle mute",LS_COPY:"Copy",LS_LEAVE_SESSION:"Leave session",LS_NAME_SHARING:"Live Presentation session",LS_NAME_TESTING:"usability test",LS_BACK_TO_PREVIEW:"Back to preview",UT_INTRODUCTION_TEXT:"Hello {Name of the participant}, thank you for coming. My name is {your name} and I’m a researcher for {name of the product} – I’m going to walk you through the session today.\n\nBefore we’ll start I have some information for you.\n\nWe’re currently testing {name of the product} to learn as much as we can about the way people use it. Every product is intended to work in a certain way by its creators, but as you know – the reality might be quite different. The goal of this research is to get us as close to the reality as possible.\n\nThe session will take about an hour.\n\nPlease remember, during the next hour, that we’re testing {name of the product} not you. Don’t worry at all about mistakes. If they happen, it’s the fault of the product. Finding about it is absolutely fantastic and gets us closer to creating a great product.\n\nDuring the whole test, please try to think out loud. Share anything that’s in your head. Tell me what you are looking at on the screen, what your thoughts are, what you like and what don’t you like, et cetera. We want to learn about your honest reactions to {name of the product}.\n\nIf you have any doubts during the test, feel free to ask me any questions. However, please remember that I might not be able to answer them during the test. We want to learn about your experience with {name of the product}, so I can’t guide you. I’ll be glad to answer all your questions after the test.\n\nWith your permission, we’re going to record the session. We’ll record your voice, face and actions on the screen – that will give us the full picture of the session for further analysis. We’re not going to share these recordings outside of the team directly working on {name of the product}.\n\nIf you don’t mind, I’d like to ask you to sign this permission form. It simply states that you give us the permission to record the session and that we’re going to secure this data and make it available only to the team working on {name of the product}.\n\nAlso, I hope you don’t mind, but I’m going to take notes. It helps me with analyzing the session.",UT_OPTION_CAN_CLOSE_TASK:"Participants can close tasks themselves",UT_OPTION_SEE_SITEMAP:"Participants can see sitemap",UT_THANKS_FOR_CONTRIBUTION:"This session is over, thank you for your contribution.",UT_SETTINGS:"Usability test settings",UT_USERS:"Usability test users",UM_CLOSE_MOVIE:"Close movie",UM_MODAL_HEADER:"Show your design,\nshare your screen and allow others to follow your actions!",UM_MODAL_TEXT:"With Live Presentation you'll be able to create an outstanding real-time presentation for your team. By means of voice calls, collaboration will be smooth and easy.",UM_CLOSE_MODAL:"Close modal",UM_HOW_IT_WORKS:"Show me how it works",UM_UPGRADE_NOW:"Upgrade now!",UM_PRO_PLUS_TEXT:"Live Presentation is available in Pro+ Plan.",UM_PRO_PLUS:"Pro+"})}]),angular.module("core").config(["localStorageServiceProvider",function(localStorageServiceProvider){"use strict";localStorageServiceProvider.setPrefix("Preview"),localStorageServiceProvider.setStorageCookieDomain(ApplicationConfiguration.cookieDomain)}]),angular.module("core").config(["ngClipProvider",function(ngClipProvider){"use strict";ngClipProvider.setPath("/node_modules/zeroclipboard/dist/ZeroClipboard.swf")}]),angular.module("core").config(["RestangularProvider",function(RestangularProvider){"use strict";RestangularProvider.setDefaultHttpFields({timeout:2e4})}]),angular.module("core").controller("UsabilityTestController",["$rootScope","$scope","$state","$stateParams","$modal","UsabilityTestService","ChromeExtensionService",function($rootScope,$scope,$state,$stateParams,$modal,UsabilityTestService,ChromeExtensionService){"use strict";var onStateChangeSuccess,openWizard=function(){var dialog=$modal.open({controller:"UsabilityTestWizardController",templateUrl:"/scripts/modules/core/views/usabilityTest/wizard.view.html",keyboard:!1});UsabilityTestService.isWizardOpen=!0,dialog.result["finally"](function(){$state.includes("**.usability-test.**")&&$state.go("home.page",{pageId:$stateParams.pageId}),UsabilityTestService.isWizardOpen=!1}),onStateChangeSuccess=$rootScope.$on("$stateChangeSuccess",function(e,toState,toParams){toParams.step||dialog.close()})},openChromeExtensionPromoModal=function(){$modal.open({controller:"ChromeExtensionDownloadController",templateUrl:"/scripts/modules/core/views/usabilityTest/chromeExtensionDownload.view.html"});$state.go("home.page",{pageId:$stateParams.pageId})};UsabilityTestService.isWizardOpen||(ChromeExtensionService.isInstalled()?openWizard():openChromeExtensionPromoModal()),$scope.$on("destroy",function(){"function"==typeof onStateChangeSuccess&&onStateChangeSuccess()})}]),angular.module("core").controller("BreadcrumbsController",["$rootScope","$scope","$sce","PagesService","BreakpointsService","LiveSessionInstanceService",function($rootScope,$scope,$sce,PagesService,BreakpointsService,LiveSessionInstanceService){"use strict";var LiveSessionInstance=LiveSessionInstanceService.get();$scope.breadcrumbs=[],$scope.breakpoint=null;var getBreadcrumbs=function(){var id=PagesService.currentPageId,breadcrumbs=[];do breadcrumbs.unshift(getPageName(id)),id=PagesService.pagesMap[id].parent;while(id);return breadcrumbs},getPageName=function(id){return PagesService.pagesMap[id].name},getBreakpointName=function(id){return $sce.trustAsHtml(BreakpointsService.breakpointsMap[PagesService.currentBreakpointId].name)};LiveSessionInstance.isSession()&&(LiveSessionInstance.getType()===LiveShare.enums.SESSION_TYPES.TESTING&&LiveSessionInstance.isHostSession()||!LiveSessionInstance.isHostSession())&&($scope.breadcrumbs=getBreadcrumbs(),$scope.breakpoint=getBreakpointName()),LiveSessionInstance.registerObserverCallback("finish",function(){$scope.breadcrumbs=[],$scope.breakpoint=null});$rootScope.$on(PreviewEnums.ON_CONTENT_LOADED,function(e,id){$scope.breadcrumbs=getBreadcrumbs(),$scope.breakpoint=getBreakpointName()})}]),angular.module("core").controller("CanvasController",["$rootScope","$scope","$state","$timeout","$q","PagesService","DocumentsService","CommentsService","CommentsFilter","BreakpointsService","ProjectsService","Settings","animate","socket","editorSocket","UsersService","LiveSessionInstanceService","UsabilityTestService","LiveShareService","AnalyticsService","Engine",function($rootScope,$scope,$state,$timeout,$q,PagesService,DocumentsService,CommentsService,CommentsFilter,BreakpointsService,ProjectsService,Settings,animate,socket,editorSocket,UsersService,LiveSessionInstanceService,UsabilityTestService,LiveShareService,AnalyticsService,Engine){"use strict";$scope.addingComment=!1,$scope.commentMode=!1,$scope.isLoading=!1,$scope.dimensions=null,$scope.overflow=null,$scope.onClick=null,$scope.clickX=0,$scope.clickY=0,$scope.list={},$scope.isDocument=ProjectsService.isDocument(),$scope.isUXTestDocument=ProjectsService.isUXTestDocument();var container=null,containerPadded=null,content=null,containerDimensions={width:0,height:0,paddingLeft:0,paddingRight:0},contentDimensions={width:0,height:0},contentCropping={x:!1,y:!1};$scope.$on("$destroy",function(){onAddComment(),onSelectComment(),onStateChangeSuccess(),onChangePage(),onComments(),onShowCommentsResolvedChanged(),onCommentsFilterChange(),onCommentTypeUpdate(),onModeChanged()}),$scope.onContentLoaded=function(){var LiveSessionService=LiveSessionInstanceService.get();LiveSessionService&&LiveSessionService.isSession()?LiveSessionService.executeEventsQueue().then(function(){onContentLoaded(),$scope.$apply()})["catch"](function(e){onContentLoaded(),$scope.$apply()}):onContentLoaded()},$scope.onAddCommentClick=function(e){if(UsersService.isAnonymous()&&!UsersService.isAnonymousNameSet())return void $rootScope.$emit(PreviewEnums.ANONYMOUS_ADD_COMMENT);$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null);var bb=content.getBoundingClientRect();$scope.clickX=Math.round(e.clientX-PreviewEnums.PIN_RADIUS-bb.left),$scope.clickY=Math.round(e.clientY-PreviewEnums.PIN_RADIUS-bb.top),addComment(!0)};var onContentLoaded=function(){$rootScope.$emit(PreviewEnums.LOADING,!1),$rootScope.$emit(PreviewEnums.ON_CONTENT_LOADED),Preview.onLoadPage(document.querySelector(".canvas-content"),ProjectsService.isDocument()?function(rect){$scope.$apply(function(){contentDimensions.height=rect.height,$scope.dimensions.height=contentDimensions.height+"px"})}:null),$timeout(function(){$scope.isLoading=!1},0),AnalyticsService.finishPageSwitchTrack(PagesService.currentPageId)},onAddComment=$rootScope.$on(PreviewEnums.ADD_COMMENT,function(e,id){
addComment(!1)}),onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id,type){addComment(!1),scrollToComment(id,type,.7)}),onStateChangeSuccess=$scope.$on("$stateChangeSuccess",function(e,toState,toParams,fromState,fromParams){toState.name.indexOf("add-comment")>=0&&fromState.name.indexOf("add-comment")<0?$scope.commentMode=!0:toState.name.indexOf("add-comment")<0&&fromState.name.indexOf("add-comment")>=0&&($scope.commentMode=!1,addComment(!1))}),onChangePage=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(e){$scope.isDocument=ProjectsService.isDocument(),AnalyticsService.startPageSwitchTrack(PagesService.currentPageId),addComment(!1),update(),ProjectsService.isDocument()?getContent().then(function(){scrollToCommentDelayed()}):($scope.isLoading=!0,$rootScope.$emit(PreviewEnums.LOADING,!0),loadPage(PagesService.currentPageId),scrollToCommentDelayed()),Preview.onChangePage()}),scrollToCommentDelayed=function(){container.scrollLeft=0,container.scrollTop=0,$timeout(function(){scrollToComment(CommentsService.selectedCommentId,"panel",0)},0)},updateCurrentPage=function(){PagesService.getCanvasData(PagesService.currentPageId).then(function(data){var page=Engine.getPage();$timeout(function(){var width=PagesService.currentPageProperties.size.width,height=PagesService.currentPageProperties.size.height;Engine.updateOffset(),page.clear(),page.load(data,function(){page.on(window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,function(){setTimeout(function(){disableContextMenuForInteractives(),setNgCanvasDimensions(page.ElementsManager.elements,height,width)},0)})}())})})},loadPage=function(pageId){PagesService.getCanvasData(pageId).then(function(data){var page=Engine.getPage()||Engine.initPage(container,content);data.pageId=parseInt(pageId),$timeout(function(){if(data.pageId!==page.pageId){var width=PagesService.currentPageProperties.size.width,height=PagesService.currentPageProperties.size.height;Engine.updateOffset(),page.clear(),page.load(data,function(){page.on(window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,function(){setTimeout(function(){disableContextMenuForInteractives(),setNgCanvasDimensions(page.ElementsManager.elements,height,width)},0)})}()),$scope.dimensions={width:width+"px",height:height+"px"},$scope.overflow={"overflow-x":PagesService.currentPageProperties.size.scrollx?"auto":"hidden","overflow-y":PagesService.currentPageProperties.size.scrolly?"auto":"hidden"},$scope.onContentLoaded()}},0)})},onComments=$scope.$watchCollection("comments",function(value){value&&update()}),addComment=function(value){$scope.addingComment=value,$rootScope.$emit(PreviewEnums.ADDING_COMMENT,$scope.addingComment)},getContent=function(silent){var content,d=$q.defer(),isDocument=ProjectsService.isDocument();return isDocument?($scope.isLoading=!0,silent||$rootScope.$emit(PreviewEnums.LOADING,!0),content=DocumentsService.getDocument(DocumentsService.currentDocumentId),content.then(function(content){contentDimensions.width=content.size.width,contentDimensions.height=content.size.height,contentCropping=PagesService.getContentCropping(),$scope.contentPath=content.content+"?"+(new Date).getTime(),$scope.dimensions={width:contentDimensions.width+"px",height:contentDimensions.height+"px"},$scope.overflow={"overflow-x":contentCropping.x?"auto":"hidden","overflow-y":contentCropping.y?"auto":"hidden"},$scope.isUXTestDocument&&($scope.dimensions=null),d.resolve(content)}),d.promise):(d.resolve(),d.promise)},canScrollToComment=function(id,type){var comment=CommentsService.commentsMap[id];return id&&"panel"===type&&comment.id_page===PagesService.currentPageId&&(Settings.showResolvedComments||!comment.resolved.is)},scrollToComment=function(id,type,delay){if(canScrollToComment(id,type)){computeSize();var commentPosition=CommentsService.commentsMap[id].position,left=commentPosition.x-containerDimensions.width/2,top=commentPosition.y-containerDimensions.height/2,contentDimensionsWidth=contentDimensions.width+containerDimensions.paddingLeft+containerDimensions.paddingRight;left<0?left=0:left>contentDimensionsWidth-containerDimensions.width&&(left=contentDimensionsWidth-containerDimensions.width),top<0?top=0:top>contentDimensions.height-containerDimensions.height&&(top=contentDimensions.height-containerDimensions.height),delay>0?animate(container,delay,{ease:"easeInOutPower2",scrollLeft:left,scrollTop:top}):(container.scrollLeft=left,container.scrollTop=top)}},computeSize=function(){var style;style=window.getComputedStyle(container),containerDimensions.width=parseInt(style.width),containerDimensions.height=parseInt(style.height),style=window.getComputedStyle(containerPadded),containerDimensions.paddingLeft=parseInt(style.paddingLeft),containerDimensions.paddingRight=parseInt(style.paddingRight)},canDisplayComment=function(comment){return!comment._parent_comment&&comment.id_page===PagesService.currentPageId&&!Settings.disableComments&&(Settings.showResolvedComments||!comment.resolved.is)},update=function(){$scope.list=[],_.forEach($scope.comments,function(comment){CommentsFilter.canDisplayComment(comment)&&canDisplayComment(comment)&&$scope.list.push(comment)})},onProjectUpdate=function(data){var dataObject;try{dataObject="string"==typeof data?JSON.parse(data):data}catch(e){}var LiveSessionInstance=LiveSessionInstanceService.get();LiveSessionInstance&&LiveSessionInstance.isSession()||Settings.disableLiveChanges||dataObject&&PagesService.currentPageId===parseInt(dataObject.id_page)&&updateCurrentPage()},disableContextMenuForInteractives=($scope.$on("$viewContentLoaded",function(){return ProjectsService.isDocument()?void getContent():void loadPage(PagesService.currentPageId)}),function(){for(var classNameToHandle=".interactive",elementList=document.querySelectorAll(classNameToHandle),i=0,len=elementList.length;i<len;i++)elementList[i].addEventListener("contextmenu",function(e){e.preventDefault()},!1)}),setNgCanvasDimensions=function(elements,canvasContainerHeight,canvasContainerWidth){var ngCanvas=document.querySelector(".ng-canvas"),maxVerticalElementPoint=getMaxVerticalElementPoint(elements),maxHorizontalElementPoint=getMaxHorizontalElementPoint(elements),height=maxVerticalElementPoint>canvasContainerHeight?maxVerticalElementPoint:canvasContainerHeight,width=maxHorizontalElementPoint>canvasContainerWidth?maxHorizontalElementPoint:canvasContainerWidth;ngCanvas.style.height=height+"px",ngCanvas.style.width=width+"px",setScrollableContainer(height)},setScrollableContainer=function(height){return height===containerPadded.offsetHeight?Engine.setScrollableContainer(container):void Engine.setScrollableContainer(document.querySelector(".ng-canvas-container"))},getMaxVerticalElementPoint=function(elements){return _.max(_.map(elements,function(element){return parseFloat(element.y)+parseFloat(element.height)}))},getMaxHorizontalElementPoint=function(elements){return _.max(_.map(elements,function(element){return parseFloat(element.x)+parseFloat(element.width)}))},onShowCommentsResolvedChanged=$rootScope.$on(PreviewEnums.ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED,update.bind(this)),onCommentTypeUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,update.bind(this)),onCommentsFilterChange=$rootScope.$on(PreviewEnums.ON_COMMENTS_FILTER_CHANGE,update.bind(this)),onModeChanged=$rootScope.$on(PreviewEnums.ON_MODE_CHANGED,update.bind(this));container=document.querySelector("main > section.scrolled-container > section.scrolled-content"),containerPadded=document.querySelector("main > section.scrolled-container > section.scrolled-content > section.canvas-container"),content=document.querySelector("main > section.scrolled-container > section.scrolled-content > section.canvas-container > section.preview-container"),CommentsService.getComments().then(function(comments){getContent().then(function(){$scope.comments=comments,$timeout(function(){scrollToComment(CommentsService.selectedCommentId,"panel",0)},0)})}),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,function(){$scope.isLiveSession=!0}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,function(){$scope.isLiveSession=!0,$scope.isUTSession=!0}),editorSocket.on(PreviewEnums.SOCKET.ON_CHANGE_PROPERTIES,onProjectUpdate.bind(this)),editorSocket.on(PreviewEnums.SOCKET.ON_DELETE_COMPONENT,onProjectUpdate.bind(this)),socket.on(PreviewEnums.SOCKET.ON_COMMENT_CREATE,function(data){CommentsService.applyAddComment(data)}),socket.on(PreviewEnums.SOCKET.ON_COMMENT_UPDATE,function(data){CommentsService.applyUpdateComment(data._id,data)}),socket.on(PreviewEnums.SOCKET.ON_COMMENT_TYPE_UPDATE,function(data){CommentsService.applyUpdateCommentType(data._id,data.type)}),socket.on(PreviewEnums.SOCKET.ON_COMMENT_CONTENT_UPDATE,function(data){CommentsService.applyUpdateCommentContent(data._id,data.comment)}),socket.on(PreviewEnums.SOCKET.ON_COMMENT_DELETE,function(data){CommentsService.applyDeleteComment(data)})}]),angular.module("core").controller("CommentController",["$rootScope","$scope","$state","$stateParams","CommentsService",function($rootScope,$scope,$state,$stateParams,CommentsService){"use strict";var selectComment=function(commentId,redirect){CommentsService.selectedCommentId=commentId,$rootScope.$emit(PreviewEnums.SELECT_COMMENT,CommentsService.selectedCommentId,null,redirect),commentId&&redirect&&CommentsService.groupToOpen.push(commentId)},onStateChangeSuccess=$rootScope.$on("$stateChangeSuccess",function(){$state.includes("**.comment.**")||CommentsService.selectedCommentId&&selectComment(null)});$scope.$on("$destroy",function(){onStateChangeSuccess()}),$stateParams.commentId&&CommentsService.selectedCommentId!==$stateParams.commentId&&CommentsService.getComments().then(function(){var id=CommentsService.getRedirectId($stateParams.commentId);selectComment(id,id!==$stateParams.commentId)})}]),angular.module("core").controller("CommentsNotesController",["$rootScope","$scope","$state","$timeout","$sce","CommentsService","CommentsFilter","PagesService","BreakpointsService","ProjectsService","Settings","localStorageService","animate",function($rootScope,$scope,$state,$timeout,$sce,CommentsService,CommentsFilter,PagesService,BreakpointsService,ProjectsService,Settings,localStorageService,animate){"use strict";$scope.showResolved=Settings.showResolvedComments,$scope.isDocument=ProjectsService.isDocument(),$scope.showCurrentPageOnly=Settings.showCurrentPageOnly||$scope.isDocument,$scope.focused=!1,$scope.searchFor=CommentsService.searchFor,$scope.loading=!1,$scope.pageHidden=[],$scope.tree={},$scope.list={};var commentIdsInPage,pagesBreakpoints,breakpoints,scrollContainer=null,scrollContent=null;$scope.isVisible=function(){return $state.includes("**.panel.**")},$scope.addNewComment=function(){$state.includes("**.add-comment.**")||$state.go($state.current.name+".add-comment")},$scope.addNewNote=function(){},$scope.onShowCurrentPageOnly=function(){getComments()},$scope.getPageName=function(id){var page=PagesService.pagesMap[id];return null===page.version_of?page.name:PagesService.pagesMap[page.version_of].name},$scope.getBreakpointName=function(id){return $sce.trustAsHtml(BreakpointsService.breakpointsMap[id].name)},$scope.isPageHidden=function(id){return id=parseInt(id),$scope.pageHidden.indexOf(id)!==-1},$scope.togglePageHidden=function(e,id){id=parseInt(id);var index=$scope.pageHidden.indexOf(id);index!==-1?$scope.pageHidden.splice(index,1):$scope.pageHidden.push(id)},$scope.keyDown=function(e){e.stopPropagation(),27===e.which&&(""!==$scope.searchFor?$scope.searchFor="":$scope.focused=!1)},$scope.onSearchClick=function(e){$scope.focused=!0},$scope.showBreakpoints=function(){return breakpoints.length>1},$scope.$on("$destroy",function(){onSearchFor(),onLoadingComments(),onSelectComment(),onComments(),onShowCommentsResolvedChanged(),onCommentsFilterChange(),onCommentTypeUpdate()});var onComments=$scope.$watchCollection("comments",function(value){value&&update()}),onSearchFor=$scope.$watch("searchFor",function(newValue,oldValue){newValue!==oldValue&&(CommentsService.searchFor=newValue,$rootScope.$emit("searchComments"),update())}),onCommentsFilterChange=$rootScope.$on(PreviewEnums.ON_COMMENTS_FILTER_CHANGE,function(){update()}),onCommentTypeUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,function(){update()}),onLoadingComments=$rootScope.$on(PreviewEnums.LOADING_COMMENTS,function(e,value){$scope.showCurrentPageOnly&&($scope.loading=value)}),onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id,type){id&&"canvas"===type&&$timeout(function(){var element=document.getElementById("group-"+id+"-panel"),position=getElementPositionRelatedToAncestor(element,scrollContent);animate(scrollContent,.5,{ease:"easeInOutPower2",scrollTop:position.top-10})},0)}),onShowCommentsResolvedChanged=$rootScope.$on(PreviewEnums.ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED,function(e,value){$scope.showResolved=value,update()}),resetPageHidden=function(){for(;$scope.pageHidden.length;)$scope.pageHidden.pop()},getElementPositionRelatedToAncestor=function(element,ancestor){return{top:element.getBoundingClientRect().top-ancestor.getBoundingClientRect().top+ancestor.scrollTop,left:element.getBoundingClientRect().left-ancestor.getBoundingClientRect().left+ancestor.scrollLeft}},search=function(where,what){return where.toLocaleLowerCase().indexOf(what.toLocaleLowerCase())!==-1},testResolved=function(comment){return $scope.showResolved||!comment.resolved.is},testBreakpoint=function(comment){return $scope.isDocument||!$scope.showCurrentPageOnly||PagesService.pagesMap[comment.id_page].version_type===PagesService.currentBreakpointId},testSearch=function(comment){if(!$scope.searchFor)return!0;var child,id=comment._id,showChild=!1,found=!1,comments=CommentsService.commentsTree[id];if(comments&&comments.forEach(function(childId){if(child=CommentsService.commentsMap[childId],search(child.comment,$scope.searchFor))return showChild=!0,!1}),found=search(comment.comment,$scope.searchFor)||showChild||!$scope.showCurrentPageOnly&&search($scope.getPageName(comment.id_page),$scope.searchFor),!$scope.showCurrentPageOnly){var pageId=PagesService.pagesMap[comment.id_page].version_of||comment.id_page;found&&$scope.isPageHidden(pageId)&&$scope.togglePageHidden(null,pageId)}return found},canDisplayComment=function(comment){return!comment._parent_comment&&testResolved(comment)&&testBreakpoint(comment)&&testSearch(comment)},update=function(){$scope.showCurrentPageOnly?buildList():buildTree()},buildList=function(){$scope.list=[],_.forEach($scope.comments,function(comment){CommentsFilter.canDisplayComment(comment)&&canDisplayComment(comment)&&$scope.list.push(comment)})},buildTree=function(){$scope.tree={};var page,pageBreakpoint,comment;_.forEach(pagesBreakpoints,function(breakpointIds,pageId){page={},_.forEach(breakpointIds,function(breakpointPageId,breakpointId){pageBreakpoint=[],_.forEach(commentIdsInPage[breakpointPageId],function(commentId){comment=CommentsService.commentsMap[commentId],CommentsFilter.canDisplayComment(comment)&&canDisplayComment(comment)&&pageBreakpoint.push(comment)}),_.isEmpty(pageBreakpoint)||(page[breakpointId]=pageBreakpoint)}),_.isEmpty(page)||($scope.tree[pageId]=page)})},getComments=function(){resetPageHidden(),$scope.loading=!0,CommentsService.getComments($scope.showCurrentPageOnly).then(function(comments){$scope.loading=!1,$scope.comments=comments,commentIdsInPage=CommentsService.commentIdsInPage,pagesBreakpoints=PagesService.pagesBreakpoints,breakpoints=PagesService.breakpointIds,scrollContainer=document.querySelector("section.left-panel > #comments-panel > section.scrolled-container"),scrollContent=scrollContainer.querySelector("section.scrolled-content")})};$scope.loading=!0,$timeout(function(){getComments()},700)}]),function(){"use strict";function CommentsFilterCtrl(CommentsSettings,Settings,hotkeys){function activate(){vm.showResolved=Settings.showResolvedComments,vm.commentTypesActive=CommentsSettings.commentTypesActive(),vm.filterOptions=CommentsSettings.getCommentsFilterOptions(),vm.selectedFilter=getInitialFilterOption(),addShortcuts()}function addShortcuts(){_.each(vm.filterOptions,function(option){hotkeys.add({combo:option.shortcut.join("+"),description:option.value,callback:function(){changeActiveFilter(option.value)}})})}function getInitialFilterOption(){return CommentsSettings.getLastUsedCommentsFilter()||vm.filterOptions[0].value}function handleFilterChange(){CommentsSettings.setLastUsedCommentsFilter(vm.selectedFilter)}function handleShowResolvedChange(){Settings.setShowResolvedComments(vm.showResolved)}function changeActiveFilter(value){vm.selectedFilter=value,handleFilterChange()}var vm=this;vm.filterOptions=[],vm.selectedFilter=null,vm.showResolvedComments=!1,vm.commentTypesActive=!1,vm.handleFilterChange=handleFilterChange,vm.handleShowResolvedChange=handleShowResolvedChange,activate()}angular.module("core").controller("CommentsFilterCtrl",CommentsFilterCtrl),CommentsFilterCtrl.$inject=["CommentsSettings","Settings","hotkeys"]}(),angular.module("core").controller("DocumentController",["$rootScope","$scope","$state","$stateParams","DocumentsService","Settings",function($rootScope,$scope,$state,$stateParams,DocumentsService,Settings){"use strict";Settings.setMode($stateParams.mode),$stateParams.documentId||$state.go($state.current.name,{documentId:DocumentsService.currentDocumentId})}]),function(){"use strict";angular.module("core").controller("HomeController",["$rootScope","$scope","$state","$timeout","$window","animate","LayoutStates","LiveShareService","UsabilityTestService","ProjectsService","PagesService","UsersService","AnalyticsService","Settings","socket","editorSocket","deviceDetectorHelper","Engine","PageExitService",function($rootScope,$scope,$state,$timeout,$window,animate,LayoutStates,LiveShareService,UsabilityTestService,ProjectsService,PagesService,UsersService,AnalyticsService,Settings,socket,editorSocket,deviceDetectorHelper,Engine){AnalyticsService.startDesignLoadTrack(),AnalyticsService.event("Opened preview"),socket.emit("addCollaborator",{socketRoomId:ProjectsService.currentProjectHash,isAnonymous:UsersService.isAnonymous(),isProject:UsersService.isInProjectsAccount()}),editorSocket.emit("addCollaborator",{socketRoomId:ProjectsService.currentProjectHash});LiveShare.enums.SESSION_TYPES;$scope.panelVisible=!1,$scope.sitemapVisible=!1,$scope.panelFadeIn=!1,$scope.sitemapFadeIn=!1,$scope.isVisible=$scope.panelVisible||$scope.sitemapVisible,$scope.breakpointsVisible=!0,$scope.breakpoints=[],$scope.breadcrumbsVisible=!1,$scope.isLiveSession=!1,$scope.dragging=!1,$scope.isLoading=!0,$scope.isParticipant=!1,$scope.noToolbar=Settings.disableComments&&Settings.disableSitemap,$scope.isCommentsEnabled=!Settings.disableComments,$scope.isAddingComment=!1,$scope.showCrosshairCursor=!1,$scope.canShowLoginToolbar=UsersService.isAnonymous(),$scope.showLoginToolbar=!1,$scope.isAppViewAvailable=deviceDetectorHelper.isAppViewAvailable(),$scope.sidebarVisible=!1,$scope.isMac=deviceDetectorHelper.isMac();var ANIM_TIME=.01,ANIM_EASE="easeInOutPower2";$scope.keyDown=function(e){var rx=/INPUT|SELECT|TEXTAREA/i;8===e.which&&(!rx.test(e.target.tagName)||e.target.disabled||e.target.readOnly)&&e.preventDefault(),$rootScope.$emit("keyDown",e)},$scope.showToolbar=function(e){LayoutStates.removeState("nosidebar")},$scope.isToolbarVisible=function(){return LayoutStates.isToolbarVisible()};var isSidebarOpen=function(state){return state.indexOf(".nosidebar")===-1},isSitemapOpen=function(state){return state.indexOf(".sitemap")!==-1},isPanelOpen=function(state){return state.indexOf(".panel")!==-1},isOpen=function(state){return isPanelOpen(state)||isSitemapOpen(state)},change=function(panelOpen,sitemapOpen){var sitemap=document.querySelector("section.left-panel#sitemap"),panel=document.querySelector("section.left-panel#comments-notes");panel.style.left=panelOpen?"0px":"-326px",sitemap.style.left=sitemapOpen?"0px":"-326px",animate(panel,ANIM_TIME,{ease:ANIM_EASE,opacity:panelOpen?1:0,visibility:"visible",onComplete:function(){$scope.$apply(function(){$scope.panelVisible=panelOpen,$scope.sitemapVisible=sitemapOpen})}}),animate(sitemap,ANIM_TIME,{ease:ANIM_EASE,opacity:sitemapOpen?1:0,visibility:"visible"})},open=function(value,panelOpen,sitemapOpen){var panelToMove,mainToolbar=document.querySelector("#main-toolbar"),sitemap=document.querySelector("section.left-panel#sitemap"),panel=document.querySelector("section.left-panel#comments-notes");panelToMove=value?sitemapOpen?sitemap:panel:$scope.sitemapVisible?sitemap:panel,animate(panelToMove,ANIM_TIME,{ease:ANIM_EASE,left:value?"0px":"-365px",visibility:"visible",opacity:value?1:0,onComplete:function(){$scope.$apply(function(){$scope.sitemapVisible=sitemapOpen,$scope.panelVisible=panelOpen,$scope.isVisible=$scope.panelVisible||$scope.sitemapVisible}),Engine.updateOffset()},onUpdate:function(){Engine.updateOffset()}}),animate(mainToolbar,ANIM_TIME,{ease:ANIM_EASE,left:value?"326px":"0px"})},updateCrosshairCursor=($rootScope.$on(PreviewEnums.LOADING,function(e,value){$scope.isLoading=value,value||($scope.firstTimeLoaded=!0)}),$rootScope.$on(PreviewEnums.SET_ANONYMOUS_NAME,function(e,name){name&&(UsersService.setAnonymousName(name),updateCrosshairCursor())}),$rootScope.$on(PreviewEnums.ANONYMOUS_ADD_COMMENT,function(e){onAddingComment(!0)}),$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(e){$scope.breakpointsVisible=PagesService.getPageBreakpoints(PagesService.currentPageId).length>1,$scope.breakpoints=PagesService.getPageBreakpoints(PagesService.currentPageId)}),$rootScope.$on(PreviewEnums.ON_MODE_CHANGED,function(e){$scope.noToolbar=Settings.disableComments&&Settings.disableSitemap,$scope.isCommentsEnabled=!Settings.disableComments}),function(){$scope.showCrosshairCursor=$scope.isAddingComment&&(!UsersService.isAnonymous()||UsersService.isAnonymousNameSet())}),handlePanelAnimations=($rootScope.$on("$stateChangeSuccess",function(e,toState,toParams,fromState,fromParams){return $scope.isAddingComment=$state.includes("**.add-comment.**"),fromState.name.indexOf("add-comment")===-1&&toState.name.indexOf("add-comment")!==-1?onAddingComment(!0):fromState.name.indexOf("add-comment")!==-1&&toState.name.indexOf("add-comment")===-1&&onAddingComment(!1),$scope.sidebarVisible=!$state.includes("**.nosidebar.**"),""===fromState.name?($scope.panelVisible=$state.includes("**.panel.**"),$scope.sitemapVisible=$state.includes("**.sitemap.**"),void($scope.isVisible=$scope.panelVisible||$scope.sitemapVisible)):void handlePanelAnimations(toState,fromState)}),function(toState,fromState){isOpen(toState.name)&&!isOpen(fromState.name)?open(!0,isPanelOpen(toState.name),isSitemapOpen(toState.name)):!isOpen(toState.name)&&isOpen(fromState.name)?open(!1,isPanelOpen(toState.name),isSitemapOpen(toState.name)):isOpen(toState.name)&&isOpen(fromState.name)&&isPanelOpen(toState.name)!==isPanelOpen(fromState.name)?change(isPanelOpen(toState.name),isSitemapOpen(toState.name)):isOpen(toState.name)&&isOpen(fromState.name)&&isSidebarOpen(toState.name)!==isSidebarOpen(fromState.name)&&open(isSidebarOpen(toState.name),isPanelOpen(toState.name),isSitemapOpen(toState.name))}),onAddingComment=($rootScope.$on(PreviewEnums.DRAGGING_COMMENT,function(e,value){$scope.dragging=value}),function(value){updateCrosshairCursor(),$scope.showLoginToolbar=value&&UsersService.isAnonymous()}),liveShareSessionstarted=function(SessionService){$scope.isLiveSession=!0,LayoutStates.setStateById("isLiveShareSession",!0),SessionService.isHostSession()||($scope.breakpointsVisible=!1,$scope.breadcrumbsVisible=!0)},usabilityTestSessionStarted=function(SessionService){$scope.isLiveSession=!0,$scope.isVisible=!0,$scope.sitemapVisible=!0,$scope.isParticipant=!SessionService.isHostSession(),LayoutStates.setStateById("isUserTestingSession",!0),LayoutStates.setStateById("isHostSession",SessionService.isHostSession()),open(!0,!1,!0)};LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveShareSessionstarted.bind(this,LiveShareService)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,usabilityTestSessionStarted.bind(this,UsabilityTestService));var liveSessionfinished=function(){$scope.breakpointsVisible=!ProjectsService.isDocument()&&$scope.breakpoints.length>1,$scope.breadcrumbsVisible=!1,$scope.isLiveSession=!1,$scope.isParticipant=!1};LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionfinished.bind(this)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionfinished.bind(this)),angular.element($window).bind("resize",function(){Settings.isResponsive&&PagesService.setPageResponsive($window.innerWidth)}),$rootScope.$on(PreviewEnums.ON_APP_VIEW_PROMO_CLOSE,function(){$scope.isAppViewAvailable=!1})}])}(),angular.module("core").controller("LiveShareConfigurationController",["$scope","$state","$translate","$modal","$modalInstance","LiveShareService",function($scope,$state,$translate,$modal,$modalInstance,LiveShareService){"use strict";function getConfigurationOptions(){var options=[];return $scope.liveShareOptions.forEach(function(option){option.value&&options.push(option.param)}),options.join(",")}LiveShareService.getConfigurationOptions().then(function(options){$scope.liveShareOptions=options}),$scope.contributors=[],$scope.inviteUrl=null,LiveShareService.roomId()?$scope.inviteUrl=LiveShareService.getInviteURL(LiveShareService.roomId):LiveShareService.makeRoomReservation().then(function(roomId){$scope.inviteUrl=LiveShareService.getInviteURL(roomId)},function(){$modalInstance.close(),$state.reload()}),$scope.start=function(){LiveShareService.startInitializing({options:getConfigurationOptions()}),$modalInstance.close()},$scope.onClickLink=function($event){$event.target.select()}}]),angular.module("core").controller("LiveShareFinishController",["$scope","$state","$stateParams","$timeout","PagesService","ProjectsService","LiveSessionInstanceService","ChromeExtensionService",function($scope,$state,$stateParams,$timeout,PagesService,ProjectsService,LiveSessionInstanceService,ChromeExtensionService){"use strict";var TYPES=LiveShare.enums.SESSION_STATUS,LiveSessionInstance=LiveSessionInstanceService.get();$scope.backUrl=document.URL.split("#")[0],$scope.projectName=ProjectsService.currentProjectName,$scope.onClickBackToPreview=function($event){$event.preventDefault(),window.location.replace($scope.backUrl)};var isLiveShareSession;if(LiveSessionInstance.getType()===LiveShare.enums.SESSION_TYPES.TESTING){isLiveShareSession=!1;try{ChromeExtensionService.postMessage({stop:!0})}catch(e){window.console.error(e.stack)}LiveSessionInstance.finishTestingSession()}else isLiveShareSession=!0;switch($stateParams.type){case TYPES.QUIT:var REDIRECT_AFTER=3e3;$scope.message="LS_SESSION_QUIT",$timeout(function(){window.location.replace($scope.backUrl)},REDIRECT_AFTER);break;case TYPES.BANNED:$scope.message="LS_SESSION_BANNED";break;case TYPES.OVER:isLiveShareSession?$scope.message="LS_SESSION_OVER":($scope.backUrl=!1,$scope.message="UT_THANKS_FOR_CONTRIBUTION");break;default:$scope.message="LS_SESSION_404"}}]),angular.module("core").controller("LiveShareInitializeController",["$q","$rootScope","$scope","$state","$stateParams","$timeout","$modal","ProjectsService","LiveSessionInstanceService","UsersService","UsabilityTestService","LiveShareService","ChromeExtensionService",function($q,$rootScope,$scope,$state,$stateParams,$timeout,$modal,ProjectsService,LiveSessionInstanceService,UsersService,UsabilityTestService,LiveShareService,ChromeExtensionService){"use strict";function updateProgress(progress){$scope.loadingProgress=progress}function setName(){var d=$q.defer();return""!==$scope.userName.trim()&&d.resolve($scope.userName),$scope.$watch("userName",function(newValue){newValue&&""!==newValue.trim()&&d.resolve(newValue)}),d.promise}function generateSessionConfiguration(options,roomId){var settings;return settings=isLiveShareSession?{leadCursor:"host",triggerEvents:"host"}:{triggerEvents:"all",showCursor:"tester",leadCursor:"tester",toggleFollow:!1},options&&options.split(",").forEach(function(optionName){var option=LiveSessionInstance.translateOption(optionName,!0),key=Object.keys(option)[0];settings[key]=option[key]}),settings}function createSession(){var roomData={roomID:LiveSessionInstance.roomId(),url:LiveSessionInstance.getDestinationUrl(),name:ProjectsService.currentProjectName,roomSettings:generateSessionConfiguration($stateParams.options),type:LiveSessionInstance.getType()};if(myData=_.extend(myData,{sessionId:UsersService.me.id_session,name:$scope.userName}),isLiveShareSession)LiveSessionInstance.create(roomData,myData).then(sessionInitialized,sessionInitializationFailed);else{LiveSessionInstance.getTestData();LiveSessionInstance.save().then(function(testData){LiveSessionInstance.setDataId(testData._id),roomData.testDataId=testData._id,LiveSessionInstance.create(roomData,myData).then(function(roomData){sessionInitialized(roomData);try{ChromeExtensionService.postMessage({canRecord:!0,testId:roomData.testDataId})}catch(e){window.console.error(e.stack)}},sessionInitializationFailed)})}}function joinToSession(){var onContentLoaded=$rootScope.$on(PreviewEnums.ON_CONTENT_LOADED,function(){onContentLoaded(),setName().then(function(name){LiveSessionInstance!==UsabilityTestService||UsabilityTestService.getTestData()?LiveSessionInstance.join($stateParams.sessionId,myData).then(sessionInitialized,sessionInitializationFailed):(myData=_.extend(myData,{type:LiveShare.enums.USER_TYPES.TESTER}),LiveSessionInstance.join($stateParams.sessionId,myData).then(function(roomData){UsabilityTestService.setDataId(roomData.testDataId),UsabilityTestService.fetch().then(sessionInitialized.bind(this,roomData),sessionInitializationFailed)},sessionInitializationFailed))})})}function sessionInitialized(roomData){var DELAY_AFTER_PROGRESS_BAR_ANIMATION=800;LiveSessionInstance.roomId(roomData.roomID),updateProgress(100),$timeout(function(){$state.go("home.page",{pageId:$stateParams.pageId}),isLiveShareSession||LiveSessionInstance.isHostSession()||$modal.open({templateUrl:"/scripts/modules/core/views/usabilityTest/introduction.view.html",controller:"UsabilityTestIntroductionController",keyboard:!1})},DELAY_AFTER_PROGRESS_BAR_ANIMATION)}function sessionInitializationFailed(e){$state.go("home.page.live-share-finish",{type:LiveShare.enums.SESSION_STATUS.OVER}),window.console.error(e.stack)}LiveSessionInstanceService.get()||($stateParams.type===LiveShare.enums.SESSION_TYPES.TESTING?LiveSessionInstanceService.set(UsabilityTestService):LiveSessionInstanceService.set(LiveShareService));var LiveSessionInstance=LiveSessionInstanceService.get(),isLiveShareSession=LiveSessionInstance===LiveShareService;if(LiveSessionInstance.isSession())return $state.go("home.page");var myData={settings:{muted:LiveSessionInstance.muted}};$scope.sessionTypeName=isLiveShareSession?"LS_NAME_SHARING":"LS_NAME_TESTING",$scope.loadingProgress=0,$scope.projectName=ProjectsService.currentProjectName,$scope.userName="",$scope.loginUrl=null,UsersService.isAnonymous()?($scope.name=UsersService.isAnonymousNameSet()?UsersService.me.name:"",$scope.loginUrl=ApplicationConfiguration.loginPageURL+"?cb="+encodeURIComponent(document.URL)):($scope.userName=UsersService.me.name||"",myData.customData={avatar:UsersService.me.avatar||null,uxpin_id:UsersService.me.id_user,id_session:UsersService.me.id_session}),$scope.onFormSubmit=function(name){$scope.working=!0,$scope.userName=name,UsersService.setAnonymousName(name)},$stateParams.sessionId?joinToSession():createSession()}]),function(){"use strict";function LoginToolbarCtrl($rootScope,$scope,$state,$timeout,UsersService){function activate(){$scope.anonymousName=getAnonymousName(),$scope.referer=getReferer()}function isValid(name){return name&&name.match(/\w+/)}function getAnonymousName(){return UsersService.isAnonymousNameSet()?UsersService.getAnonymousName():""}function setName(){var HIDE_TOOLBAR_TIMEOUT=600,name=$scope.anonymousName.trim();
isValid(name)&&$timeout(function(){$scope.setFocus(!1),$scope.showNameForm=!1,$rootScope.$emit(PreviewEnums.SET_ANONYMOUS_NAME,name)},HIDE_TOOLBAR_TIMEOUT)}function hide(){$scope.anonymousName=getAnonymousName(),$scope.setFocus(!1),$scope.showNameForm=!1,$scope.disabled=!0,$rootScope.$emit(PreviewEnums.SET_ANONYMOUS_NAME)}function getReferer(){return ApplicationConfiguration.loginPageURL+"/?cb="+encodeURIComponent(window.location.href)}function setFocus(value,delay){delay>0?$timeout(function(){$scope.focused=value},delay):$scope.focused=value}function onClickShowNameForm(){$scope.showNameForm=!0,$scope.setFocus(!0,300),$scope.disabled=!isValid($scope.anonymousName.trim())}function onChange(){$scope.disabled=!isValid($scope.anonymousName.trim())}function updateReferer(){$scope.referer=getReferer()}function onKeyDown(event){event.which===KEY_CODES.ENTER?(event.stopPropagation(),event.preventDefault(),setName()):event.which===KEY_CODES.ESC&&(event.stopPropagation(),$timeout(function(){hide()},100))}var KEY_CODES={ESC:27,ENTER:13};$scope.showNameForm=!1,$scope.disabled=!0,$scope.focused=!1,$scope.referer="",$scope.anonymousName="",$scope.setFocus=setFocus,$scope.onClickShowNameForm=onClickShowNameForm,$scope.setName=setName,$scope.onChange=onChange,$scope.updateReferer=updateReferer,$scope.onKeyDown=onKeyDown,activate();$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id){$state.includes("**.add-comment.**")||hide()}),$rootScope.$on(PreviewEnums.ANONYMOUS_ADD_COMMENT,function(e){$scope.showNameForm&&$scope.setFocus(!0,1)}),$rootScope.$on("$stateChangeSuccess",function(e,toState,toParams,fromState,fromParams){fromState.name.indexOf("add-comment")!==-1&&toState.name.indexOf("add-comment")===-1&&hide()})}angular.module("core").controller("LoginToolbarCtrl",LoginToolbarCtrl),LoginToolbarCtrl.$inject=["$rootScope","$scope","$state","$timeout","UsersService"]}(),angular.module("core").controller("NavController",["$rootScope","$scope","$state","$stateParams","$modal","CommentsService","LiveShareService","UsabilityTestService","UsersService","ProjectsService","UXPinService","Settings","LayoutStates",function($rootScope,$scope,$state,$stateParams,$modal,CommentsService,LiveShareService,UsabilityTestService,UsersService,ProjectsService,UXPinService,Settings,LayoutStates){"use strict";var originalItems,ITEMS_MAP={comments:{section:1,classes:"add-comment icon-font-comment-mode",tooltip:"TIP_COMMENT_MODE",state:"add-comment",parentState:"*",toggle:!0},collaboration:{section:2,classes:"collaboration icon-font-user",tooltip:"TIP_COLLABORATION",state:"home.page.collab",toggle:!1},commentsNotes:{section:2,classes:"comments-notes icon-font-comment-notes",tooltip:"TIP_COMMENTS_NOTES",state:"panel",parentState:["home.page","home.page.comment","home.document","home.document.comment"],toggle:!0,toggleWith:["sitemap"]},sitemap:{section:2,classes:"sitemap icon-font-sitemap",tooltip:"TIP_SITEMAP",state:"sitemap",parentState:["home.page","home.page.comment"],toggle:!0,toggleWith:["panel"]},liveShare:{section:3,classes:"icon-font-live-share",tooltip:"TIP_LIVE_SHARE",state:"live-share-start",parentState:"*",toggle:!0},usabilityTesting:{section:3,classes:"icon-font-usability-testing",tooltip:"TIP_USABILITY_TEST",state:"usability-test",parentState:"*",toggle:!0}},generateMenu=function(items){var index;originalItems=items,$scope.items=_.clone(originalItems),Settings.disableComments&&(index=$scope.items.indexOf(ITEMS_MAP.comments),index!==-1&&$scope.items.splice(index,1),index=$scope.items.indexOf(ITEMS_MAP.commentsNotes),index!==-1&&$scope.items.splice(index,1)),Settings.disableSitemap&&(index=$scope.items.indexOf(ITEMS_MAP.sitemap),index!==-1&&$scope.items.splice(index,1)),$scope.params.toolbarEnabled=!(Settings.disableSitemap&&Settings.disableComments)};$scope.itemsMap={},$scope.isUserTestingSession=!1,$scope.isLiveShareSession=!1,$scope.isHostSession=!1,$scope.sessionStartTime=null,$scope.params={isLogged:!(UsersService.me.is_anonymous||Settings.isExport()),isDocument:ProjectsService.isDocument(),isUXTestDocument:ProjectsService.isUXTestDocument(),isOwner:UsersService.me.is_owner,features:Settings.isExport()?{}:ProjectsService.currentProjectFeatures,toolbarEnabled:null,isExport:Settings.isExport()},UsersService.me.is_owner?($scope.params.currentDocumentURL=UXPinService.getCurrentDocumentURL(),$scope.params.dashboardURL=UXPinService.getCurrentCollectionURL()):($scope.params.currentDocumentURL=null,$scope.params.dashboardURL=UXPinService.getDashboardURL());var liveSessionStarted=function(SessionService){$scope.isLiveShareSession=!0,SessionService===UsabilityTestService?($scope.isUserTesting=!0,SessionService.isHostSession()&&($scope.isHostSession=!0),$scope.onClickFinishSession=function($event){$event.preventDefault(),UsabilityTestService.quit()}):SessionService.isHostSession()||generateMenu([ITEMS_MAP.commentsNotes])},liveSessionFinished=function(){$scope.isUserTestingSession=!1,$scope.isHostSession=!1,generateMenu([ITEMS_MAP.comments,ITEMS_MAP.commentsNotes,ITEMS_MAP.sitemap,ITEMS_MAP.liveShare,ITEMS_MAP.usabilityTesting])},plans=function(){$scope.upgradePlanURL=ApplicationConfiguration.upgradePlanURL,$scope.onClickPlanUpgrade=function($event){$event.preventDefault(),$modal.open({templateUrl:"/scripts/modules/core/views/planUpgrade/modal.view.html",controller:"PlanUpgradeController"})}};LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveSessionStarted.bind(this,LiveShareService)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveSessionStarted.bind(this,UsabilityTestService)),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished),$scope.isActive=function(state){return hasState(state)},$scope.testerJoined=!1;var testerJoinedDate,testerJoined=function(data){$scope.$apply(function(){testerJoinedDate=data.started_at,$scope.testerJoined=!0})};UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.TESTER_JOINED,testerJoined),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.TESTER_JOINED,testerJoined);var allowStart=function(){var startTime=function(){$scope.testerJoined&&($scope.sessionStartTime=String(new Date))};$scope.testerJoined?startTime():$scope.$watch("testerJoined",startTime)};UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.ALLOW_START,allowStart),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.ALLOW_START,allowStart),$scope.onClick=function(item){item.toggle===!0?toggleState(item.state):enterState(item.state)},$scope.$on("$destroy",function(){onSelectComment(),onDeleteComment(),onKeyDown(),onModeChanged()}),$scope.onConfigureLiveShareSession=function($event){$event.preventDefault(),$scope.params.settingsOpen=!1,$modal.open({templateUrl:"/scripts/modules/core/views/liveShare/configuration.view.html",controller:"LiveShareConfigurationController"})},$scope.onClickUsabilityTestSession=function(){$state.go("home.page.usability-test",$stateParams)},$scope.closeToolbar=function(){LayoutStates.enterState("nosidebar")},$scope.isToolbarVisible=function(){return LayoutStates.isToolbarVisible()};var onKeyDown=$rootScope.$on("keyDown",function(e,kE){if(27===kE.which)if(hasState("comment")&&!CommentsService.selectedCommentShowNotificationPanel){kE.stopPropagation();var newState=$state.current.name.replace("home.page.comment","home.page");enterState(newState)}else hasState("add-comment")&&!CommentsService.selectedCommentShowNotificationPanel&&(kE.stopPropagation(),toggleState("add-comment"))}),onModeChanged=$rootScope.$on(PreviewEnums.ON_MODE_CHANGED,function(e){generateMenu(originalItems)}),onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id,type,redirect){var newState,currentState=$state.current.name,options=function(){return redirect?{location:"replace"}:null}();if(id=CommentsService.getRedirectId(id)){UsersService.isAnonymous()||CommentsService.markAsRead(id);var pageId=CommentsService.commentsMap[id].id_page;if(hasState("comment")){if($state.includes("**.comment.**",{commentId:id}))return;CommentsService.selectedCommentId=id,enterState(currentState,{pageId:pageId,commentId:id},options)}else newState=currentState.replace("home.page","home.page.comment"),CommentsService.selectedCommentId=id,enterState(newState,{pageId:pageId,commentId:id},options)}else hasState("comment")&&(newState=currentState.replace("home.page.comment","home.page"),CommentsService.selectedCommentId=null,enterState(newState,null,options))}),onDeleteComment=$rootScope.$on(PreviewEnums.DELETE_COMMENT,function(e,id,isReply){if(!isReply){var newState,currentState=$state.current.name;hasState("comment")&&(newState=currentState.replace("home.page.comment","home.page"),enterState(newState))}}),toggleState=($rootScope.$on(PreviewEnums.DELETING_COMMENT,function(e,id,value){var newState,currentState=$state.current.name;value&&hasState("comment")&&(newState=currentState.replace("home.page.comment","home.page"),enterState(newState))}),function(state){var newState,currentState=$state.current.name;hasState(state)?(newState=currentState.replace("."+state,""),enterState(newState)):enterState(0===state.indexOf("home.")?state:getState(currentState,state))}),enterState=function(state,params,options){$state.go(state,params,options)},hasState=function(state){return $state.includes("**."+state+".**")},getState=function(fromState,toState){var state,item=$scope.itemsMap[toState];if(_.isArray(item.toggleWith)&&(_.forEach(item.toggleWith,function(value){if(hasState(value))return state=fromState.replace("."+value,"."+toState),!1}),state))return state;if(_.isArray(item.parentState)){if(_.forEachRight(item.parentState,function(value){if(fromState.indexOf(value)!==-1)return state=fromState.replace(value,value+"."+toState),!1}),state)return state}else if("*"===item.parentState)return fromState+"."+toState;return fromState};generateMenu(Settings.isExport()?[ITEMS_MAP.sitemap]:[ITEMS_MAP.comments,ITEMS_MAP.commentsNotes,ITEMS_MAP.sitemap,ITEMS_MAP.liveShare,ITEMS_MAP.usabilityTesting]),_.forEach(ITEMS_MAP,function(value,key){$scope.itemsMap[value.state]=value}),plans($scope,$modal)}]),angular.module("core").controller("PageController",["$rootScope","$scope","$state","$stateParams","PagesService","CommentsService","Settings","pages","isMobile","$modal",function($rootScope,$scope,$state,$stateParams,PagesService,CommentsService,Settings,pages,isMobile,$modal){"use strict";if(isMobile||Settings.isExport()&&!Settings.isMenuEnabled()?Settings.setMode("cm"):Settings.setMode($stateParams.mode),$scope.gotoPage=function(id,redirect){var options=function(){return redirect?{location:"replace"}:null}();$state.go($state.current.name,{pageId:id},options)},$scope.previousPageId=PagesService.currentPageId,$stateParams.pageId){var pageId=parseInt($stateParams.pageId),changePage=!!PagesService.currentPageId;if(PagesService.pagesMap[pageId]&&null===PagesService.pagesMap[pageId].version_type){var page=_.find(pages,function(page){return page.version_type===PagesService.defaultBreakpointId&&page.version_of===pageId});return PagesService.setCurrentPageId(page.id_page),$scope.gotoPage(page.id_page,!0)}PagesService.pagesMap[pageId]?pageId!==PagesService.currentPageId&&(PagesService.setCurrentPageId(pageId),changePage&&($rootScope.$emit(PreviewEnums.ADDING_COMMENT,!1),$rootScope.$emit(PreviewEnums.LOADING_COMMENTS,!0),CommentsService.getComments().then(function(){$rootScope.$emit(PreviewEnums.LOADING_COMMENTS,!1)}))):(PagesService.setCurrentPageId(PagesService.getRootPage()),$scope.gotoPage(PagesService.currentPageId,!0))}else PagesService.setCurrentPageId(PagesService.getRootPage()),$scope.gotoPage(PagesService.currentPageId,!0);$rootScope.$on(PreviewEnums.NAVIGATE_TO_PAGE,function(e,pageId){$scope.gotoPage(pageId)}),$rootScope.$on(PreviewEnums.NAVIGATE_HISTORY_BACK,function(){$scope.previousPageId&&$scope.gotoPage($scope.previousPageId)})}]),angular.module("core").controller("PlanUpgradeController",["$scope","$modalInstance","$transition","$window","localStorageService",function($scope,$modalInstance,$transition,$window,localStorageService){"use strict";var videoElem=null,onYoutubePlayerReady=null,videoId="DN81evKgaW8",movieOnClass="movie-on",moviePartSelector="section.movie-part";$scope.upgradePlanURL=ApplicationConfiguration.upgradePlanURL,$scope.video={id:videoId,player:null},onYoutubePlayerReady=$scope.$on("youtube.player.ready",function($event,player){$scope.video.player=player,videoElem=angular.element(document.querySelector(moviePartSelector))}),$scope.playMovie=function($event){$transition(videoElem,movieOnClass).then(function(){$scope.video.player.playVideo()})},$scope.closeMovie=function($event){$transition(videoElem,videoElem.removeClass(movieOnClass)).then(function(){$scope.video.player.stopVideo()})},$scope.closeModal=function($event){$modalInstance.close()},$scope.upgradePlan=function($event){var dstUrl=$event.target.getAttribute("href"),re=new RegExp("^"+$window.location.origin),relativeURI=$window.location.href.replace(re,"");$event.preventDefault(),localStorageService.cookie.set("ba_cb",relativeURI),$modalInstance.close(),$window.location.href=dstUrl},$scope.$on("$destroy",function(){onYoutubePlayerReady()})}]),angular.module("core").controller("SettingsBarController",["$rootScope","$scope","$state","LiveShareService","UsabilityTestService",function($rootScope,$scope,$state,LiveShareService,UsabilityTestService){"use strict";$scope.isLiveShareSession=LiveShareService.isSession();var liveSessionStarted=function(){$scope.$apply(function(){$scope.isLiveShareSession=!0})};LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveSessionStarted.bind(this)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveSessionStarted.bind(this));var liveSessionFinished=function(){$scope.isLiveShareSession=!1};LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished.bind(this)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished.bind(this))}]),angular.module("core").controller("SettingsBarLiveShareController",["$rootScope","$scope","$state","$timeout","$modal","LiveSessionInstanceService",function($rootScope,$scope,$state,$timeout,$modal,LiveSessionInstanceService){"use strict";var LiveSessionInstance=LiveSessionInstanceService.get();$scope.isHostSession=LiveSessionInstance.isHostSession(),$scope.settingsPanelVisibilityModel=!1,$scope.muted=!1,$scope.inviteURL=LiveSessionInstance.getInviteURL(),$scope.collaborators=LiveSessionInstance.getCollaboratorsData(),$scope.isUserTestingMode=LiveSessionInstance.getType()===LiveShare.enums.SESSION_TYPES.TESTING,$scope.host=null;var SHOW_SETTINGS_AFTER=1e3;$timeout(function(){$scope.settingsPanelVisibilityModel=!0},SHOW_SETTINGS_AFTER),$scope.onClickMute=function(e){$scope.muted=LiveSessionInstance.muted=!LiveSessionInstance.muted,LiveSessionInstance.mute($scope.muted),updateCollaboratorsList(!0)},$scope.onClickRemoveUser=function($event,userID){$event.preventDefault(),LiveSessionInstance.removeCollaborator(userID)},$scope.onClickFinishSession=function($event){$event.preventDefault(),LiveSessionInstance.quit()},$scope.onClickInut=function($event){$event.target.select()};var updateCollaboratorsList=function(inScope){inScope?$scope.collaborators=LiveSessionInstance.getCollaboratorsData():$scope.$apply(function(){$scope.collaborators=LiveSessionInstance.getCollaboratorsData()})};LiveSessionInstance.registerObserverCallback("onMute",updateCollaboratorsList),LiveSessionInstance.registerObserverCallback("collaboratorJoin",updateCollaboratorsList.bind(this,!1)),LiveSessionInstance.registerObserverCallback("collaboratorLeft",updateCollaboratorsList.bind(this,!1)),LiveSessionInstance.registerObserverCallback("finish",function(data){$scope.collaborators=[],$state.go("home.page.live-share-finish",data)}),$scope.isHostSession||($scope.host=LiveSessionInstance.getHostData(),LiveSessionInstance.registerObserverCallback("followCursorOff",function(){$scope.$apply(function(){$scope.host=LiveSessionInstance.getHostData()})}),$scope.onClickFollowHost=function($event){$event.preventDefault(),$scope.host.isFollowed=!0,LiveSessionInstance.followCursor($scope.host.id)}),LiveSessionInstance.getConfigurationOptions().then(function(options){$scope.configuration=options}),$scope.setOption=function(option){LiveSessionInstance.setOption(option.param,option.value)},$scope.onClickCopy=function($event){var HIDE_COPY_MESSAGE_AFTER=1e3;$event.preventDefault(),$scope.isCopied=!0,$timeout(function(){$scope.isCopied=!1,$scope.settingsPanelVisibilityModel=!1},HIDE_COPY_MESSAGE_AFTER)}}]),angular.module("core").factory("SettingsBarPreviewCtrl",SettingsBarPreviewCtrl),SettingsBarPreviewCtrl.$inject=["_","$rootScope","$scope","$state","$stateParams","$timeout","$modal","UsersService","Settings","ProjectsService","PagesService","DOMService","Engine"],angular.module("core").controller("SidebarController",["$scope","UsabilityTestService",function($scope,UsabilityTestService){"use strict";$scope.isUserTesting=UsabilityTestService.isSession();var usabilityTestSessionStarted=function(){$scope.isUserTesting=!0};UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,usabilityTestSessionStarted.bind(this))}]),angular.module("core").controller("SitemapController",["$scope","$state","$q","CommentsService","PagesService","UsabilityTestService","Settings","editorSocket",function($scope,$state,$q,CommentsService,PagesService,UsabilityTestService,Settings,editorSocket){"use strict";$scope.isVisible=function(){return $state.includes("**.sitemap.**")},$scope.getPageName=function(id){return PagesService.pagesMap[id].name},$scope.isActive=function(id){return PagesService.currentPageId===PagesService.getPageByBreakpoint(id)},$scope.isIndent=function(){var isIndent=!1;return PagesService.pagesTree.nodes?(PagesService.pagesTree.nodes.forEach(function(node){if(node.nodes.length)return isIndent=!0,!1}),isIndent):isIndent},$scope.onClick=function(e,id){var newState,currentState=$state.current.name;newState=$state.includes("**.comment.**")?currentState.replace("home.page.comment","home.page"):currentState,$state.go(newState,{pageId:PagesService.getPageByBreakpoint(id)})},$scope.onSearchClick=function(e){$scope.focused=!0},$scope.keyDown=function(e){e.stopPropagation(),27===e.which&&(""!==$scope.searchFor?$scope.searchFor="":$scope.focused=!1)},$scope.comparatorSearch=function(actual){return""===$scope.searchFor||recursiveSearch(actual)},$scope.init=function(id){Settings.minimized.indexOf(String(id))!==-1?$scope.minimized[id]=!0:"undefined"==typeof $scope.minimized[id]&&($scope.minimized[id]=!1)},$scope.toggleMinimized=function(id){if($scope.minimized[id])Settings.minimized.push(String(id));else{var index=Settings.minimized.indexOf(String(id));Settings.minimized.splice(index,1)}Settings.updateMinimized()};var recursiveSearch=function(id){var i,page=PagesService.pagesMap[id],children=PagesService.pagesChildrenMap[id];if(search(page.name,$scope.searchFor))return!0;if(children)for(i=0;i<children.length;i++)if(recursiveSearch(children[i]))return!0;return!1},search=function(where,what){return where.toLocaleLowerCase().indexOf(what.toLocaleLowerCase())!==-1};$scope.tree=PagesService.pagesTree.nodes,$scope.focused=!1,$scope.searchFor="",$scope.filterSearch={id:null},$scope.minimized={},$scope.isHost=UsabilityTestService.isSession()&&UsabilityTestService.isHostSession(),$scope.isSitemapAvailable=UsabilityTestService.isSession()&&UsabilityTestService.getMyData().settings[LiveShare.enums.ROOM_SETTINGS.SEE_SITEMAP],$scope.isMessageVisible=!0,$scope.message="Waiting for participant",UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.OPTIONS_CHANGED,function(data){data.key===LiveShare.enums.ROOM_SETTINGS.SEE_SITEMAP&&$scope.$apply(function(){$scope.isSitemapAvailable=data.val})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,function(){$scope.$apply(function(){$scope.isMessageVisible=!0,$scope.message="Waiting for participant"})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.TESTER_JOINED,function(){$scope.$apply(function(){$scope.isMessageVisible=!0,$scope.message="Waiting for participant to allow Camera access"})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.VIDEO_PARTICIPANT_JOINED,function(){$scope.$apply(function(){$scope.isMessageVisible=!1,$scope.message=""})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.VIDEO_PARTICIPANT_LEFT,function(){$scope.$apply(function(){$scope.isMessageVisible=!0,$scope.message="Waiting for participant"})});var resetSitemap=function(){return PagesService.getPages().then(function(){var d=$q.defer();return $scope.tree=PagesService.pagesTree.nodes,d.resolve(),d.promise})};editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_CREATE,resetSitemap),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_UPDATE,resetSitemap),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_REORDER,resetSitemap),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_DELETE,function(){resetSitemap().then(function(){"undefined"==typeof PagesService.pagesMap[PagesService.currentPageId]&&$scope.onClick(null,PagesService.rootPageId)})})}]),angular.module("core").controller("UsabilityTestIntroductionController",["$rootScope","$scope","$sce","$filter","$modalInstance","UsabilityTestService","ProjectsService",function($rootScope,$scope,$sce,$filter,$modalInstance,UsabilityTestService,ProjectsService){"use strict";function formatNewLines(string){return $sce.trustAsHtml($filter("newLine")(string))}var testData=UsabilityTestService.getTestData();$scope.params={projectName:ProjectsService.currentProjectName,introduction:formatNewLines(angular.copy(testData.meta.introduction)),agreement:!1,activeStep:1,answerVideo:!1,blockVideo:!1},$scope.isActiveStep=function(number){return $scope.params.activeStep===number},$scope.onClickNextStep=function(number){$scope.params.activeStep=number},$scope.onClickStartSession=function(){var modalBoxWrapper=document.getElementById("modalBoxWrapper");$modalInstance.close(),document.body.removeChild(modalBoxWrapper),UsabilityTestService.startSession(LiveShare.enums.USER_TYPES.TESTER)},$scope.$on("$destroy",function(){onAllowCamera()});var onAllowCamera=$rootScope.$on(PreviewEnums.MEDIA_ACCESS,function(e,value){$scope.$apply(function(){$scope.params.answerVideo=!0,$scope.params.blockVideo=PreviewEnums.MEDIA_ACCESS_TYPE.DENIED===value})})}]),angular.module("core").controller("UsabilityTestTasksController",["$scope","$sce","$filter","UsabilityTestService",function($scope,$sce,$filter,UsabilityTestService){"use strict";function formatNewLines(string){if(!string||"string"!=typeof string)throw new TypeError("String param required");return $sce.trustAsHtml($filter("newLine")(string))}function formatTasks(tasksCollection){function formatTask(task){return task.content=formatNewLines(task.content),task}return Array.isArray(tasksCollection)?tasksCollection.map(function(task){return formatTask(task)}):formatTask(tasksCollection)}var EVENTS=LiveShare.enums.EVENTS,ROOM_SETTINGS=LiveShare.enums.ROOM_SETTINGS;UsabilityTestService.registerObserverCallback(EVENTS.UPDATE_TASKS,function(tasks){$scope.$apply(function(){$scope.params.tasks=formatTasks(tasks)})}),$scope.isResolveButton=UsabilityTestService.getMyData().settings[ROOM_SETTINGS.CAN_CLOSE_TASKS],UsabilityTestService.registerObserverCallback(EVENTS.OPTIONS_CHANGED,function(data){data.key===ROOM_SETTINGS.CAN_CLOSE_TASKS&&$scope.$apply(function(){$scope.isResolveButton=data.val})}),UsabilityTestService.fetch().then(function(data){$scope.params={tasks:formatTasks(angular.copy(data.meta.tasks))}}),$scope.onClickResolveTask=function($event,task){$event.preventDefault(),UsabilityTestService.resolveTask(task.id)},UsabilityTestService.isHostSession()&&UsabilityTestService.startSession(LiveShare.enums.USER_TYPES.HOST)}]),angular.module("core").controller("UsabilityTestWizardController",["$q","_","$scope","$rootScope","$state","$timeout","$translate","$stateParams","UsabilityTestService","PagesService","ProjectsService","BreakpointsService","UsersService","animate",function($q,_,$scope,$rootScope,$state,$timeout,$translate,$stateParams,UsabilityTestService,PagesService,ProjectsService,BreakpointsService,UsersService,animate){"use strict";var newTaskTitleInput;$scope.forms={},$scope.params={loading:!1,projectName:ProjectsService.currentProjectName,activeStepIndex:0,steps:[{breadcrumbs:!0,label:"Introduction",introduction:""},{breadcrumbs:!0,label:"Tasks",tasks:[],newTask:{title:"",content:""},onStart:function(){setFocusToNewTaskTitle()}},{breadcrumbs:!0,label:"Settings",options:[],breakpoints:{name:"Display selected breakpoints",enabled:!1,list:PagesService.getCurrentPageBreakpoints().map(function(breakpoint){return breakpoint.value=0,breakpoint})}},{breadcrumbs:!0,label:"Participant",inviteURL:"",onStart:function(){var step=$scope.getStep(3);step.inviteURL||UsabilityTestService.makeRoomReservation().then(function(){step.inviteURL=UsabilityTestService.getInviteURL()})}},{breadcrumbs:!1,label:"Finish"}]},$translate("UT_INTRODUCTION_TEXT").then(function(UT_INTRODUCTION_TEXT){$scope.params.steps[0].introduction=UT_INTRODUCTION_TEXT}),UsabilityTestService.getConfigurationOptions().then(function(options){$scope.getStep(2).options=options}.bind(this)),$scope.getStepsWithBreadcrumbs=function(){return _.filter($scope.params.steps,"breadcrumbs")},$scope.getStep=function(index){var value;if(value="next"===index?$scope.params.steps[$scope.params.activeStepIndex+1]:"prev"===index?$scope.params.steps[$scope.params.activeStepIndex-1]:"undefined"!=typeof index?$scope.params.steps[index]:$scope.params.steps[$scope.params.activeStepIndex],!value)throw new RangeError('"'+index+'" is out of range');return value},$scope.getStepFormObject=function(index){return"undefined"==typeof index?$scope.forms["step"+$scope.params.activeStepIndex]:$scope.forms["step"+index]},$scope.isActiveStep=function(stepIndex){if("undefined"==typeof stepIndex)throw new TypeError("stepIndex argument is required.");return $scope.params.activeStepIndex===stepIndex},$scope.onClickNextStep=function(){var breakpoints=$scope.getStep().breakpoints;breakpoints&&breakpoints.enabled&&breakpoints.list&&checkIfCurrentBreakpointIsLocked(breakpoints.list,PagesService.currentBreakpointId)&&PagesService.setCurrentBreakpointId(getFirstUnlockedBreakpointId(breakpoints.list)),goToStep($scope.params.activeStepIndex+2)},$scope.onClickPrevStep=function(){goToStep($scope.params.activeStepIndex)},$scope.onClickAddNewTask=function(model){$scope.getStep(1).tasks.push(angular.copy(model)),model.title="",model.content="",scrollTaskListToBottom(),setFocusToNewTaskTitle()},$scope.onClickDeleteTask=function($event,$index){var DELETING_ANIMATION_DURATION=300,step=$scope.getStep(1);$event.preventDefault(),"number"==typeof $index?(step.tasks[$index].deleting=!0,$timeout(function(){step.tasks.splice($index,1)},DELETING_ANIMATION_DURATION)):step.tasks.length?($index=step.tasks.length-1,step.tasks[$index].deleting=!0,step.newTask.title=step.tasks[$index].title,step.newTask.content=step.tasks[$index].content,$timeout(function(){step.tasks.splice($index,1)},DELETING_ANIMATION_DURATION)):(step.newTask.title="",step.newTask.content="")};var scrollTaskListToBottom=function(){var contentWrapper=document.querySelector("#wizard-content"),ANIM_DURATION=(contentWrapper.scrollTop,contentWrapper.scrollHeight,1);animate(contentWrapper,ANIM_DURATION,{scrollTop:contentWrapper.scrollHeight-contentWrapper.scrollTop+contentWrapper.scrollTop})},setFocusToNewTaskTitle=function(){newTaskTitleInput||(newTaskTitleInput=document.getElementById("new-task-title")),newTaskTitleInput.focus()};$scope.onClickInput=function($event){$event.target.select()},$scope.onClickCopy=function($event){var COPY_MESSAGE_HIDE_DELAY=1e3;$event.preventDefault(),$scope.params.isCopied=!0,$timeout(function(){$scope.params.isCopied=!1},COPY_MESSAGE_HIDE_DELAY)};var getConfigurationOptions=function(){var options=[];return $scope.getStep(2).options.forEach(function(option){option.value&&options.push(option.param)}),options.join(",")};$scope.onClickSessionStart=function(){UsabilityTestService.startInitializing({testData:getStepsData(),options:getConfigurationOptions()})},$scope.$on("destroy",function(){onStateChangeSuccess()});var checkIfCurrentBreakpointIsLocked=function(breakpoints,breakpointId){var locked=!1;return _.forEach(breakpoints,function(breakpoint){if(breakpoint.id===breakpointId&&!breakpoint.value)return locked=!0,!1}),locked},getFirstUnlockedBreakpointId=function(breakpoints){var breakpointId=null;return _.forEach(breakpoints,function(breakpoint){if(breakpoint.value)return breakpointId=breakpoint.id,!1}),breakpointId},goToStep=function(stepNumber){$scope.params.activeStepIndex!==stepNumber-1&&$state.go("home.page.usability-test",_.extend($stateParams,{step:stepNumber,pageId:PagesService.getPageByBreakpoint($stateParams.pageId)}))},onStateChangeSuccess=$rootScope.$on("$stateChangeSuccess",function(e,toState,toParams){if($state.includes("**.usability-test.**")){var currentStepIndex=parseInt(toParams.step,10)-1;if(!isNaN(currentStepIndex)){$scope.params.activeStepIndex=currentStepIndex||0;var step=$scope.getStep();"function"==typeof step.onStart&&$timeout(step.onStart,100)}}}),getStepsData=function(){return{meta:{introduction:angular.copy($scope.getStep(0).introduction),tasks:function(){var step=$scope.getStep(1),tasks=angular.copy(step.tasks);return step.newTask.title.trim()&&step.newTask.content.trim()&&tasks.push(angular.copy(step.newTask)),tasks.map(function(task,index){return task.id=index+1,task})}()},user:{id:UsersService.me.id_user,is_trial:UsersService.me.is_trial},settings:function(){var options=[];return $scope.getStep(2).options.forEach(function(option){option.value&&options.push({param:option.param})}),options}(),project:{hash:ProjectsService.currentProjectHash,available_breakpoints:function(){var breakpoints=$scope.getStep(2).breakpoints;if(breakpoints.enabled&&breakpoints.list){var available=[];return breakpoints.list.forEach(function(breakpoint){breakpoint.value&&available.push({id:breakpoint.id})}),available}return null}()}}}}]),angular.module("core").directive("previewCloud",function($document){"use strict";var ACTIVE_CLASS="active",VISIBLE_CLASS="visible",CLOUD_CLASS="cloud",PreviewCloud=function($scope,$element){this.$scope=$scope,this.$element=$element,this.eventRefs={},this.cloudEl=$element[0].querySelector("."+CLOUD_CLASS)};return PreviewCloud.prototype.start=function(){angular.element(this.$element[0].querySelector("[preview-cloud-trigger]")).on("click",this.onClickToggle.bind(this)),this.$scope.$watch("previewCloud",function(value){value?this.open():this.close()}.bind(this))},PreviewCloud.prototype.open=function(){this.$element[0].classList.add(ACTIVE_CLASS),this.cloudEl.classList.add(VISIBLE_CLASS),this.attachEvents()},PreviewCloud.prototype.close=function(){this.$element[0].classList.remove(ACTIVE_CLASS),this.cloudEl.classList.remove(VISIBLE_CLASS),this.detachEvents()},PreviewCloud.prototype.clickOnDocument=function(e){e.target===this.$element[0]||this.$element[0].contains(e.target)||this.toggle(!1)},PreviewCloud.prototype.keyDown=function(e){27===e.keyCode&&this.toggle(!1)},PreviewCloud.prototype.attachEvents=function(){this.eventRefs.clickOnDocument=this.clickOnDocument.bind(this),this.eventRefs.keyDown=this.keyDown.bind(this),$document.on("click",this.eventRefs.clickOnDocument),$document.on("keydown",this.eventRefs.keyDown)},PreviewCloud.prototype.detachEvents=function(){$document.off("click",this.eventRefs.clickOnDocument),$document.off("keydown",this.eventRefs.keyDown)},PreviewCloud.prototype.onClickToggle=function(){this.toggle()},PreviewCloud.prototype.toggle=function(isOpen){var value=!this.$scope.previewCloud;
"undefined"!=typeof isOpen&&(value=!!isOpen),this.$scope.$apply(function(){this.$scope.previewCloud=value}.bind(this))},{restrict:"A",scope:{previewCloud:"=?"},link:function(scope,element){var previewCloud=new PreviewCloud(scope,element);previewCloud.start()}}}),angular.module("core").directive("addComment",[function(){"use strict";var isChildOf=function(childElement,parentClass){for(;childElement.parentNode&&"#document"!==childElement.parentNode.nodeName;){if(childElement.parentNode.classList&&childElement.parentNode.classList.contains(parentClass))return!0;childElement=childElement.parentNode}return!1};return{restrict:"A",scope:!1,link:function(scope,element){var isValidCommentLocation=function(e){return!isChildOf(e.target,PreviewEnums.COMMENT_POINT_CLASS)};element.on("click",function(e){scope.commentMode&&isValidCommentLocation(e)&&(scope.onAddCommentClick(e),e.stopPropagation())})}}}]),angular.module("core").directive("adjustToViewportSize",function($timeout,$rootScope,$window,animate,LayoutStates){"use strict";return{restrict:"A",scope:{},link:function(scope,element,attrs){var ANIM_EASE="easeInOutPower2",ANIM_TIME=.01,NO_TIME=0,PANEL_WIDTH=326,SIDEBAR_WIDTH=100,rawElement=element[0],isPanelVisible=LayoutStates.isPanelVisible(),isToolbarVisible=LayoutStates.isToolbarVisible(),isNoToolbarMode=LayoutStates.isNoToolbarMode(),isUsabilityTestRunning=LayoutStates.getStateById("isUserTestingSession"),isLiveShareSession=LayoutStates.getStateById("isLiveShareSession"),isHostSession=LayoutStates.getStateById("isHostSession"),adjustWidth=function(instant){var width,time=instant===!0?NO_TIME:ANIM_TIME,browserWidth=$window.innerWidth;isNoToolbarMode?width=browserWidth:isUsabilityTestRunning&&isHostSession?width=browserWidth-SIDEBAR_WIDTH-PANEL_WIDTH:isUsabilityTestRunning&&!isHostSession?width=browserWidth-PANEL_WIDTH:!isToolbarVisible&&isPanelVisible?width=browserWidth:isToolbarVisible||isPanelVisible?isToolbarVisible&&isPanelVisible?width=browserWidth-SIDEBAR_WIDTH-PANEL_WIDTH:isToolbarVisible&&!isPanelVisible&&(width=browserWidth-SIDEBAR_WIDTH):width=browserWidth,animate(rawElement,time,{ease:ANIM_EASE,width:width})};adjustWidth(!0),angular.element($window).bind("resize",function(){adjustWidth(!0),scope.$digest()}),scope.$watch(function(){return LayoutStates.isPanelVisible()+LayoutStates.isToolbarVisible()+LayoutStates.isNoToolbarMode()+LayoutStates.getStateById("isLiveShareSession")+LayoutStates.getStateById("isUserTestingSession")+LayoutStates.getStateById("isHostSession")},function(newVal,oldVal){newVal!==oldVal&&(isPanelVisible=LayoutStates.isPanelVisible(),isToolbarVisible=LayoutStates.isToolbarVisible(),isNoToolbarMode=LayoutStates.isNoToolbarMode(),isUsabilityTestRunning=LayoutStates.getStateById("isUserTestingSession"),isHostSession=LayoutStates.getStateById("isHostSession"),isLiveShareSession=LayoutStates.getStateById("isLiveShareSession"),adjustWidth())})}}}),angular.module("core").directive("onKeydown",function(){"use strict";return{restrict:"A",link:function(scope,elem,attrs){var functionToCall=scope.$eval(attrs.onKeydown);elem.on("keydown",function(e){functionToCall(e.which)})}}}),angular.module("core").directive("captureVideo",["$rootScope","$timeout",function($rootScope,$timeout){"use strict";navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var link=function($scope,$element,attrs){var localMediaStream,video=$element[0];attrs.width&&($element.width=attrs.width),attrs.height&&($element.height=attrs.height),$element.on("$destroy",function(){localMediaStream&&(localMediaStream.stop(),video.src="")}),navigator.getUserMedia&&navigator.getUserMedia({video:!0,audio:!0},function(stream){localMediaStream=stream,video.src=window.URL.createObjectURL(stream),$rootScope.$emit(PreviewEnums.MEDIA_ACCESS,PreviewEnums.MEDIA_ACCESS_TYPE.ALLOWED)},function(err){window.console.error(err.stack),$rootScope.$emit(PreviewEnums.MEDIA_ACCESS,PreviewEnums.MEDIA_ACCESS_TYPE.DENIED)})};return{restrict:"E",replace:!0,template:"<video autoplay></video>",link:link}}]),angular.module("core").directive("clickOutside",["$compile","$document",function($compile,$document){"use strict";var ClickOutside=function(scope,element){this._scope=scope,this._element=element,this._eventsRef={},this.attachEvents()};ClickOutside.prototype.attachEvents=function(){this._eventsRef.onClick=this.clickOutside.bind(this),document.addEventListener("click",this._eventsRef.onClick),this._element.on("$destroy",function(){this.detachEvents()}.bind(this))},ClickOutside.prototype.detachEvents=function(){document.removeEventListener("click",this._eventsRef.onClick)},ClickOutside.prototype.clickOutside=function(e){e.target===this._element[0]||this._element[0].contains(e.target)||this._scope.callback()};var link=function(scope,element,attrs){new ClickOutside(scope,element)};return{restrict:"A",scope:{callback:"&"},link:link}}]),angular.module("core").directive("compile",["$compile",function($compile){"use strict";var link=function(scope,element,attrs){scope.$watch("content",function(value){element.html(value),$compile(element.contents())(scope)})};return{restrict:"A",scope:{content:"="},link:link}}]),angular.module("core").directive("highlight",["$compile",function($compile){"use strict";var comparatorSearch=function(search,comment){return!(!comment||!search)&&comment.toLocaleLowerCase().indexOf(search.toLocaleLowerCase())!==-1},highlight=function(search,comment){return"string"==typeof comment&&(comment=comment.replace(/&#10;/g,"<br>").replace(/\n/g,"<br>")),comparatorSearch(search,comment)?comment.replace(new RegExp(search,"gi"),function(match){return'<span class="highlight">'+match+"</span>"}):comment},link=function(scope,element,attrs){scope.$watch("inputText",function(value){element.html(highlight(scope.searchFor,value)),$compile(element.contents())(scope)}),scope.$watch("searchFor",function(value){element.html(highlight(value,scope.inputText)),$compile(element.contents())(scope)})};return{restrict:"A",scope:{inputText:"=",searchFor:"="},link:link}}]),angular.module("core").directive("script",[function(){"use strict";var link=function(scope,element,attrs){if("text/javascript"===attrs.type&&"1"===attrs.evaluate){var code=element.text(),re=/(window.location.href)(\s*=\s*)([\w]+((\.)?[\w]+)*)/gim,subst="Preview.gotoPage($3)",codeParsed=code.replace(re,subst),f=new Function(codeParsed);f()}};return{restrict:"E",scope:!1,link:link}}]),angular.module("core").directive("syncFocusWith",function($timeout,$rootScope){"use strict";return{restrict:"A",scope:{focusValue:"=syncFocusWith"},link:function($scope,$element,attrs){$scope.$watch("focusValue",function(currentValue,previousValue){currentValue!==!0||previousValue?currentValue===!1&&previousValue&&$element[0].blur():$element[0].focus()})}}}),angular.module("core").directive("timeCounter",["moment",function(moment){"use strict";function startCounting(from){interval=setInterval(function(){var diff=moment(new Date).diff(moment(startTime));element.textContent=moment(diff).format("mm:ss")},1e3)}function stopCounting(){clearInterval(interval)}var startTime,element,interval,link=function($scope,$element,attrs){if(element=$element[0],attrs["class"]&&(element.className=attrs["class"]),!attrs.startTime)throw new Error("start-time attribute is required");startTime=attrs.startTime,startCounting(),$element.on("$destroy",function(){stopCounting()})};return{restrict:"E",replace:!0,template:"<time></time>",link:link}}]),angular.module("core").directive("toggleVisibility",function($timeout,$rootScope,animate,Engine){"use strict";return{restrict:"A",scope:{toggleFlag:"=",toggleWidthOpen:"@",toggleWidthClosed:"@"},link:function(scope,element,attrs){var ANIM_EASE="easeInOutPower2",ANIM_TIME=.01,rawElement=element[0],toggle=function(){scope.toggleFlag?animate(rawElement,ANIM_TIME,{ease:ANIM_EASE,width:parseInt(scope.toggleWidthOpen),onComplete:function(){rawElement.style.overflow="visible",Engine.updateOffset()},onUpdate:function(){Engine.updateOffset()}}):(rawElement.style.overflow="hidden",animate(rawElement,ANIM_TIME,{ease:ANIM_EASE,width:parseInt(scope.toggleWidthClosed),onComplete:function(){Engine.updateOffset()},onUpdate:function(){Engine.updateOffset()}}))};scope.$watch("toggleFlag",function(newVal,oldVal){newVal!==oldVal&&toggle()})}}}),angular.module("core").directive("toggleable",["$document",function($document){"use strict";var opened=[],Toggleable=function(scope,element){this._scope=scope,this._element=element,this.applyVisibility()};Toggleable.prototype.isOpen=function(){return this._scope.isOpen()},Toggleable.prototype.toggle=function(e){this._scope.toggle(e),this.applyVisibility()},Toggleable.prototype.hide=function(e){this._scope.hide(e),this.applyVisibility()},Toggleable.prototype.getElement=function(){return"string"==typeof this._scope.toggleElement?document.querySelector(this._scope.toggleElement):"function"==typeof this._scope.toggleElement?this._scope.toggleElement():this._element[0]},Toggleable.prototype.getPreventHideElements=function(){var elements=[];return"function"==typeof this._scope.getPreventHideElements&&(elements=this._scope.getPreventHideElements()),elements},Toggleable.prototype.applyVisibility=function(){var index=opened.indexOf(this);this.isOpen()&&index===-1?opened.push(this):!this.isOpen()&&index>-1&&opened.splice(index,1)},document.addEventListener("click",function(e){var toggleable,element,preventHideElements,i,notContainsTarget=function(el){return el!==e.target&&!el.contains(e.target)};for(i=opened.length-1;i>=0;i--)if(toggleable=opened[i],element=toggleable.getElement(),preventHideElements=toggleable.getPreventHideElements(),toggleable.isOpen()&&toggleable._element[0]!==e.target&&"undefined"!=typeof element&&element!==e.target&&!element.contains(e.target)&&preventHideElements.every(notContainsTarget)){toggleable.hide(e),e.stopPropagation();break}},!0);var link=function(scope,element){var el=new Toggleable(scope,element);element.on("click",function(e){el.toggle(e)})};return{restrict:"A",link:link}}]),function(global){"use strict";var PreviewEnums=function(){return{PIN_RADIUS:14,COMMENT_FORM_DELTA_X:40,COMMENT_FORM_DELTA_Y:-5,SHOW_RESOLVED_TIMEOUT:5e3,UNDO_TIMEOUT:6e3,ADD_COMMENT:"addComment",COMMENT_POINT_CLASS:"comment-point",ADDING_COMMENT:"addingComment",SELECT_COMMENT:"selectComment",RESOLVE_COMMENT:"resolveComment",DELETING_COMMENT:"deletingComment",DELETE_COMMENT:"deleteComment",REPLYING_COMMENT:"replyingComment",DRAGGING_COMMENT:"draggingComment",SORT_COMMENTS:"sortComments",LOADING_COMMENTS:"loadingComments",ON_CHANGE_PAGE:"onChangePage",NAVIGATE_HISTORY_BACK:"navigateHistoryBack",NAVIGATE_TO_PAGE:"navigateToPage",ON_CONTENT_LOADED:"onContentLoaded",ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED:"onShowCommentsResolvedSettingsChanged",ON_MODE_CHANGED:"onModeChanged",LOADING:"loading",MEDIA_ACCESS:"mediaAccess",SET_ANONYMOUS_NAME:"setAnonymousName",ANONYMOUS_ADD_COMMENT:"anonymousAddComment",ON_CHANGE_NOTIFICATIONS:"onChangeNotifications",ON_NOTIFICATIONS_UPDATE:"onNotificationsUpdate",ON_SHOW_MENTIONS_LIST:"onShowMentionsList",SELECT_MENTIONS_LIST:"selectMentionsList",SEARCH_MENTIONS_LIST:"searchMentionsList",ON_SELECT_MENTIONS_LIST:"onSelectMentionsList",ON_HIDE_MENTIONS_LIST:"onHideMentionsList",ON_UPDATE_MENTIONS_LIST_POSITION:"onUpdateMentionsListPosition",ON_COMMENT_TYPE_UPDATE:"onCommentTypeUpdate",ON_COMMENT_EDIT:"onCommentEdit",ON_COMMENT_EDIT_EXIT:"onCommentEditExit",ON_COMMENT_CONTENT_UPDATE:"onCommentContentUpdate",ON_APP_VIEW_PROMO_CLOSE:"appViewPromoClose",ON_COMMENTS_FILTER_CHANGE:"onCommentsFilterChange",APP_VIEW_PROMO_VIEWED:"appViewPromoViewed",COMMENT_NOTIFY_ALL:2,COMMENT_NOTIFY_NONE:0,COMMENT_NOTIFY_CHOSEN:1,MEDIA_ACCESS_TYPE:{REQUEST:"request",ALLOWED:"allowed",DENIED:"denied"},SOCKET:{ON_CHANGE_PROPERTIES:"changeProperties",ON_DELETE_COMPONENT:"deleteComponent",ON_PAGE_CREATE:"addNewPage",ON_PAGE_UPDATE:"updatePage",ON_PAGE_DELETE:"deletePage",ON_PAGE_REORDER:"savePagesOrder",ON_COMMENT_CREATE:"createComment",ON_COMMENT_UPDATE:"updateComment",ON_COMMENT_DELETE:"deleteComment",ON_COMMENT_TYPE_UPDATE:"commentTypeUpdate",ON_COMMENT_CONTENT_UPDATE:"commentContentUpdate"},KM_EVENTS:{DELETE_UNDONE:"Preview - comments - delete undone",VIEW_MODE_SET:"Preview - Comments - View mode set",EDITED_COMMENTS:"Preview - Comments - Edited comments",COMMENT_ADDED:"Preview - Comments - Comment added",COMMENT_TYPE_CHANGED:"Preview - Comments - Comment type changed",NOTIFICATION_CHANGED:"Preview - Comments - Notification changed"}}}();global.PreviewEnums=PreviewEnums}(window),angular.module("core").filter("hexToRgba",function(){"use strict";return function(hex,alpha){if(!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(hex))return window.console.error("Invalid hex color "+hex),hex;var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,newHex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b}),result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(newHex);if(result){var rgba=[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16),alpha];return"rgba("+rgba.join(",")+")"}return window.console.error("Cannot parse hex "+hex+" to rgb"),hex}}),angular.module("core").filter("moment",function(){"use strict";return function(dateString,format){return moment(dateString).format(format)}}),angular.module("core").filter("momentFromNow",function(){"use strict";return function(dateString){return moment(dateString).fromNow()}}),angular.module("core").filter("newLine",function(){"use strict";return function(text){return text.replace(/\n/g,"<br/>")}}),function(){"use strict";function notifyLabel(){return function(input,filters){switch(!0){case filters.all:return"All";case filters.none:return"None";case filters.projectMembers:return"Project members";case 1===input:return"1 person";default:return input+" people"}}}angular.module("core").filter("notifyLabel",notifyLabel)}(),angular.module("core").filter("simpleMarkdown",function(){"use strict";function parseEmail(text){var pattern=/\[(.*?)\]\(mailto:(.*?)\)/g;return text.replace(pattern,'<a class="md-email" href="mailto:$2">$1</a>')}return function(text){return parseEmail(text)}}),angular.module("core").factory("CommentsHelper",[function(){"use strict";return{getDiscussionRootCommentId:function(comment){return comment._parent_comment?comment._parent_comment:comment._id},stripText:function(text){return text.replace(/(<([^>]+)>)/gi,"")},encodeMentions:function(text){var pattern=/\[(.*?)\]\(mailto:(.*?)\)/g,matches=text.match(pattern);if(matches){matches.forEach(function(string){text=text.replace(string,encodeURIComponent(string))})}return text},decodeMentions:function(text){var pattern=/%5B(.*?)%5D\(mailto%3A(.*?)\)/g,matches=text.match(pattern);if(matches){matches.forEach(function(string){text=text.replace(string,decodeURIComponent(string))})}return text}}}]),function(){"use strict";function deviceDetectorHelper(_,localStorageService){var ua=new UAParser(navigator.userAgent);return _.extend(ua,{isAppViewAvailable:function(){var uaData=this.getResult();return"iOS"===uaData.os.name&&"Mobile Safari"===uaData.browser.name?!window.navigator.standalone&&!localStorageService.get(PreviewEnums.APP_VIEW_PROMO_VIEWED):"Android"===uaData.os.name&&"Chrome"===uaData.browser.name&&!localStorageService.get(PreviewEnums.APP_VIEW_PROMO_VIEWED)},isMac:function(){var uaData=this.getResult();return"Mac OS"===uaData.os.name}})}angular.module("core").factory("deviceDetectorHelper",deviceDetectorHelper),deviceDetectorHelper.$inject=["_","localStorageService"]}(),angular.module("core").factory("NotificationsHelper",["$cookies",function($cookies){"use strict";var getArrayForMap=function(map){var arr=[];return _.forEach(map,function(value,key){value&&arr.push(key)}),arr},notifySelectionCookieName="notifyselection";return{getNotificationsForComment:function(commentId,collaboratorsMap,collaboratorEmails,notifications){var arr=[],map={},notification=notifications[commentId];return _.each(collaboratorsMap,function(collaborator){arr.push({id:collaborator.id_user,name:collaborator.name,email:collaborator.email,avatar:collaborator.avatar,isOwner:collaborator.is_owner}),map[collaborator.email]=!0}),notification&&_.each(notification.emails,function(email){map[email.email]||(arr.push(this.getNotificationObjectForEmail(email.email)),map[email.email]=!0)}.bind(this)),_.forEach(this.getGuestEmails(collaboratorEmails,notifications),function(email){email&&!map[email]&&(arr.push(this.getNotificationObjectForEmail(email)),map[email]=!0)}.bind(this)),arr.sort(function(a,b){var a_name=(a.name||a.email).toLowerCase(),b_name=(b.name||b.email).toLowerCase();return a_name<b_name?-1:a_name>b_name?1:0})},getNotificationObjectForEmail:function(email){return{name:email,email:email,id:MD5(email)}},getSelectedEmails:function(commentId,collaboratorsMap,notifications){var emails=[],isNew=!commentId,notification=notifications[commentId],isEmpty=!notification;return isNew||isEmpty?emails=this.remindSelection()||this.getDefaultSelectedEmails(collaboratorsMap):_.forEach(notification.emails,function(email){emails.push(email.email)}),emails},getDefaultSelectedEmails:function(collaboratorsMap){var emails=[];return _.each(collaboratorsMap,function(collaborator){collaborator.is_owner&&emails.push(collaborator.email)}),emails},getNumberOfSelectedNotifications:function(notifications){return _.filter(notifications,function(notification){return notification}).length},getAddedNotifications:function(old,updated){var o=getArrayForMap(old),u=getArrayForMap(updated);return _.difference(_.union(o,u),o)},getRemovedNotifications:function(old,updated){var o=getArrayForMap(old),u=getArrayForMap(updated);return _.difference(_.union(o,u),u)},getGuestEmails:function(collaboratorEmails,notifications){var emails=[];return _.forEach(notifications,function(notification){_.forEach(notification.emails,function(email){collaboratorEmails.indexOf(email.email)===-1&&emails.push(email.email)})}),emails},formatNotify:function(notifications,mentions){var map={};return _.forEach(notifications,function(notification){map[notification]={email:notification,is_mention:0}}),_.forEach(mentions,function(mention){mention.email&&(map[mention.email]?map[mention.email].is_mention=1:map[mention.email]={email:mention.email,is_mention:1})}),_.toArray(map)},rememberSelection:function(selection){$cookies[notifySelectionCookieName]=JSON.stringify(selection)},remindSelection:function(){var cookie=$cookies[notifySelectionCookieName];return"undefined"===cookie||_.isEmpty(cookie)||(cookie=JSON.parse(cookie)),_.isArray(cookie)?cookie:null}}}]),angular.module("core").factory("ValidationHelper",[function(){"use strict";return{isEmail:function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)}}}]),function(){"use strict";function pvScrollToBottom($parse){function link(scope,el,attrs){function onScroll(){var scrollOnBottom=isScrollOnBottom();scope.$apply(function(){model.assign(scope,scrollOnBottom),scrollOnBottom||el.off("scroll",onScroll)})}function isScrollOnBottom(){return el[0].scrollTop>0&&el[0].scrollHeight-el[0].scrollTop===el[0].clientHeight}var model=$parse(attrs.pvScrollToBottom);scope.$watch(model,function(value){value&&(el[0].scrollTop=el[0].scrollHeight,el.on("scroll",onScroll))})}return{restrict:"A",link:link}}angular.module("core").directive("pvScrollToBottom",pvScrollToBottom),pvScrollToBottom.$inject=["$parse"]}(),angular.module("core").factory("ChromeExtensionService",[function(){"use strict";function checkInstallation(){"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage(window.ApplicationConfiguration.extension.id,window.ApplicationConfiguration,function(response){response&&(window.ApplicationConfiguration.extension.isInstalled=!0,connect())})}function connect(){"undefined"!=typeof chrome&&chrome.runtime&&(port=chrome.runtime.connect(window.ApplicationConfiguration.extension.id)),port&&(port.postMessage(window.ApplicationConfiguration),port.onMessage.addListener(onMessage),isConnected=!0,port.onDisconnect.addListener(function(){isConnected=!1,setTimeout(connect,1e3)}))}function onMessage(data){nsp.log("Chrome extension message",data),listeners.forEach(function(cb){nsp.count("Fired chrome extension callback"),cb(data)})}var port,isConnected=!1,listeners=[],nsp=window.CHROME_EXTENSION;return connect(),{onMessage:function(callback){if(!isConnected)throw new Error("Chrome extension is disconnected");nsp.count("ChromeExtension add listener"),listeners.push(callback)},postMessage:function(message){if(!isConnected)throw new Error("Chrome extension is disconnected");port.postMessage(message)},isConnected:function(){return isConnected},isInstalled:function(){return window.ApplicationConfiguration.extension.isInstalled},recheckInstallation:function(){this.isInstalled()||checkInstallation()}}}]),function(){"use strict";function CommentsFilter(CommentsSettings){function canDisplayComment(comment){var commentFilter=CommentsSettings.getLastUsedCommentsFilter();switch(commentFilter){case FILTERS.PUBLIC_COMMENTS:return isPublic(comment);case FILTERS.TEAM_COMMENTS:return isTeam(comment);case FILTERS.HIDE_ALL:return!1;default:return!0}}function isPublic(comment){return!comment.type||comment.type===COMMENT_TYPES.PUBLIC}function isTeam(comment){return comment.type===COMMENT_TYPES.TEAM}var COMMENT_TYPES=CommentsSettings.commentTypes,FILTERS=CommentsSettings.commentsFilters;return{canDisplayComment:canDisplayComment}}angular.module("core").factory("CommentsFilter",CommentsFilter),CommentsFilter.$inject=["CommentsSettings"]}(),function(){"use strict";function CommentsSettings($rootScope,UsersService,FeatureToggler,localStorageService,AnalyticsService){function commentTypesActive(){return FeatureToggler.teamComments&&UsersService.isInProjectsAccount()&&!UsersService.isAnonymous()}function getCommentTypeOptions(){return UsersService.isAnonymous()?_.filter(COMMENT_TYPE_OPTIONS,function(option){return option.value!==COMMENT_TYPES.TEAM}):COMMENT_TYPE_OPTIONS}function getCommentsFilterOptions(){return commentTypesActive()?COMMENTS_FILTER_OPTIONS:_.filter(COMMENTS_FILTER_OPTIONS,function(option){return option.value!==COMMENTS_FILTERS.TEAM_COMMENTS&&option.value!==COMMENTS_FILTERS.PUBLIC_COMMENTS})}function getLastUsedCommentsFilter(){var storageKey=getCommentFilterStorageKey();return localStorageService.get(storageKey)}function setLastUsedCommentsFilter(commentsFilter){var storageKey=getCommentFilterStorageKey();localStorageService.set(storageKey,commentsFilter),$rootScope.$emit(PreviewEnums.ON_COMMENTS_FILTER_CHANGE,commentsFilter),AnalyticsService.event(PreviewEnums.KM_EVENTS.VIEW_MODE_SET,{"Type of View Mode":_.find(COMMENTS_FILTER_OPTIONS,{value:commentsFilter}).text})}function getLastUsedCommentType(){return localStorageService.get(STORAGE_KEYS.LAST_USED_COMMENT_TYPE)}function setLastUsedCommentType(commentType){localStorageService.set(STORAGE_KEYS.LAST_USED_COMMENT_TYPE,commentType)}function getCommentFilterStorageKey(){return commentTypesActive()?STORAGE_KEYS.LAST_USED_COMMENTS_FILTER:STORAGE_KEYS.LAST_USED_PUBLIC_COMMENTS_FILTER}var COMMENTS_FILTERS={ALL_COMMENTS:"allComments",PUBLIC_COMMENTS:"publicComments",TEAM_COMMENTS:"teamComments",HIDE_ALL:"hideAll"},COMMENT_TYPES={TEAM:"team",PUBLIC:"public"},STORAGE_KEYS={LAST_USED_COMMENTS_FILTER:"lastUsedCommentsFilter",LAST_USED_PUBLIC_COMMENTS_FILTER:"lastUsedPublicCommentsFilter",LAST_USED_COMMENT_TYPE:"lastUsedCommentType"},COMMENT_TYPE_OPTIONS=[{value:COMMENT_TYPES.PUBLIC,text:"Public comment",className:"comment-public"},{value:COMMENT_TYPES.TEAM,text:"Team comment",className:"comment-team"}],COMMENTS_FILTER_OPTIONS=[{value:COMMENTS_FILTERS.ALL_COMMENTS,text:"All comments",className:"comment-all",shortcut:["shift","alt","a"]},{value:COMMENTS_FILTERS.PUBLIC_COMMENTS,text:"Public comments",className:"comment-public",shortcut:["shift","alt","p"]},{value:COMMENTS_FILTERS.TEAM_COMMENTS,text:"Team comments",className:"comment-team",shortcut:["shift","alt","t"]},{value:COMMENTS_FILTERS.HIDE_ALL,text:"Hide all comments",className:"",shortcut:["shift","alt","h"]}];return{commentsFilters:COMMENTS_FILTERS,commentTypes:COMMENT_TYPES,commentTypesActive:commentTypesActive,getCommentTypeOptions:getCommentTypeOptions,getCommentsFilterOptions:getCommentsFilterOptions,getLastUsedCommentsFilter:getLastUsedCommentsFilter,setLastUsedCommentsFilter:setLastUsedCommentsFilter,getLastUsedCommentType:getLastUsedCommentType,setLastUsedCommentType:setLastUsedCommentType}}angular.module("core").factory("CommentsSettings",CommentsSettings),CommentsSettings.$inject=["$rootScope","UsersService","FeatureToggler","localStorageService","AnalyticsService"]}(),function(){"use strict";function CommentsState(){return{groupInEditModeId:null}}angular.module("core").factory("CommentsState",CommentsState)}(),angular.module("core").factory("LiveSessionInstanceService",[function(){"use strict";var instance=null;return{set:function(newInstance){instance=newInstance},get:function(){return instance}}}]),angular.module("core").factory("LocalDataService",["$window","$document","$q",function($window,$document,$q){"use strict";return{getData:function(file){var d=$q.defer(),scr=document.createElement("script");return scr.setAttribute("src",file),scr.setAttribute("type","text/javascript"),scr.addEventListener("load",function(){d.resolve($window.DATA),delete $window.DATA,$document[0].body.removeChild(scr)}),$document[0].body.appendChild(scr),d.promise}}}]),angular.module("core").factory("AnalyticsService",["$analytics",function($analytics){"use strict";var pageSwitchTimers={},designLoadTimer=null;return{startPageSwitchTrack:function(id){pageSwitchTimers[id]=+new Date},finishPageSwitchTrack:function(id){var time;pageSwitchTimers[id]&&(time=+new Date-pageSwitchTimers[id],pageSwitchTimers[id]=null,this.event("Page switch",{category:"Navigation",label:"Page switch",value:time})),this.finishDesignLoadTrack()},startDesignLoadTrack:function(){designLoadTimer=+new Date},finishDesignLoadTrack:function(){var time;designLoadTimer>0&&(time=+new Date-designLoadTimer,designLoadTimer=null,this.event("Design load",{category:"Navigation",label:"Design load",value:time}))},trackComment:function(comment){var properties={category:"Comments"};0===comment.notify.length?properties.value=PreviewEnums.COMMENT_NOTIFY_NONE:comment.notify.length===comment.collaborators_all?properties.value=PreviewEnums.COMMENT_NOTIFY_ALL:properties.value=PreviewEnums.COMMENT_NOTIFY_CHOSEN,this.event("appuse_addcomment",properties)},event:function(name,properties){$analytics.eventTrack(name,properties)}}}]),angular.module("core").service("animate",function(){"use strict";var getElements=function(selector){if("string"==typeof selector){var el=document.querySelectorAll(selector);if(el)return Array.prototype.slice.call(el)}else{if("undefined"!=typeof selector.tagName)return[selector];if(/NodeList|HTMLCollection/.test(Object.prototype.toString.call(selector)))return Array.prototype.slice.call(selector)}return null};return function(selector,duration,properties){var elements=getElements(selector);elements&&elements.forEach(function(el){TweenLite.to(el,duration,properties)})}}),angular.module("core").factory("BreakpointsService",["$q","_","$rootScope","Rest","ProjectsService","LocalDataService","Settings",function($q,_,$rootScope,Rest,ProjectsService,LocalDataService,Settings){"use strict";function _getBreakpoints(projectHash){return Settings.isExport()?LocalDataService.getData("data/breakpoints.js"):Rest.one("projects",projectHash).all("breakpoints").getList()}return{breakpointsMap:{},breakpointWidths:[],getBreakpoints:function(){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getBreakpoints(projectHash).then(function(breakpoints){this.generateBreakpointsMap(breakpoints),this.generateBreakpointWidths(breakpoints),d.resolve(breakpoints)}.bind(this),function(error){d.reject(error)}),d.promise},generateBreakpointsMap:function(breakpoints){_.forIn(this.breakpointsMap,function(value,key){delete this.breakpointsMap[key]}.bind(this)),breakpoints.forEach(function(breakpoint){breakpoint.name=breakpoint.name.replace("&infin;","∞"),this.breakpointsMap[breakpoint.version]=breakpoint}.bind(this))},generateBreakpointWidths:function(breakpoints){for(;this.breakpointWidths.length;)this.breakpointWidths.pop();breakpoints.forEach(function(breakpoint){this.breakpointWidths.push(breakpoint)}.bind(this)),this.breakpointWidths=_.sortBy(this.breakpointWidths,"width")},getBreakpointName:function(id){return this.breakpointsMap[id].name}}}]),angular.module("core").controller("ChromeExtensionDownloadController",["$rootScope","$scope","$state","$stateParams","ChromeExtensionService",function($rootScope,$scope,$state,$stateParams,ChromeExtensionService){"use strict";$scope.isChrome=!!window.chrome,$scope.isInstalled=ChromeExtensionService.isInstalled(),$scope.downloadURL=null,$scope.helpPageURL="https://uxpin.desk.com/customer/portal/articles/1775664",$scope.onClickCreateSession=function($event){$event.preventDefault(),$state.go("home.page.usability-test",{pageId:$stateParams.pageId,page:1}),$scope.$close()},$scope.verifyInstall=function verifyInstallation(){return ChromeExtensionService.isInstalled()?void $scope.$apply(function(){$scope.isInstalled=!0}):(ChromeExtensionService.recheckInstallation(),setTimeout(verifyInstallation,1e3),!1)}}]),function(){"use strict";function CommentsService($q,$rootScope,Rest,UsersService,ProjectsService,PagesService,DocumentsService,AnalyticsService,Settings,socket,CommentsSettings){function _getPageComments(projectHash,pageId){var collection,d;return Settings.isExport()?(d=$q.defer(),d.resolve([]),d.promise):(collection=Settings.showCurrentPageOnly?Rest.one("projects",projectHash).one("pages",pageId):Rest.one("projects",projectHash),collection.all("comments").getList())}function addComment(comment){var d=$q.defer();return this.getComments().then(function(comments){Rest.all("comments").post(comment).then(function(response){AnalyticsService.trackComment(comment),AnalyticsService.event(PreviewEnums.KM_EVENTS.COMMENT_ADDED,{"Type of Comment":comment.type}),this.applyAddComment(response),d.resolve(response),socket.emit(PreviewEnums.SOCKET.ON_COMMENT_CREATE,response)}.bind(this),function(error){d.reject(error)})}.bind(this)),d.promise}function getComments(isPageLimited){return ProjectsService.isDocument()?this.getDocumentComments():this.getPageComments(isPageLimited)}function getPageComments(isPageLimited){var pageId=PagesService.currentPageId,projectHash=ProjectsService.currentProjectHash;return this.isCached(isPageLimited,pageId)?this.commentsCached.promise:(this.pageId=pageId,Settings.setShowCurrentPageOnly(void 0===isPageLimited?Settings.showCurrentPageOnly:isPageLimited),this.commentsCached=$q.defer(),_getPageComments(projectHash,pageId).then(function(comments){for(;this.comments.length;)this.comments.pop();comments.forEach(function(comment){this.comments.push(comment)}.bind(this)),this.sort(this.comments),this.generateCommentsMap(this.comments),this.generateCommentsTree(this.comments),this.commentsCached.resolve(this.comments)}.bind(this)),this.commentsCached.promise)}function getDocumentComments(){var collection,documentId=DocumentsService.currentDocumentId,projectHash=ProjectsService.currentProjectHash;return this.commentsCached?this.commentsCached.promise:(this.documentId=documentId,this.commentsCached=$q.defer(),collection=Rest.one("projects",projectHash).one("documents",documentId),collection.all("comments").getList().then(function(comments){for(;this.comments.length;)this.comments.pop();comments.forEach(function(comment){this.comments.push(comment)}.bind(this)),this.sort(this.comments),this.generateCommentsMap(this.comments),this.generateCommentsTree(this.comments),this.commentsCached.resolve(this.comments)}.bind(this)),this.commentsCached.promise);
}function getComment(id){var d=$q.defer();return this.getComments().then(function(comments){comments.forEach(function(comment){comment._id===id&&d.resolve(comment)})}),d.promise}function updateCommentType(id,type){return Rest.one("comments",id).customPUT({type:type}).then(function(res){return type!==CommentsSettings.commentTypes.PUBLIC||_.isEmpty(this.commentsTree[id])||(res.children=_.map(this.commentsTree[id],function(childId){return this.commentsMap[childId]}.bind(this))),socket.emit(PreviewEnums.SOCKET.ON_COMMENT_TYPE_UPDATE,res),this.applyUpdateCommentType(id,type),AnalyticsService.event(PreviewEnums.KM_EVENTS.COMMENT_TYPE_CHANGED,{"Type of Comment":type}),res}.bind(this))}function updateCommentContent(id,content,mentions){return Rest.one("comments",id).customPUT({comment:content,mentions:mentions}).then(function(res){return socket.emit(PreviewEnums.SOCKET.ON_COMMENT_CONTENT_UPDATE,res),this.applyUpdateCommentContent(id,content),AnalyticsService.event(PreviewEnums.KM_EVENTS.EDITED_COMMENTS),res}.bind(this))}function updateComment(id,properties){var d=$q.defer();return this.getComment(id).then(function(comment){Rest.one("comments",id).customPUT(properties).then(function(response){socket.emit(PreviewEnums.SOCKET.ON_COMMENT_UPDATE,response),this.applyUpdateComment(id,response).then(function(){d.resolve(response)})}.bind(this),function(error){d.reject(error)})}.bind(this)),d.promise}function updateCommentResolve(id,isResolved){return this.updateComment(id,{is_resolved:isResolved}).then(function(res){this.applyUpdateCommentResolve(id,res)}.bind(this))}function applyUpdateCommentResolve(id,data){this.getComments().then(function(comments){this.sort(comments),$rootScope.$emit(PreviewEnums.SORT_COMMENTS)}.bind(this)),$rootScope.$emit(PreviewEnums.RESOLVE_COMMENT,id,data.resolved.is)}function deleteComment(id){var d=$q.defer();return this.getComment(id).then(function(comment){this.getComments().then(function(comments){Rest.one("comments",id).remove().then(function(response){this.applyDeleteComment(response),socket.emit(PreviewEnums.SOCKET.ON_COMMENT_DELETE,response),d.resolve(response)}.bind(this))}.bind(this))}.bind(this)),d.promise}function fastDeletOnExit(id){Rest.one("comments",id).remove(),socket.emit(PreviewEnums.SOCKET.ON_COMMENT_DELETE,this.commentsMap[id])}function applyAddComment(data){this.addToCommentsTree(data),this.addToCommentsMap(data),this.addToCommentIdsInPage(data),_.find(this.comments,{_id:data._id})||this.comments.push(data),$rootScope.$emit(PreviewEnums.ADD_COMMENT,data._id,data._parent_comment)}function applyUpdateCommentType(id,type){this.getComment(id).then(function(comment){comment.type=type,$rootScope.$emit(PreviewEnums.ON_COMMENT_TYPE_UPDATE,id,type)})}function applyUpdateCommentContent(id,content){this.getComment(id).then(function(comment){comment.comment=content,$rootScope.$emit(PreviewEnums.ON_COMMENT_CONTENT_UPDATE,id,content)})}function applyUpdateComment(id,data){var d=$q.defer();return this.getComment(id).then(function(comment){var changeResolved=comment.resolved.is!==data.resolved.is;_.forIn(data.originalElement,function(value,key){comment[key]=value}),changeResolved&&(this.getComments().then(function(comments){this.sort(comments),$rootScope.$emit(PreviewEnums.SORT_COMMENTS)}.bind(this)),$rootScope.$emit(PreviewEnums.RESOLVE_COMMENT,id,data.resolved.is)),d.resolve(comment)}.bind(this),function(error){d.reject(error)}),d.promise}function applyDeleteComment(comment){this.removeFromCommentsMap(comment),this.removeFromCommentIdsInPage(comment),this.removeFromCommentsTree(comment),this.removeById(comment._id),$rootScope.$emit(PreviewEnums.DELETE_COMMENT,comment._id,!!comment._parent_comment)}function getIndex(pageId,id){return id?this.commentIdsInPage[pageId].indexOf(id)+1:this.commentIdsInPage[pageId]?this.commentIdsInPage[pageId].length+1:1}function isLoved(comment){var isLoved=!1;return _.forEach(comment.lovers,function(lover){if(lover.id_user===UsersService.me.id_user)return isLoved=!0,!1}),isLoved}function canEdit(comment){return comment.user.id===UsersService.me.id_user||UsersService.me.is_owner}function canEditContent(comment){return comment.user.id===UsersService.me.id_user}function isCached(isPageLimited,pageId){return this.commentsCached&&(pageId===this.pageId||!Settings.showCurrentPageOnly)&&(void 0===isPageLimited||isPageLimited===Settings.showCurrentPageOnly)}function isGroup(id){return!!this.commentsTree[id]}function sort(comments){comments.sort(function(c1,c2){return c1.resolved.is&&!c2.resolved.is?1:!c1.resolved.is&&c2.resolved.is?-1:moment(c1.created_at)<moment(c2.created_at)?-1:1}),this.generateCommentIdsInPage(comments)}function generateCommentsTree(comments){_.forIn(this.commentsTree,function(value,key){delete this.commentsTree[key]}.bind(this)),comments.forEach(function(comment){this.addToCommentsTree(comment)}.bind(this))}function addToCommentsTree(comment){var pageId=comment.id_page?comment.id_page:comment.id_document;(PagesService.pagesMap[pageId]||ProjectsService.isDocument())&&comment._parent_comment&&(this.commentsTree[comment._parent_comment]||(this.commentsTree[comment._parent_comment]=[]),_.indexOf(this.commentsTree[comment._parent_comment],comment._id)===-1&&this.commentsTree[comment._parent_comment].push(comment._id))}function removeFromCommentsTree(comment){if(comment._parent_comment){var comments=this.commentsTree[comment._parent_comment],index=comments.indexOf(comment._id);comments.splice(index,1),comments.length||delete this.commentsTree[comment._parent_comment]}else this.commentsTree[comment._id]&&(_.forEach(this.commentsTree[comment._id],function(id){this.removeById(this.commentsMap[id]),this.removeFromCommentsMap(this.commentsMap[id])}.bind(this)),delete this.commentsTree[comment._id])}function generateCommentIdsInPage(comments){_.forIn(this.commentIdsInPage,function(value,key){for(;value.length;)value.pop()}),comments.forEach(function(comment){this.addToCommentIdsInPage(comment)}.bind(this))}function addToCommentIdsInPage(comment){var pageId=comment.id_page?comment.id_page:comment.id_document;(PagesService.pagesMap[pageId]||ProjectsService.isDocument())&&(comment._parent_comment||(this.commentIdsInPage[pageId]||(this.commentIdsInPage[pageId]=[]),_.indexOf(this.commentIdsInPage[pageId],comment._id)===-1&&this.commentIdsInPage[pageId].push(comment._id)))}function removeFromCommentIdsInPage(comment){if(!comment._parent_comment){var pageId=comment.id_page?comment.id_page:comment.id_document,index=this.commentIdsInPage[pageId].indexOf(comment._id);this.commentIdsInPage[pageId].splice(index,1)}}function generateCommentsMap(comments){_.forIn(this.commentsMap,function(value,key){delete this.commentsMap[key]}.bind(this)),comments.forEach(function(comment){this.addToCommentsMap(comment)}.bind(this))}function addToCommentsMap(comment){var pageId=comment.id_page?comment.id_page:comment.id_document;(PagesService.pagesMap[pageId]||ProjectsService.isDocument())&&(this.commentsMap[comment._id]=comment)}function removeFromCommentsMap(comment){delete this.commentsMap[comment._id]}function markAsRead(id){this.updateComment(id,{is_read:!0})}function getRedirectId(commentId){return this.commentsMap[commentId]?this.commentsMap[commentId]._parent_comment?this.commentsMap[commentId]._parent_comment:commentId:null}function findById(commentId,returnIndex){var index;return this.comments.some(function(comment,i){return index=i,comment._id===commentId}),returnIndex?index:this.comments[index]}function removeById(commentId){this.comments.splice(this.findById(commentId,!0),1)}return{commentsCached:null,comments:[],commentsMap:{},commentsTree:{},commentIdsInPage:{},pageId:null,selectedCommentId:null,selectedCommentShowNotificationPanel:!1,searchFor:"",addComment:addComment,getComments:getComments,getPageComments:getPageComments,getDocumentComments:getDocumentComments,getComment:getComment,updateCommentResolve:updateCommentResolve,updateCommentType:updateCommentType,updateCommentContent:updateCommentContent,updateComment:updateComment,deleteComment:deleteComment,fastDeletOnExit:fastDeletOnExit,applyAddComment:applyAddComment,applyUpdateCommentResolve:applyUpdateCommentResolve,applyUpdateCommentType:applyUpdateCommentType,applyUpdateCommentContent:applyUpdateCommentContent,applyUpdateComment:applyUpdateComment,applyDeleteComment:applyDeleteComment,getIndex:getIndex,isLoved:isLoved,canEdit:canEdit,canEditContent:canEditContent,isCached:isCached,isGroup:isGroup,sort:sort,generateCommentsTree:generateCommentsTree,addToCommentsTree:addToCommentsTree,removeFromCommentsTree:removeFromCommentsTree,generateCommentIdsInPage:generateCommentIdsInPage,addToCommentIdsInPage:addToCommentIdsInPage,removeFromCommentIdsInPage:removeFromCommentIdsInPage,generateCommentsMap:generateCommentsMap,addToCommentsMap:addToCommentsMap,removeFromCommentsMap:removeFromCommentsMap,markAsRead:markAsRead,getRedirectId:getRedirectId,findById:findById,removeById:removeById}}angular.module("core").factory("CommentsService",CommentsService),CommentsService.$inject=["$q","$rootScope","Rest","UsersService","ProjectsService","PagesService","DocumentsService","AnalyticsService","Settings","socket","CommentsSettings"]}(),angular.module("core").factory("DocumentsService",["$q","$rootScope","$state","Rest","ProjectsService","BreakpointsService",function($q,$rootScope,$state,Rest,ProjectsService,BreakpointsService){"use strict";return{currentDocumentId:null,currentDocumentProperties:null,getDocuments:function(){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return Rest.one("projects",projectHash).all("documents").getList().then(function(documents){this.currentDocumentId=documents[0].id_document,d.resolve(documents)}.bind(this),function(error){d.reject(error)}),d.promise},getDocument:function(id){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return Rest.one("projects",projectHash).one("documents",id).get().then(function(document){this.currentDocumentProperties=document,d.resolve(document)}.bind(this)),d.promise}}}]),angular.module("core").factory("DOMService",["$rootScope","$window",function($rootScope,$window){"use strict";return{container:null,getContainerDimensions:function(){this.container||(this.container=document.querySelector("main > section.scrolled-container > section.scrolled-content"));var w=0,h=0;if(this.container){var style=window.getComputedStyle(this.container);w=parseInt(style.width),h=parseInt(style.height)}return{width:w,height:h}},getWindowWidth:function(){return $window.innerWidth}}}]),angular.module("core").factory("editorSocket",["$rootScope",function($rootScope){"use strict";return SocketServiceHelper(ApplicationConfiguration.socketEditorServerURL,$rootScope)}]),angular.module("core").factory("Engine",["$rootScope","$window",function($rootScope,$window){"use strict";function initPage(container,content){return _content=content,_container=container,_scrollableContainer=null,_page=new window.uxpinEngine({mode:window.ApplicationConfiguration.mode||uxpinEngine.Modes.PREVIEW,userContentPrefix:window.ApplicationConfiguration.userContentPrefix,userContentPrefixCached:window.ApplicationConfiguration.userContentPrefixCached,staticContentPrefixCached:window.ApplicationConfiguration.staticContentPrefixCached}),_page.on(window.uxpinEngine.Events.NAVIGATE,function(action,data){var target=data&&data.target||"_self";"link_back"===action?$rootScope.$emit(PreviewEnums.NAVIGATE_HISTORY_BACK):"link_page"===action?"_blank"===data.target?window.open(window.location.href.split("/pages/")[0]+"/pages/"+data.id_page,target):$rootScope.$emit(PreviewEnums.NAVIGATE_TO_PAGE,data.id_page):"link_url"===action&&window.open(data.url,target)}),_page.on(window.uxpinEngine.Events.SCROLL_TO_Y,function(y,animation,delay){setTimeout(function(){InteractionsAnimations.processScroll(_scrollableContainer||_container,y,animation.duration,animation)},delay||0)}),_page.on(window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,function(){setTimeout(function(){updateOffset()},0)}),window.addEventListener("resize",updateOffset),window.addEventListener("keydown",onKeyDown),_page}function getPage(){return _page}function updateOffset(){if(_page){var rect=_content.getClientRects()[0];_page.setOffset(rect.left+_container.scrollLeft,rect.top+_container.scrollTop)}}function onKeyDown(e){_page&&_page.triggerKeyDown(e)}function onScroll(e){_page&&_page.triggerScroll(e)}function setScrollableContainer(scrollableContainer){_scrollableContainer&&_scrollableContainer.removeEventListener("scroll",onScroll),_scrollableContainer=scrollableContainer,_scrollableContainer.addEventListener("scroll",onScroll)}var _page,_content,_container,_scrollableContainer;return{initPage:initPage,getPage:getPage,updateOffset:updateOffset,setScrollableContainer:setScrollableContainer}}]),angular.module("core").factory("EscapeHtmlService",[function(){"use strict";function htmlentities(string,quote_style,charset,double_encode){var hash_map=get_html_translation_table("HTML_ENTITIES",quote_style),symbol="";if(string=null===string?"":string+"",!hash_map)return!1;if(quote_style&&"ENT_QUOTES"===quote_style&&(hash_map["'"]="&#039;"),double_encode||null===double_encode)for(symbol in hash_map)hash_map.hasOwnProperty(symbol)&&(string=string.split(symbol).join(hash_map[symbol]));else string=string.replace(/([\s\S]*?)(&(?:#\d+|#x[\da-f]+|[a-zA-Z][\da-z]*);|$)/g,function(ignore,text,entity){for(symbol in hash_map)hash_map.hasOwnProperty(symbol)&&(text=text.split(symbol).join(hash_map[symbol]));return text+entity});return string}function html_entity_decode(string,quote_style){var hash_map={},symbol="",tmp_str="",entity="";if(tmp_str=string.toString(),!1===(hash_map=get_html_translation_table("HTML_ENTITIES",quote_style)))return!1;delete hash_map["&"],hash_map["&"]="&amp;";for(symbol in hash_map)entity=hash_map[symbol],tmp_str=tmp_str.split(entity).join(symbol);return tmp_str=tmp_str.split("&#039;").join("'")}function get_html_translation_table(table,quote_style){var decimal,entities={},hash_map={},constMappingTable={},constMappingQuoteStyle={},useTable={},useQuoteStyle={};if(constMappingTable[0]="HTML_SPECIALCHARS",constMappingTable[1]="HTML_ENTITIES",constMappingQuoteStyle[0]="ENT_NOQUOTES",constMappingQuoteStyle[2]="ENT_COMPAT",constMappingQuoteStyle[3]="ENT_QUOTES",useTable=isNaN(table)?table?table.toUpperCase():"HTML_SPECIALCHARS":constMappingTable[table],useQuoteStyle=isNaN(quote_style)?quote_style?quote_style.toUpperCase():"ENT_COMPAT":constMappingQuoteStyle[quote_style],"HTML_SPECIALCHARS"!==useTable&&"HTML_ENTITIES"!==useTable)throw new Error("Table: "+useTable+" not supported");"HTML_ENTITIES"===useTable&&(entities[160]="&nbsp;",entities[161]="&iexcl;",entities[162]="&cent;",entities[163]="&pound;",entities[164]="&curren;",entities[165]="&yen;",entities[166]="&brvbar;",entities[167]="&sect;",entities[168]="&uml;",entities[169]="&copy;",entities[170]="&ordf;",entities[171]="&laquo;",entities[172]="&not;",entities[173]="&shy;",entities[174]="&reg;",entities[175]="&macr;",entities[176]="&deg;",entities[177]="&plusmn;",entities[178]="&sup2;",entities[179]="&sup3;",entities[180]="&acute;",entities[181]="&micro;",entities[182]="&para;",entities[183]="&middot;",entities[184]="&cedil;",entities[185]="&sup1;",entities[186]="&ordm;",entities[187]="&raquo;",entities[188]="&frac14;",entities[189]="&frac12;",entities[190]="&frac34;",entities[191]="&iquest;",entities[192]="&Agrave;",entities[193]="&Aacute;",entities[194]="&Acirc;",entities[195]="&Atilde;",entities[196]="&Auml;",entities[197]="&Aring;",entities[198]="&AElig;",entities[199]="&Ccedil;",entities[200]="&Egrave;",entities[201]="&Eacute;",entities[202]="&Ecirc;",entities[203]="&Euml;",entities[204]="&Igrave;",entities[205]="&Iacute;",entities[206]="&Icirc;",entities[207]="&Iuml;",entities[208]="&ETH;",entities[209]="&Ntilde;",entities[210]="&Ograve;",entities[211]="&Oacute;",entities[212]="&Ocirc;",entities[213]="&Otilde;",entities[214]="&Ouml;",entities[215]="&times;",entities[216]="&Oslash;",entities[217]="&Ugrave;",entities[218]="&Uacute;",entities[219]="&Ucirc;",entities[220]="&Uuml;",entities[221]="&Yacute;",entities[222]="&THORN;",entities[223]="&szlig;",entities[224]="&agrave;",entities[225]="&aacute;",entities[226]="&acirc;",entities[227]="&atilde;",entities[228]="&auml;",entities[229]="&aring;",entities[230]="&aelig;",entities[231]="&ccedil;",entities[232]="&egrave;",entities[233]="&eacute;",entities[234]="&ecirc;",entities[235]="&euml;",entities[236]="&igrave;",entities[237]="&iacute;",entities[238]="&icirc;",entities[239]="&iuml;",entities[240]="&eth;",entities[241]="&ntilde;",entities[242]="&ograve;",entities[243]="&oacute;",entities[244]="&ocirc;",entities[245]="&otilde;",entities[246]="&ouml;",entities[247]="&divide;",entities[248]="&oslash;",entities[249]="&ugrave;",entities[250]="&uacute;",entities[251]="&ucirc;",entities[252]="&uuml;",entities[253]="&yacute;",entities[254]="&thorn;",entities[255]="&yuml;"),"ENT_NOQUOTES"!==useQuoteStyle&&(entities[34]="&quot;"),"ENT_QUOTES"===useQuoteStyle&&(entities[39]="&#39;"),entities[60]="&lt;",entities[62]="&gt;";for(decimal in entities)entities.hasOwnProperty(decimal)&&(hash_map[String.fromCharCode(decimal)]=entities[decimal]);return hash_map}function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}return{escape:function(value){return htmlentities(value,"ENT_QUOTES","UTF-8")},escapeRegExp:function(value){return escapeRegExp(value)},decode:function(value){return html_entity_decode(value,"ENT_QUOTES")}}}]),function(){"use strict";function FeatureToggler(){var features=ApplicationConfiguration.project.features||{};return{teamComments:features.team_comments}}angular.module("core").factory("FeatureToggler",FeatureToggler)}(),angular.module("core").factory("LayoutStates",["$rootScope","$state",function($rootScope,$state){"use strict";var states={isToolbarVisible:!1,isSitemapVisible:!1,isPanelVisible:!1,isUserTestingSession:!1,isLiveShareSession:!1,isHostSession:!1},api=($rootScope.$on("$stateChangeSuccess",function(e,toState,toParams,fromState,fromParams){states.isToolbarVisible=!$state.includes("**.nosidebar.**"),states.isSitemapVisible=$state.includes("**.sitemap.**"),states.isPanelVisible=$state.includes("**.panel.**")}),{enterState:function(state){$state.go($state.current.name+"."+state)},removeState:function(state){$state.includes("**."+state+".**")&&$state.go($state.current.name.replace("."+state,""))},isToolbarVisible:function(){return states.isToolbarVisible},isPanelVisible:function(){return states.isPanelVisible||states.isSitemapVisible},isNoToolbarMode:function(){return $state.params.mode&&"cm"===$state.params.mode},setStateById:function(id,value){"undefined"!=typeof states[id]&&(states[id]=value)},getStateById:function(id){return states[id]}});return api}]),angular.module("core").factory("LiveSessionService",["$q","$rootScope","$state","$location","$translate","Restangular","ProjectsService","PagesService","UsersService","LiveSessionInstanceService","ChromeExtensionService",function($q,$rootScope,$state,$location,$translate,Restangular,ProjectsService,PagesService,UsersService,LiveSessionInstanceService,ChromeExtensionService){"use strict";var EVENTS=LiveShare.enums.EVENTS,ROOM_SETTINGS=LiveShare.enums.ROOM_SETTINGS,LiveSession=function(type){this.type=type,this.liveShare=null,this.muted=!1,this.roomID=null,this.roomConfigurationOptions=null,this.onContentLoaded,this.onChangePageDuringSession,this.observerCallbacks=[],this.restangular=Restangular.withConfig(function(RestangularConfigurer){RestangularConfigurer.setBaseUrl("/api/live-presentation/")}),this.onChangePage=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(e,id){this.roomId(null)}.bind(this))};return LiveSession.prototype.initializeLiveShare=function(){var liveShare=new LiveShare({socketURL:ApplicationConfiguration.socketServerURL+"/live-presentation",voicechatURL:ApplicationConfiguration.voicechatServerURL,scrolledElement:"main .scrolled-content",relativeElement:".preview-container"});liveShare.on(EVENTS.START,this.onLiveSessionStart.bind(this)),liveShare.on(EVENTS.FINISH,this.onLiveSessionFinish.bind(this)),liveShare.on(EVENTS.COLLABORATOR_JOIN,this.fireObserverCallback.bind(this,EVENTS.COLLABORATOR_JOIN)),liveShare.on(EVENTS.COLLABORATOR_LEFT,this.fireObserverCallback.bind(this,EVENTS.COLLABORATOR_LEFT)),liveShare.on(EVENTS.FOLLOW_CURSOR_ON,this.fireObserverCallback.bind(this,EVENTS.FOLLOW_CURSOR_ON)),liveShare.on(EVENTS.FOLLOW_CURSOR_OFF,this.fireObserverCallback.bind(this,EVENTS.FOLLOW_CURSOR_OFF)),liveShare.on(EVENTS.TESTER_JOINED,this.fireObserverCallback.bind(this,EVENTS.TESTER_JOINED)),liveShare.on(EVENTS.ALLOW_START,this.fireObserverCallback.bind(this,EVENTS.ALLOW_START)),liveShare.on(EVENTS.VIDEO_PARTICIPANT_JOINED,this.fireObserverCallback.bind(this,EVENTS.VIDEO_PARTICIPANT_JOINED)),liveShare.on(EVENTS.VIDEO_PARTICIPANT_LEFT,this.fireObserverCallback.bind(this,EVENTS.VIDEO_PARTICIPANT_LEFT)),liveShare.on(EVENTS.MUTE,this.fireObserverCallback.bind(this,EVENTS.MUTE)),liveShare.on(EVENTS.DOM,this.onDOMEvent.bind(this)),liveShare.on(EVENTS.MEDIA_ACCESS,this.onMediaAccess.bind(this));try{ChromeExtensionService.onMessage(this.onChromeExtensionCallback.bind(this))}catch(e){}return liveShare},LiveSession.prototype.onChromeExtensionCallback=function(data){window.console.log("onChromeExtension",data,data.action),"startRecording"===data.action&&this.fireObserverCallback(EVENTS.ALLOW_START)},LiveSession.prototype.getType=function(){return this.type},LiveSession.prototype.onDOMEvent=function(data){Interactions.dispatchEvent(data.serializedEvent,data.id)},LiveSession.prototype.onMediaAccess=function(value){$rootScope.$emit(PreviewEnums.MEDIA_ACCESS,value)},LiveSession.prototype.onLiveSessionStart=function(){"function"==typeof Interactions.handleFormEvents&&Interactions.handleFormEvents(),this.onChangePageDuringSession=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(e,id){var newURL=document.URL.split("#")[0]+$state.href("home.page",{pageId:id});try{this.liveShare.eventDispatcher.handleEvent({},{eventCategory:"HashChangeEvent",selector:"window",type:"hashchange",newURL:newURL,oldURL:document.URL})}catch(e){return void console.error(e)}this.liveShare.onPageChangeStart()}.bind(this)),this.fireObserverCallback(LiveShare.enums.EVENTS.START),this.onContentLoaded=$rootScope.$on(PreviewEnums.ON_CONTENT_LOADED,function(){this.liveShare.onPageChangeFinish()}.bind(this))},LiveSession.prototype.onLiveSessionFinish=function(data){"function"==typeof Interactions.unhandleFormEvents&&Interactions.unhandleFormEvents(),this.onChangePageDuringSession(),this.onContentLoaded(),this.fireObserverCallback("finish",data)},LiveSession.prototype.getCurrentPortForUrl=function(){var port=$location.port();return port&&80!==port?":"+port:""},LiveSession.prototype.roomId=function(id){return id?void(this.roomID=id):this.roomID},LiveSession.prototype.registerObserverCallback=function(event,callback){this.observerCallbacks[event]||(this.observerCallbacks[event]=[]),window.console.count("Registering callback for "+event),this.observerCallbacks[event].push(callback)},LiveSession.prototype.fireObserverCallback=function(event,data){window.console.count("Fire: "+event),window.console.log("Data",data),this.observerCallbacks[event]?(window.console.log("Callbacks count: "+this.observerCallbacks[event].length),this.observerCallbacks[event].forEach(function(callback){window.console.count("Callback for "+event+" fired"),callback(data)})):window.console.log("Callbacks count: 0")},LiveSession.prototype.makeRoomReservation=function(){var d=$q.defer(),queryParams={sessionId:UsersService.me.id_session,url:this.getDestinationUrl(),name:ProjectsService.currentProjectName,type:this.type};return this.restangular.one("").post("make-room-reservation",queryParams).then(function(data){this.roomId(JSON.parse(data)),d.resolve(this.roomId())}.bind(this),function(err){window.console.error(err),d.reject(err)}),d.promise},LiveSession.prototype.startInitializing=function(data){LiveSessionInstanceService.set(this);var queryParams={};data.options&&(queryParams.options=data.options),data.type&&(queryParams.type=data.type),$state.go("home.page.live-share-start",queryParams)},LiveSession.prototype.create=function(settings,userData){return this.liveShare=this.initializeLiveShare(),this.liveShare.create(settings,userData)},LiveSession.prototype.join=function(sessionId,userData){return this.liveShare=this.initializeLiveShare(),this.liveShare.join({roomID:sessionId},userData)},LiveSession.prototype.quit=function(){this.liveShare.quit()},LiveSession.prototype.isSession=function(){return!!this.liveShare&&this.liveShare.isSession()},LiveSession.prototype.isHostSession=function(){return this.liveShare.isHostSession()},LiveSession.prototype.getInviteURL=function(){return $location.protocol()+"://"+$location.host()+this.getCurrentPortForUrl()+"/live-presentation/"+this.roomId()},LiveSession.prototype.getDestinationUrl=function(){return $state.href("home.page",{pageId:PagesService.currentPageId},{absolute:!0})},LiveSession.prototype.getCollaboratorsData=function(){return this.liveShare.getCollaboratorsData()},LiveSession.prototype.getHostData=function(){return this.liveShare.getHostData()},LiveSession.prototype.removeCollaborator=function(id){return this.liveShare.removeCollaborator(id)},LiveSession.prototype.getConfigurationOptions=function(){},LiveSession.prototype.setOption=function(key,val){var option=this.translateOption(key,val),optionName=Object.keys(option)[0];this.liveShare.setOption(optionName,option[optionName])},LiveSession.prototype.translateOption=function(key,val){var option={};return key===ROOM_SETTINGS.ALLWAYS_FOLLOW_HOST?option.toggleFollow=!val:key===ROOM_SETTINGS.SHOW_CURSOR?option.showCursor=val?"all":"host":key===ROOM_SETTINGS.CAN_CLOSE_TASKS?option[ROOM_SETTINGS.CAN_CLOSE_TASKS]=val?"all":"host":key===ROOM_SETTINGS.SEE_SITEMAP?option[ROOM_SETTINGS.SEE_SITEMAP]=val?"all":"host":option[key]=val,option},LiveSession.prototype.followCursor=function(id){this.liveShare.followCursor(id)},LiveSession.prototype.executeEventsQueue=function(){return this.liveShare.collaboration.executeEventsQueue()},LiveSession.prototype.mute=function(value){this.liveShare.mute(value)},LiveSession.prototype.getMyData=function(){return this.liveShare.getMyData()},LiveSession}]),angular.module("core").factory("LiveShareService",["_","$translate","LiveSessionService",function(_,$translate,LiveSessionService){"use strict";var LiveShareService=function(){LiveSessionService.apply(this,arguments)},proto=LiveShareService.prototype;return proto=_.extend(proto,LiveSessionService.prototype),proto.constructor=LiveShareService,proto.getConfigurationOptions=function(){return $translate(["LS_OPTION_SHOW_CURSOR","LS_OPTION_FOLLOW_CURSOR"]).then(function(translations){return this.roomConfigurationOptions||(this.roomConfigurationOptions=[{name:translations.LS_OPTION_SHOW_CURSOR,value:!1,param:"showCursor"},{name:translations.LS_OPTION_FOLLOW_CURSOR,value:!1,param:"alwaysFollowHost"}]),this.roomConfigurationOptions}.bind(this))},new LiveShareService(LiveShare.enums.SESSION_TYPES.SHARING)}]),angular.module("core").factory("_",[function(){"use strict";return window._}]),angular.module("core").service("moment",function(){"use strict";return window.moment}),angular.module("core").factory("NotificationsService",["$q","_","$sce","$rootScope","Rest","ProjectsService",function($q,_,$sce,$rootScope,Rest,ProjectsService){"use strict";return{notificationsMap:{},getNotifications:function(){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return Rest.one("projects",projectHash).all("notifications").getList().then(function(notifications){this.generateNotificationsMap(notifications),d.resolve(notifications)}.bind(this),function(error){d.reject(error)}),d.promise},addToNotifications:function(emails,commentId,forceEmpty){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _.isEmpty(emails)&&!forceEmpty?d.reject():Rest.one("projects",projectHash).all("notifications").customPOST({commentId:commentId,emails:emails},"add").then(function(notification){this.addToNotificationsMap(notification),$rootScope.$emit(PreviewEnums.ON_CHANGE_NOTIFICATIONS,commentId,notification),d.resolve(notification)}.bind(this),function(error){d.reject(error)}),d.promise},removeFromNotificationList:function(emails,commentId,forceEmpty){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _.isEmpty(emails)&&!forceEmpty?d.reject():Rest.one("projects",projectHash).all("notifications").customPOST({commentId:commentId,emails:emails},"remove").then(function(notification){this.addToNotificationsMap(notification),$rootScope.$emit(PreviewEnums.ON_CHANGE_NOTIFICATIONS,commentId,notification),d.resolve(notification)}.bind(this),function(error){d.reject(error)}),d.promise},generateNotificationsMap:function(notifications){_.forIn(this.notificationsMap,function(value,key){delete this.notificationsMap[key]}.bind(this)),notifications.forEach(function(notification){this.addToNotificationsMap(notification)}.bind(this))},addToNotificationsMap:function(notification){this.notificationsMap[notification._id]=notification}}}]),function(){"use strict";var deletOnExit={};angular.module("core").factory("PageExitService",["$window","$timeout","$rootScope","CommentsService",function($window,$timeout,$rootScope,CommentsService){$rootScope.$on(PreviewEnums.DELETING_COMMENT,function(e,id,value){value?deletOnExit[id]=$timeout(function(){delete deletOnExit[id]},PreviewEnums.UNDO_TIMEOUT):_.isUndefined(deletOnExit[id])||($timeout.cancel(deletOnExit[id]),delete deletOnExit[id])}),$window.addEventListener("beforeunload",function(event){return _.isEmpty(deletOnExit)||Object.keys(deletOnExit).forEach(function(commentId){var timeoutId=deletOnExit[commentId];$timeout.cancel(timeoutId),CommentsService.fastDeletOnExit(commentId),delete deletOnExit[commentId]}),null})}])}(),function(){"use strict";angular.module("core").factory("PagesService",["$q","$rootScope","$state","Rest","ProjectsService","BreakpointsService","LocalDataService","Settings",function($q,$rootScope,$state,Rest,ProjectsService,BreakpointsService,LocalDataService,Settings){function _getPage(projectHash,pageId){return Settings.isExport()?LocalDataService.getData("data/page_size_"+pageId+".js"):Rest.one("projects",projectHash).one("pages",pageId).get()}function _getPageContent(projectHash,pageId){return Rest.one("projects",projectHash).one("pages",pageId).one("content").get()}function _getPageCanvasData(projectHash,pageId){return Settings.isExport()?LocalDataService.getData("data/page_"+pageId+".js"):Rest.one("projects",projectHash).one("pages",pageId).one("canvasData").get()}function _getPages(projectHash){return Settings.isExport()?LocalDataService.getData("data/pages.js"):Rest.one("projects",projectHash).all("pages").getList()}return{rootPageId:null,currentPageId:null,defaultBreakpointId:null,currentBreakpointId:null,currentPageProperties:null,pagesMap:{},pagesChildrenMap:{},pagesTree:{},pagesBreakpoints:{},breakpointIds:{},setCurrentPageId:function(id){this.currentPageId=id,"undefined"!=typeof this.pagesMap[id]&&"undefined"!=typeof this.pagesMap[id].version_type&&(this.currentBreakpointId=this.pagesMap[id].version_type),$rootScope.$emit(PreviewEnums.ON_CHANGE_PAGE,id)},setCurrentBreakpointId:function(id){this.currentBreakpointId=id},setPageResponsive:function(width){if(_.size(this.breakpointIds)>1){var breakpointId=0;_.each(BreakpointsService.breakpointWidths,function(breakpoint){this.breakpointIds.indexOf(breakpoint.version)>-1&&breakpoint.width<=width&&(breakpointId=breakpoint.version)}.bind(this)),"undefined"!=typeof breakpointId&&this.currentBreakpointId!==breakpointId&&this.changePageBreakpoint(breakpointId)}},changePageBreakpoint:function(id){var newState,currentState=$state.current.name;newState=$state.includes("**.comment.**")?currentState.replace("home.page.comment","home.page"):currentState,
$rootScope.$emit(PreviewEnums.ADDING_COMMENT,!1),this.setCurrentBreakpointId(id),$state.go(newState,{pageId:this.getPageByBreakpoint(this.currentPageId)})},getCanvasData:function(pageId){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return Promise.all([_getPage(projectHash,pageId),_getPageCanvasData(projectHash,pageId)]).then(function(resolvedValues){this.currentPageProperties=resolvedValues[0],d.resolve(resolvedValues[1])}.bind(this)),d.promise},getPages:function(){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getPages(projectHash).then(function(pages){this.generatePagesMap(pages),this.generatePagesTree(pages),this.generatePagesBreakpoints(pages),this.breakpointIds=this.getBreakpoints(pages),this.rootPageId=this.pagesTree.nodes[0].id,this.defaultBreakpointId=this.getDefaultBreakpointId(pages),d.resolve(pages)}.bind(this),function(error){d.reject(error)}),d.promise},getPage:function(id){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getPage(projectHash,id).then(function(page){this.currentPageProperties=page,d.resolve(page)}.bind(this)),d.promise},getPageContent:function(id){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getPageContent(projectHash,id).then(function(content){d.resolve(content)}.bind(this)),d.promise},getPageByBreakpoint:function(id){if(!this.pagesMap[id])return{};this.pagesMap[id].version_of&&(id=this.pagesMap[id].version_of);var breakpointId=null!==this.currentBreakpointId?this.currentBreakpointId:this.defaultBreakpointId,pId=this.pagesBreakpoints[id][breakpointId];return pId?pId:this.pagesBreakpoints[id][parseInt(_.findKey(this.pagesBreakpoints[id]))]},getRootPage:function(){return this.getPageByBreakpoint(this.rootPageId)},getContentWidth:function(){var breakpointId=this.pagesMap[this.currentPageId].version_type;return 0!==breakpointId?BreakpointsService.breakpointsMap[breakpointId].width:this.currentPageProperties.size.width},getContentCropping:function(){var scrollSize={};return this.currentPageProperties?{x:this.currentPageProperties.size.scrollx,y:this.currentPageProperties.size.scrolly}:scrollSize},generatePagesMap:function(pages){_.forIn(this.pagesMap,function(value,key){delete this.pagesMap[key]}.bind(this)),pages.forEach(function(page){this.pagesMap[page.id_page]=page}.bind(this))},generatePagesTree:function(pages){_.forIn(this.pagesTree,function(value,key){delete this.pagesTree[key]}.bind(this)),_.forIn(this.pagesChildrenMap,function(value,key){delete this.pagesChildrenMap[key]}.bind(this)),this.pagesTree=this.getChildren(null,pages)},getChildren:function(id,pages){var node={id:id,nodes:[]};return this.pagesChildrenMap[node.id]=[],pages.forEach(function(page){page.parent===id&&null===page.version_of&&(this.pagesChildrenMap[node.id].push(page.id_page),node.nodes.push(this.getChildren(page.id_page,pages)))}.bind(this)),node},generatePagesBreakpoints:function(pages){_.forIn(this.pagesBreakpoints,function(value,key){delete this.pagesBreakpoints[key]}.bind(this));var breakpoints;pages.forEach(function(page){page.version_of||(breakpoints=this.pagesBreakpoints[page.id_page]={},pages.forEach(function(breakpointPage){breakpointPage.version_of===page.id_page&&(breakpoints[breakpointPage.version_type]=breakpointPage.id_page)}),breakpoints[page.version_type]=page.id_page)}.bind(this))},getBreakpoints:function(pages){var breakpoints=[];return pages.forEach(function(page){breakpoints.indexOf(page.version_type)===-1&&breakpoints.push(page.version_type)}),breakpoints},getPageBreakpoints:function(id){var p=this.pagesMap[id];if(!p)return[];var pId=p.version_of?p.version_of:id,pageBreakpoints=this.pagesBreakpoints[pId],b=[];return _.forEach(pageBreakpoints,function(pageId,breakpointId){if("null"!==breakpointId){var id=parseInt(breakpointId,10);b.push({id:id,name:BreakpointsService.getBreakpointName(id)})}}),b},getCurrentPageBreakpoints:function(){return this.getPageBreakpoints(this.currentPageId)},getDefaultBreakpointId:function(pages){return pages.length?0===pages[0].main_version&&null===pages[0].version_type?this.breakpointIds[1]:pages[0].main_version:null}}}])}(),angular.module("core").factory("ProjectsService",["$q",function($q){"use strict";return{currentProjectId:ApplicationConfiguration.project.id_project,currentProjectHash:ApplicationConfiguration.project.hash,currentProjectName:ApplicationConfiguration.project.name,currentProjectType:ApplicationConfiguration.project.type,currentCollectionId:ApplicationConfiguration.project.id_collection,currentDocumentType:ApplicationConfiguration.project.type,currentProjectFeatures:ApplicationConfiguration.project.features||{},DOCUMENT_TYPE_UXTEST:"DUXTEST",DOCUMENT_TYPE_PERSONA:"DPERSONA",DOCUMENT_TYPE_BMC:"DBMC",DOCUMENT_TYPE_PC:"DPC",DOCUMENT_TYPE_WIREFRAME:"W",isDocument:function(){return this.currentProjectType!==this.DOCUMENT_TYPE_WIREFRAME},isUXTestDocument:function(){return this.DOCUMENT_TYPE_UXTEST===this.currentProjectType},getType:function(){return this.currentDocumentType}}}]),angular.module("core").factory("Rest",["Restangular",function(Restangular){"use strict";return Restangular.withConfig(function(RestangularConfigurer){RestangularConfigurer.setBaseUrl("/api"),RestangularConfigurer.setResponseExtractor(function(response){var newResponse=response;return angular.isArray(response)?angular.forEach(newResponse,function(value,key){newResponse[key].originalElement=angular.copy(value)}):newResponse.originalElement=angular.copy(response),newResponse})})}]),angular.module("core").factory("Settings",["$rootScope","$state","localStorageService","ProjectsService",function($rootScope,$state,localStorageService,ProjectsService){"use strict";var getValue=function(value,defaultValue){return"string"==typeof value?"true"===value:defaultValue};return{showResolvedComments:getValue(localStorageService.get("showResolvedComments"),!0),showCurrentPageOnly:getValue(localStorageService.get("showCurrentPageOnly"),!0),isResponsive:!1,disableComments:!1,disableSitemap:!1,disableLiveChanges:!1,minimized:localStorageService.get("minimized")?localStorageService.get("minimized").split(","):[],setShowCurrentPageOnly:function(value){localStorageService.set("showCurrentPageOnly",value),this.showCurrentPageOnly=value},setShowResolvedComments:function(value){localStorageService.set("showResolvedComments",value),this.showResolvedComments=value,$rootScope.$emit(PreviewEnums.ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED,value)},setResponsive:function(value){this.isResponsive=value},updateMinimized:function(){localStorageService.set("minimized",this.minimized.join(","))},getModeSettings:function(mode){return mode=mode||"",{comments:mode.indexOf("c")===-1,sitemap:mode.indexOf("m")===-1,liveChanges:mode.indexOf("d")===-1}},setMode:function(mode){var settings=this.getModeSettings(mode);mode&&"string"==typeof mode?(this.disableComments=!settings.comments,this.disableSitemap=!settings.sitemap,this.disableLiveChanges=!settings.liveChanges):(this.disableComments=!1,this.disableSitemap=!1,this.disableLiveChanges=!1),ProjectsService.isDocument()&&(this.disableSitemap=!0),ProjectsService.isUXTestDocument()&&(this.disableComments=!0),$rootScope.$emit(PreviewEnums.ON_MODE_CHANGED)},isExport:function(){return"export"===ApplicationConfiguration.mode},isMenuEnabled:function(){return ApplicationConfiguration.menuEnabled}}}]),angular.module("core").factory("socket",["$rootScope",function($rootScope){"use strict";return SocketServiceHelper(ApplicationConfiguration.socketServerURL,$rootScope)}]),angular.module("core").factory("UsabilityTestService",["_","$q","$translate","LiveSessionService",function(_,$q,$translate,LiveSessionService){"use strict";var EVENTS=LiveShare.enums.EVENTS,STATUS_FINISHED=2,UsabilityTestService=function(){LiveSessionService.apply(this,arguments),this.isWizardOpen=!1,this.testDataId=null,this.testData=null,this.fetchPromise=null,this.getIdDefer=$q.defer()},proto=UsabilityTestService.prototype;return proto=_.extend(proto,LiveSessionService.prototype),proto.constructor=UsabilityTestService,proto.startInitializing=function(data){var config={};data.options&&(config.options=data.options),this.storeData(data.testData),LiveSessionService.prototype.startInitializing.call(this,config)},proto.initializeLiveShare=function(data){var liveShare=LiveSessionService.prototype.initializeLiveShare.apply(this);return liveShare.on(EVENTS.UPDATE_TASKS,this.fireObserverCallback.bind(this,EVENTS.UPDATE_TASKS)),liveShare.on(EVENTS.OPTIONS_CHANGED,this.fireObserverCallback.bind(this,EVENTS.OPTIONS_CHANGED)),liveShare.on(EVENTS.TESTER_JOINED,this.onTesterJoined.bind(this)),liveShare},proto.storeData=function(data){this.testData=data},proto.getTestData=function(){return this.testData},proto.save=function(){var d=$q.defer();return this.restangular.one("").post("usability-test",this.testData).then(function(testData){this.testData=testData,d.resolve(testData)}.bind(this),function(err){d.reject(new Error(err))}),d.promise},proto.getConfigurationOptions=function(){return $translate(["UT_OPTION_CAN_CLOSE_TASK","UT_OPTION_SEE_SITEMAP"]).then(function(translations){return this.roomConfigurationOptions||(this.roomConfigurationOptions=[{name:translations.UT_OPTION_CAN_CLOSE_TASK,value:!1,param:"canCloseTasks"},{name:translations.UT_OPTION_SEE_SITEMAP,value:!1,param:"seeSitemap"}]),this.roomConfigurationOptions}.bind(this))},proto.setDataId=function(dataId){this.testDataId=dataId,this.getIdDefer.resolve(dataId)},proto.getDataId=function(){return this.getIdDefer.promise},proto.fetch=function(){if(this.fetchPromise)return this.fetchPromise;var d=$q.defer();return this.testData?d.resolve(this.testData):this.getDataId().then(function(dataId){this.restangular.one("usability-test",this.testDataId).get().then(function(data){this.testData=data,d.resolve(data)}.bind(this),function(err){d.reject(err)})}.bind(this)),this.fetchPromise=d.promise,d.promise},proto.resolveTask=function(id){this.liveShare.resolveTask(id)},proto.startSession=function(userType){this.liveShare.startUTSession(userType)},proto.onTesterJoined=function(data){this.testData.started_at=data.started_at,this.fireObserverCallback(EVENTS.TESTER_JOINED,data)},proto.finishTestingSession=function(){return this.restangular.one("usability-test",this.testData._id).customPUT({started_at:this.testData.started_at,finished_at:new Date,status:STATUS_FINISHED})},new UsabilityTestService(LiveShare.enums.SESSION_TYPES.TESTING)}]),angular.module("core").factory("UsersService",["$q","Rest","ProjectsService","localStorageService","Settings",function($q,Rest,ProjectsService,localStorageService,Settings){"use strict";function _getCollaborators(projectHash,collectionId){var d;return Settings.isExport()?(d=$q.defer(),d.resolve([]),d.promise):Rest.one("projects",projectHash).one("collections",collectionId).all("collaborators").getList()}return{collaboratorsMap:{},collaboratorEmails:[],me:function(userData){return userData.is_anonymous&&localStorageService.get("anonymousName")&&(userData.name=localStorageService.get("anonymousName")),userData}(ApplicationConfiguration.userData),getCollaborators:function(){var projectHash=ProjectsService.currentProjectHash,collectionId=ProjectsService.currentCollectionId,d=$q.defer();return _getCollaborators(projectHash,collectionId).then(function(collaborators){this.generateCollaboratorsMap(collaborators),this.generateCollaboratorEmails(collaborators),d.resolve(collaborators)}.bind(this),function(error){d.reject(error)}),d.promise},generateCollaboratorsMap:function(collaborators){_.forIn(this.collaboratorsMap,function(value,key){delete this.collaboratorsMap[key]}.bind(this)),collaborators.forEach(function(collaborator){this.collaboratorsMap[collaborator.id_user]=collaborator}.bind(this))},generateCollaboratorEmails:function(collaborators){collaborators.forEach(function(collaborator){this.collaboratorEmails.push(collaborator.email)}.bind(this))},isAnonymous:function(){return this.me.is_anonymous},isAnonymousNameSet:function(){return"anonymous"!==this.me.name},isInProjectsAccount:function(){return this.me.is_in_projects_account},setAnonymousName:function(name){this.me.name=name,localStorageService.set("anonymousName",name)},getAnonymousName:function(){return this.me.name},getCollaboratorByEmail:function(email){var collaborator=null;return _.forIn(this.collaboratorsMap,function(value,key){if(value.email===email)return collaborator=value,!1}.bind(this)),collaborator}}}]),angular.module("core").factory("UXPinService",["ProjectsService","PagesService","DocumentsService",function(ProjectsService,PagesService,DocumentsService){"use strict";var uxpinURL=ApplicationConfiguration.uxpinURL,wireframeURL=uxpinURL+"/edit/";return{applicationURL:uxpinURL,collectionURL:uxpinURL+"/dms/Collections/Show/",wireframeURL:wireframeURL,documentURL:uxpinURL+"/dms/Documents/Default/",dashboardURL:uxpinURL+"/dms/Dashboard/Default/",getCurrentDocumentURL:function(){switch(ProjectsService.currentProjectType){case ProjectsService.DOCUMENT_TYPE_WIREFRAME:return this.wireframeURL+ProjectsService.currentProjectId+"#?id_page="+PagesService.currentPageId;case ProjectsService.DOCUMENT_TYPE_PERSONA:case ProjectsService.DOCUMENT_TYPE_BMC:case ProjectsService.DOCUMENT_TYPE_PC:return this.documentURL+DocumentsService.currentDocumentId;default:return null}},getCurrentCollectionURL:function(){return this.collectionURL+ProjectsService.currentCollectionId},getDashboardURL:function(){return this.dashboardURL}}}]),angular.module("core").run(["$templateCache",function($templateCache){$templateCache.put("/scripts/modules/core/views/breadcrumbs.view.html",'<li ng-repeat="breadcrumb in breadcrumbs">\n    <span>{{breadcrumb}}</span>\n    <span ng-if="$last" class="breakpoint" ng-bind-html="breakpoint"></span>\n</li>\n'),$templateCache.put("/scripts/modules/core/views/canvas.view.html",'<main class="canvas-main-container" ng-class="{\'no-logo\': firstTimeLoaded}" adjust-to-viewport-size>\n    <section class="scrolled-container">\n        <section id="canvas-wrapper" class="scrolled-content">\n            <section class="canvas-container" ng-style="dimensions" ng-class="{\'document-uxtest\': isUXTestDocument}">\n                <section class="preview-container" add-comment>\n                    <div ng-if="!isDocument" class="ng-canvas-container" ng-style="overflow">\n                      <div class="ng-canvas"></div>\n                      <div class="ng-overlay"></div>\n                    </div>\n                    <div ng-if="isDocument" ng-include="contentPath" onload="onContentLoaded()" class="canvas-content" ng-style="overflow"></div>\n                    <preview-pin ng-show="addingComment" comment x="{{clickX}}" y="{{clickY}}"></preview-pin>\n                    <preview-pin\n                        ng-repeat="comment in list"\n                        comment="comment"\n                        x="{{comment.position.x}}"\n                        y="{{comment.position.y}}">\n                    </preview-pin>\n                </section>\n            </section>\n        </section>\n    </section>\n\n    <usability-test-plugin-tip ng-if="isUTSession"></usability-test-plugin-tip>\n    <media-access-tip ng-if="isLiveSession || isUTSession"></media-access-tip>\n</main>\n'),$templateCache.put("/scripts/modules/core/views/comments-notes.view.html",'<section class="left-panel" id="comments-notes"> <!--ng-class="{\'visible\' : isVisible()}"-->\n    <input type="radio" class="tab-radio" name="tab" id="comments-tab" checked>\n    <label for="comments-tab">{{\'LBL_COMMENTS\' | translate}} <span class="notification-bubble">2</span></label>\n    <section id="comments-panel" class="tab-container" ng-class="{\'loading\' : loading}">\n        <header>\n            <div class="filter">\n                <input type="checkbox" id="show-current-page-only-comments" class="state-helper" ng-model="showCurrentPageOnly" ng-change="onShowCurrentPageOnly()" ng-disabled="isDocument">\n                <label for="show-current-page-only-comments" class="fake-choose-label fake-checkbox">{{\'LBL_CURRENT_PAGE\' | translate}}</label>\n            </div>\n            <form action="#" class="search">\n                <label for="comments-list-search" class="icon-font-search only-icon-font" ng-click="onSearchClick($event)">Search</label>\n                <input type="text" placeholder="{{\'INFO_SEARCH\' | translate}}" id="comments-list-search" ng-class="{\'active\' : searchFor}" ng-model="searchFor" ng-keydown="keyDown($event)" sync-focus-with="focused">\n                <span class="reset-search" ng-click="searchFor=\'\'; focused=false;">Reset search</span>\n            </form>\n        </header>\n        <section class="scrolled-container">\n            <section id="comments-list" class="scrolled-content" ng-if="showCurrentPageOnly">\n                <preview-comment-container ng-repeat="comment in list" type="panel" comment="comment"></preview-comment-container>\n                <section class="empty-list" ng-class="{\'hidden\' : comments.length}">\n                    <h1>{{\'INFO_NO_COMMENTS\' | translate}}</h1>\n                    <a ng-href="" class="add-new-comment" ng-click="addNewComment()">{{\'INFO_ENTER_COMMENT_MODE\' | translate}}</a>\n                </section>\n            </section>\n            <section id="comments-list" class="scrolled-content" ng-if="!showCurrentPageOnly">\n                <section class="page-grouped-comments" ng-repeat="(pageId, page) in tree" ng-class="{\'all-page-comments-hidden\' : isPageHidden(pageId)}">\n                    <h3 highlight search-for="searchFor" input-text="getPageName(pageId)" ng-click="togglePageHidden($event, pageId)"></h3>\n                    <section class="page-grouped-breakpoints" ng-repeat="(breakpointId, comments) in page">\n                        <h4 ng-if="showBreakpoints()" ng-bind-html="getBreakpointName(breakpointId)"></h4>\n                        <preview-comment-container ng-repeat="comment in comments" type="panel" comment="comment"></preview-comment-container>\n                    </section>\n                </section>\n                <section class="empty-list" ng-class="{\'hidden\' : comments.length}">\n                    <h1>{{\'INFO_NO_COMMENTS\' | translate}}</h1>\n                    <a ng-href="" class="add-new-comment" ng-click="addNewComment()">{{\'INFO_ENTER_COMMENT_MODE\' | translate}}</a>\n                </section>\n            </section>\n        </section>\n    </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/commentsFilter.view.html",'<pv-select\n  class="comment-filter-panel"\n  ng-class="{\'anonymous-mode\': !vm.commentTypesActive}"\n  ng-model="vm.selectedFilter"\n  options="vm.filterOptions"\n  option-tpl="pvOptionWithShortcut.html"\n  ng-change="vm.handleFilterChange()">\n  <form class="filter">\n    <input\n      id="show-resolved-comments"\n      class="state-helper"\n      type="checkbox"\n      ng-model="vm.showResolved"\n      ng-change="vm.handleShowResolvedChange()" />\n    <label for="show-resolved-comments" class="fake-choose-label fake-checkbox inside-cloud">{{ \'LBL_SHOW_RESOLVED\' | translate }}</label>\n  </form>\n</pv-select>'),$templateCache.put("/scripts/modules/core/views/home.view.html","<ui-view></ui-view>\n"),$templateCache.put("/scripts/modules/core/views/nav.view.html",'<section id="main-toolbar" ng-if="params.toolbarEnabled" toggle-visibility toggle-flag="isToolbarVisible()" toggle-width-open="100" toggle-width-closed="0">\n    <nav>\n        <ul ng-if="isUserTesting && isHostSession && sessionStartTime">\n            <li>\n                <a ng-href="#" class="only-icon-font icon-stop" data-show-node="tiny-tooltip" ng-click="onClickFinishSession($event)">\n                    <span class="tiny-tooltip">{{\'TIP_FINISH_SESSION\' | translate}}</span>\n                    <time-counter start-time="{{sessionStartTime}}"></time-counter>\n                </a>\n            </li>\n        </ul>\n\n        <ul ng-if="!isUserTesting">\n            <li ng-repeat="item in items | filter : {section: 1}">\n                <a ng-class="isActive(item.state) ? \'active \' + item.classes : item.classes" class="only-icon-font" data-show-node="tiny-tooltip" ng-click="onClick(item)">\n                    <span class="tiny-tooltip">{{item.tooltip | translate}}</span>\n                </a>\n            </li>\n        </ul>\n\n        <ul ng-if="!isUserTesting">\n            <li ng-repeat="item in items | filter : {section: 2}">\n                <a ng-class="isActive(item.state) ? \'active \' + item.classes : item.classes" class="only-icon-font" data-show-node="tiny-tooltip" ng-click="onClick(item)">\n                    <span class="tiny-tooltip">{{item.tooltip | translate}}</span>\n                </a>\n                <nav style="display: none;">\n                  <ul>\n                    <li>\n                      <a href="#" class="chat-all only-icon-font">\n                        Chat all\n                        <span class="tiny-tooltip">Open team chat</span>\n                      </a>\n                    </li>\n                    <li>\n                      <a href="#" class="call-all only-icon-font">\n                        Call all\n                        <span class="tiny-tooltip">Open team call</span>\n                      </a>\n                    </li>\n                  </ul>\n\n                  <ul class="users-list">\n                    <li>\n                      <a href="#" class="user avatar" data-show-node="tiny-tooltip">\n                        <img src="" alt="">\n                        <strong>KZ</strong>\n                        <span class="tiny-tooltip">Click to chat</span>\n                      </a>\n                    </li>\n                    <li>\n                      <a href="#" class="user avatar" data-show-node="tiny-tooltip">\n                        <img src="" alt="">\n                        <strong>KZ</strong>\n                        <span class="tiny-tooltip">Click to chat</span>\n                      </a>\n                    </li>\n                    <li>\n                        <a href="#" class="only-icon-font icon-font-workers add-user" data-show-node="tiny-tooltip">\n                            <span class="tiny-tooltip">Add another user</span>\n                        </a>\n                    </li>\n                  </ul>\n                </nav>\n            </li>\n        </ul>\n\n        <ul ng-if="!isUserTestingSession && !isLiveShareSession">\n            <!-- Usability Testing -->\n            <li ng-if="params.isLogged && params.features.user_testing && !params.isDocument && params.isOwner">\n                <a ng-click="onClickUsabilityTestSession()" class="only-icon-font icon-font-usability-testing" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">Usability testing <small>(beta)</small></span>\n                </a>\n            </li>\n            <li ng-if="params.isLogged && params.features.user_testing && !params.isDocument && !params.isOwner">\n                <div class="fake-button only-icon-font icon-font-usability-testing inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">\n                        Usability testing <small>(beta)</small>. Only project owner can start session.\n                    </span>\n                </div>\n            </li>\n            <li ng-if="!params.isLogged && !params.isExport">\n                <div class="fake-button only-icon-font icon-font-usability-testing inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">Usability testing <small>(beta)</small>. Please log in to create session.</span>\n                </div>\n            </li>\n            <li ng-if="params.isLogged && !params.features.user_testing" class="plan-feature">\n                <div class="fake-button only-icon-font icon-font-usability-testing inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip pro-tooltip">\n                        <small class="pro-label">Pro+</small>\n                        Usability testing is available in Pro+ Plan. <a href="{{upgradePlanURL}}" target="_blank">Upgrade now!</a></a>\n                    </span>\n                </div>\n            </li>\n\n            <!-- Live Share -->\n            <li ng-if="params.isLogged && params.features.live_share && !params.isDocument && params.isOwner">\n                <a ng-click="onConfigureLiveShareSession($event)" class="only-icon-font icon-font-live-share" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">Live Presentation</span>\n                </a>\n            </li>\n            <li ng-if="params.isLogged && params.features.live_share && !params.isDocument && !params.isOwner">\n                <div class="fake-button only-icon-font icon-font-live-share inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">Live Presentation. Only project owner can start session.</span>\n                </div>\n            </li>\n            <li ng-if="params.isLogged && !params.features.live_share" class="plan-feature">\n                <div class="fake-button only-icon-font icon-font-live-share inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip pro-tooltip">\n                        <small class="pro-label">Pro+</small>\n                        Live Presentation is available in Pro+ Plan. <a href="#live-share-info" ng-click="onClickPlanUpgrade($event)">See more!</a>\n                    </span>\n                </div>\n            </li>\n            <li ng-if="!params.isLogged && !params.isExport">\n                <div class="fake-button only-icon-font icon-font-live-share inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">Live Presentation. Please log in to create session.</span>\n                </div>\n            </li>\n        </ul>\n\n        <ul ng-if="params.isLogged">\n            <li ng-if="params.currentDocumentURL">\n                <a href="{{params.currentDocumentURL}}" data-show-node="tiny-tooltip" class="only-icon-font icon-font-edit-object">\n                    <span class="tiny-tooltip">Edit document</span>\n                </a>\n            </li>\n            <li>\n                <a href="{{params.dashboardURL}}" data-show-node="tiny-tooltip" class="only-icon-font icon-font-back">\n                    <span class="tiny-tooltip">Back to dashboard</span>\n                </a>\n            </li>\n        </ul>\n    </nav>\n\n    <a ng-click="closeToolbar()" data-show-node="tiny-tooltip" class="close-nav" ng-if="!isUserTestingSession && !isLiveShareSession">\n        <span class="tiny-tooltip">Close main toolbar</span>\n    </a>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/sidebar.view.html",'<script type="text/ng-template" id="sitemap.view.html">\n    <section id="sitemap-panel">\n        <header>\n            <h2>Sitemap</h2>\n            <form action="#" class="search">\n                <label for="pages-list-search" class="icon-font-search only-icon-font" ng-click="onSearchClick($event)">Search</label>\n                <input type="text" placeholder="{{\'INFO_SEARCH_SITEMAP\' | translate}}" id="pages-list-search" ng-class="{\'active\' : searchFor}" ng-model="searchFor" ng-keydown="keyDown($event)" sync-focus-with="focused">\n                <span class="reset-search" ng-click="searchFor=\'\'; focused=false;">Reset search</span>\n            </form>\n        </header>\n        <section class="scrolled-container">\n            <section class="pages-list scrolled-content" ng-class="{\'indent\' : isIndent()}">\n                <ul>\n                    <li ng-repeat="node in tree | filter : filterSearch : comparatorSearch" ng-include="\'node_template.html\'"></li>\n                </ul>\n            </section>\n        </section>\n    </section>\n</script>\n\n<script type="text/ng-template" id="tasks-sitemap.view.html">\n    <input type="radio" class="tab-radio" name="tab" id="tasks-tab" checked>\n    <label for="tasks-tab">Tasks</label>\n\n    <section id="tasks-panel" class="tab-container">\n        <section class="scrolled-container">\n            <section id="tasks-list" class="tasks-list scrolled-content" ng-controller="UsabilityTestTasksController">\n                <ul>\n                    <li class="task-container" ng-repeat="task in params.tasks" ng-class="{\'resolved\': task.resolved}">\n                        <h3><span>Task {{$index + 1}}:</span>{{task.title}}</h3>\n                        <section class="task-body">\n                            <p>{{task.content}}</p>\n\n                            <button class="btn-solid blue"\n                                    ng-if="isResolveButton"\n                                    ng-click="onClickResolveTask($event, task)"\n                                    ng-disabled="task.resolved">Mark as resolved</button>\n                        </section>\n                    </li>\n                </ul>\n            </section>\n        </section>\n    </section>\n\n    <input ng-if="isSitemapAvailable" type="radio" class="tab-radio" name="tab" id="sitemap-tab">\n    <label ng-if="isSitemapAvailable" for="sitemap-tab">Sitemap</label>\n\n    <section ng-if="isSitemapAvailable" id="sitemap-panel" class="tab-container">\n        <section class="scrolled-container">\n            <section class="pages-list scrolled-content" ng-class="{\'indent\' : isIndent()}">\n                <ul>\n                    <li ng-repeat="node in tree | filter : filterSearch : comparatorSearch" ng-include="\'node_template.html\'"></li>\n                </ul>\n            </section>\n        </section>\n    </section>\n\n    <section ng-show="isHost" class="streaming-video" id="publisher"></section>\n    <section ng-show="isHost" class="streaming-video" id="subscribers">\n        <div class="waiting-for-transmission working" ng-if="isMessageVisible">\n            <p>{{message}}</p>\n        </div>\n    </section>\n</script>\n\n<script type="text/ng-template" id="node_template.html">\n    <a ng-href="" ng-init="init(node.id)" ng-class="{\'active\' : isActive(node.id)}" ng-click="onClick($event,node.id)"><span highlight search-for="searchFor" input-text="getPageName(node.id)"></span></a>\n    <input ng-if="node.nodes.length" type="checkbox" id="{{\'node-\'+node.id}}" ng-model="minimized[node.id]" ng-change="toggleMinimized(node.id)">\n    <label ng-if="node.nodes.length" for="{{\'node-\'+node.id}}"></label>\n    <ul>\n        <li ng-repeat="node in node.nodes | filter : filterSearch : comparatorSearch" ng-include="\'node_template.html\'"></li>\n    </ul>\n</script>\n\n<section class="left-panel"\n         id="tasks-sitemap"\n         ng-controller="SitemapController"\n         ng-include="\'tasks-sitemap.view.html\'"\n         ng-if="isUserTesting">\n</section>\n<section class="left-panel"\n         id="sitemap"\n         ng-controller="SitemapController"\n         ng-include="\'sitemap.view.html\'"\n         ng-if="!isUserTesting">\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/appViewPromo/appViewPromo.directive.html",'<section id="install-on-device" class="mobile-overlay" ng-class="{\'is-android\': isAndroid, \'is-ios\': !isAndroid}">\n    <div class="centering-container">\n        <div class="white-cloud" ng-if="!isAndroid">\n            <p>Add prototypes to your Home Screen <br>to view them  without browser toolbars.</p>\n            <p class="instruction">Tap<span class="mobile-share ios-share icon-font-ios-share only-icon-font"></span>then "Add to Home Screen"</p>\n\n            <a ng-click="close()" class="close-overlay only-icon-font icon-font-close">close</a>\n        </div>\n        <div class="white-cloud" ng-if="isAndroid">\n            <p>Add prototypes to your Home Screen <br>to view them  without browser toolbars.</p>\n            <p class="instruction">Tap<span class="mobile-share android-share icon-font-ellipsis only-icon-font"></span>then "Add to Home Screen"</p>\n\n            <a ng-click="close()" class="close-overlay only-icon-font icon-font-close">close</a>\n        </div>\n    </div>\n</section>\n'),
$templateCache.put("/scripts/modules/core/directives/avatar/pvAvatar.html",'<figure class="avatar">\n  <strong ng-if="!vm.url">{{ vm.initials }}</strong>\n  <img ng-if="vm.url" ng-src="{{ vm.url }}" alt="">\n</figure>'),$templateCache.put("/scripts/modules/core/directives/breakpoints/pvBreakpoints.html",'<ul class="breakpoints">\n  <li ng-repeat="breakpoint in vm.breakpoints"\n      class="tab item"\n      ng-if="vm.isUnlocked(breakpoint.id)">\n    <a ng-href=""\n       ng-class="{\'active\' : vm.isActive(breakpoint.id)}"\n       ng-click="vm.onClick(breakpoint.id)">\n        {{breakpoint.name}}\n    </a>\n  </li>\n</ul>\n'),$templateCache.put("/scripts/modules/core/directives/comment/pvCommentForm.html",'<form>\n  <div class="fake-textarea"></div>\n  <section class="submit-menu">\n    <button type="button" class="btn-solid blue add-comment">\n      {{\'BTN_ADD_COMMENT\' | translate}}\n    </button>\n  </section>\n</form>\n'),$templateCache.put("/scripts/modules/core/directives/controls/pvToggler.html",'<a ng-href="" class="mark-resolved icon-general-ticker" title="{{title}}"></a>'),$templateCache.put("/scripts/modules/core/directives/mediaAccessTip/mediaAccessTip.directive.html",'<section ng-class="{\'visible\': isTipVisible, \'denied\': isDenied}" class="warning-tooltip access-rights">\n    <p ng-if="!isDenied">UXPin needs access to your microphone and camera to record audio or to embed a camera feed.</p>\n    <p ng-if="isDenied">You have denied access. You are not able to record Usability testing. Change your settings.</p>\n\n    <a ng-click="onClickClose()" class="icon-font-close only-icon-font close-info">close info</a>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/notify/pvNotify.html",'<div class="notify-wrapper">\n  Notify:\n  <a ng-href="" class="icon-general-chevron" ng-click="vm.toggle()">\n    <span>{{vm.selected.length | notifyLabel:vm.filters}}</span>\n  </a>\n\n  <section ng-if="vm.isOpen" class="cloud standard notify-users options-cloud visible">\n    <span class="selection-trigger">\n      <a\n        href=""\n        id="select-all"\n        ng-class="{\'active\': vm.filters.all}"\n        ng-click="vm.selectAll()">\n        All</a>\n       <a\n         href=""\n         id="select-project-members"\n         ng-class="{\'active\': vm.filters.projectMembers}"\n         ng-click="vm.selectProjectMembers()">\n        Project members</a>\n      <a\n        href=""\n        id="select-none"\n        ng-class="{\'active\': vm.filters.none}"\n        ng-click="vm.selectNone()">\n        None</a>\n    </span>\n\n    <pv-multi-select\n      class="list-wrapper"\n      options="vm.people"\n      scroll-to-bottom="vm.scrollToBottom"\n      ng-model="vm.selected"\n      ng-change="vm.updateFilters()">\n    </pv-multi-select>\n\n    <textarea\n      class="dark-style"\n      cols="30"\n      rows="3"\n      placeholder="Not on the list? Add email address and send notification"\n      ng-model="vm.customEmails"\n      ng-keydown="$event.stopPropagation()"\n      pv-enter="vm.onTextareaEnter()"\n      pv-emails-parser=",">\n    </textarea>\n  </section>\n</div>\n'),$templateCache.put("/scripts/modules/core/directives/preview-comment/pvComment.html",'<article class="single-comment" ng-class="{\'new-comment\' : isNew(), \'reply\' : reply, \'reply-form active\' : replyForm}">\n  <section\n    ng-if="isNew()"\n    class="comment-body"\n    ng-click="newCommentClick($event)"\n    ng-include="\'/scripts/modules/core/directives/preview-comment/pvNewComment.html\'">\n  </section>\n\n  <div\n    ng-if="isEditMode()"\n    ng-include="\'/scripts/modules/core/directives/preview-comment/pvEditComment.html\'">\n  </div>\n\n  <div\n    ng-if="isPreviewMode()"\n    ng-include="\'/scripts/modules/core/directives/preview-comment/pvPreviewComment.html\'">\n  </div>\n</article>\n'),$templateCache.put("/scripts/modules/core/directives/preview-comment/pvEditComment.html",'<pv-avatar url="avatarUrl" name="userName"></pv-avatar>\n\n<section class="comment-body edit-mode">\n  <form novalidate>\n    <div class="mention-container">\n      <textarea\n        pv-mention\n        pv-collaborator-mention\n        pv-focus-me="focused"\n        ng-class="{\'error\' : isError, \'disabled\' : inputDisabled}"\n        class="fake-textarea"\n        ng-model="form.text"\n        mentions="form.mentions"\n        ng-disabled="inputDisabled"\n        ng-mousedown="onTextareaMouseDown($event)"\n        ng-keydown="onTextareaKeyDown($event)"\n        placeholder="Edit your comment"></textarea>\n\n      <div\n        ng-class="{ \'visible\': $pvMention.searching }"\n        class="cloud options-cloud mention-cloud"\n        ng-style="$pvMention.menuPosition">\n\n        <ul class="mention-people-list scroll-helper">\n          <li ng-repeat="option in $pvMention.options track by $index"\n              ng-class="{\'active\': $pvMention.activeOption === option}"\n              ng-click="$pvMention.select(option)">\n            <a href="">{{option.name}}</a>\n          </li>\n          <li>\n            <span ng-if="$pvMention.options.length === 0" class="no-users disabled">\n              No users found\n            </span>\n          </li>\n        </ul>\n      </div>\n    </div>\n\n    <ul class="submit-menu btns-group">\n      <li>\n        <button\n            type="button"\n            class="btn-solid blue add-comment"\n            ng-mousedown="submitMe($event)"\n            ng-class="{\'working\' : working}"\n            ng-disabled="inputDisabled">\n          Save\n        </button>\n      </li>\n      <li>\n        <a href="" ng-click="cancelEdit($event)">Cancel</a>\n      </li>\n    </ul>\n  </form>\n</section>\n\n'),$templateCache.put("/scripts/modules/core/directives/preview-comment/pvNewComment.html",'<form novalidate ng-class="{\'disabled\' : inputDisabled, \'form-hidden\': isFormHidden()}">\n  <div class="mention-container">\n    <textarea\n      pv-mention\n      pv-collaborator-mention\n      pv-focus-me="focused"\n      ng-class="{\'error\' : isError}"\n      class="fake-textarea"\n      ng-model="form.text"\n      mentions="form.mentions"\n      ng-disabled="inputDisabled"\n      ng-trim="false"\n      ng-mousedown="onTextareaMouseDown($event)"\n      ng-keydown="onTextareaKeyDown($event)"\n      placeholder="{{inputPlaceholder}}"></textarea>\n\n    <div\n      ng-class="{ \'visible\': $pvMention.searching }"\n      class="cloud standard options-cloud mention-cloud"\n      ng-style="$pvMention.menuPosition">\n\n      <ul class="mention-people-list scroll-helper">\n        <li ng-repeat="option in $pvMention.options track by $index"\n            ng-class="{\'active\': $pvMention.activeOption === option}"\n            ng-click="$pvMention.select(option)">\n          <a href="">{{option.name}}</a>\n        </li>\n        <li>\n          <span ng-if="$pvMention.options.length === 0" class="no-users disabled">\n            No users found\n          </span>\n        </li>\n      </ul>\n    </div>\n  </div>\n\n  <section class="submit-menu">\n    <button\n      type="button"\n      class="btn-solid blue add-comment"\n      ng-mousedown="submitMe($event)"\n      ng-class="{\'working\' : working}"\n      ng-disabled="inputDisabled">\n      {{\'BTN_ADD_COMMENT\' | translate}}\n    </button>\n  </section>\n\n  <footer class="comment-footer">\n    <pv-notify\n      people="notify.people"\n      ng-model="notify.selected"\n      on-open="onNotifyOpen()"\n      on-close="onNotifyClose()"></pv-notify>\n    <div ng-if="replyForm" class="resolve-wrapper" ng-class="{\'resolved\' : parentComment.resolved.is}">\n      <pv-toggler\n        ng-model="parentComment.resolved.is"\n        title="Resolve"\n        true-label="Solved"\n        false-label="Resolve"\n        ng-change="resolveMe(parentComment.resolved.is)"></pv-toggler>\n    </div>\n  </footer>\n</form>\n'),$templateCache.put("/scripts/modules/core/directives/preview-comment/pvPreviewComment.html",'<pv-avatar url="avatarUrl" name="userName"></pv-avatar>\n\n<section class="comment-body">\n  <p>\n    <strong class="author-name">{{comment.user.name}}:&nbsp;</strong>\n    <span highlight search-for="searchFor" input-text="previewText"></span>\n  </p>\n</section>\n\n<div class="comment-options">\n  <span class="time-stamp">{{commentCreatedAt}}</span>\n  <a ng-href=""\n     class="love-it icon-font-heart-outline"\n     ng-class="{\'active\' : isLoved()}"\n     ng-click="loveMe($event)"\n     title="{{isLoved() ? \'DONT_LOVE_IT\' : \'LOVE_IT\' | translate}}">\n    <span ng-if="comment.lovers.length">{{comment.lovers.length}}</span>\n  </a>\n\n  <menu class="cloud-wrapper comment-menu" data-show-node="cloud" ng-if="canEdit">\n    <a class="icon-general-cog only-icon-font">Settings</a>\n    <ul class="cloud standard options-cloud small">\n      <li>\n        <a ng-href="" ng-if="canEditContent" class="edit" ng-class="{\'disabled\': isEditDisabled()}" ng-click="editMe($event)">\n          Edit comment\n        </a>\n        <a ng-href="" class="delete" ng-click="deleteMe($event)">\n          Delete comment\n        </a>\n      </li>\n    </ul>\n  </menu>\n\n  <a ng-href="" class="unresolve resolve-info" data-show-node="tooltip" ng-click="resolveMe($event, false)">\n    <span class="tooltip">\n        {{\'RESOLVED_BY\' | translate:\'{"name": comment.resolved.id_user}\'}}\n        <small>{{commentCreatedAt}}</small>\n    </span>\n  </a>\n</div>\n\n'),$templateCache.put("/scripts/modules/core/directives/preview-comment-container/preview-comment-container.directive.html",'<section\n  class="comments-group"\n  id="group-{{comment ? comment._id : \'new\'}}-{{type}}"\n  ng-class="classes"\n  ng-click="toggle($event)">\n\n  <pv-select\n    ng-if="commentTypesActive"\n    options="commentType.options"\n    ng-model="commentType.selected"\n    ng-change="handleCommentTypeChange()">\n  </pv-select>\n\n  <preview-comment-group\n    ng-if="isNew()"\n    type="{{type}}"\n    x="{{x}}"\n    y="{{y}}"\n    comment-type="commentType.selected">\n  </preview-comment-group>\n\n  <preview-comment-group\n    ng-if="!isNew()"\n    type="{{type}}"\n    reply="selected"\n    comment="comment"\n    comment-type="commentType.selected"\n    comment-children="children">\n  </preview-comment-group>\n\n  <section class="deleting-info" ng-if="deleting">\n    <p>\n      {{\'INFO_DELETED\' | translate}}\n      <a ng-href="" class="undo-delete" ng-click="onClickUndo($event)">\n        {{\'BTN_UNDO\' | translate}}\n      </a>\n    </p>\n  </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/preview-comment-group/preview-comment-group.directive.html",'<section>\n  <preview-comment-panel\n    ng-if="!isNew() && isPanel()"\n    group-id="groupId"\n    comment="comment"\n    comment-type="commentType">\n  </preview-comment-panel>\n\n  <div\n    ng-if="!isNew() && isGroup() && !isCanvas() && toggler.isVisible"\n    class="toggle-replies"\n    ng-click="onTogglerClick($event)"\n    ng-class="{\'replies-hidden\': toggler.isOpen}">\n    <span class="underline-helper">{{toggler.isOpen ? \'Hide\' : commentCountInfo()}} replies</span>\n  </div>\n\n  <preview-comment-panel\n    ng-if="!isNew() && isPanel()"\n    ng-repeat="c in childrenToDisplay track by c._id"\n    group-id="groupId"\n    comment="c"\n    comment-type="commentType"\n    reply="{{reply}}">\n  </preview-comment-panel>\n\n  <preview-comment-panel\n    ng-if="!isNew() && reply && isPanel()"\n    group-id="groupId"\n    comment-type="commentType"\n    parent-id="{{comment._id}}"\n    reply-form="{{reply}}">\n  </preview-comment-panel>\n\n  <preview-comment-canvas\n    ng-if="isNew() && isCanvas()"\n    comment-type="commentType"\n    x="{{x}}"\n    y="{{y}}">\n  </preview-comment-canvas>\n\n  <preview-comment-canvas\n    ng-if="!isNew() && isCanvas()"\n    group-id="groupId"\n    comment="comment"\n    comment-type="commentType">\n  </preview-comment-canvas>\n\n  <div\n    ng-if="!isNew() && isGroup() && isCanvas() && toggler.isVisible"\n    class="toggle-replies"\n    ng-click="onTogglerClick($event)"\n    ng-class="{\'replies-hidden\': toggler.isOpen}">\n    <span class="underline-helper">{{toggler.isOpen ? \'Hide\' : commentCountInfo()}} replies</span>\n  </div>\n\n  <preview-comment-canvas\n    ng-if="!isNew() && isCanvas()"\n    ng-repeat="c in childrenToDisplay track by c._id"\n    group-id="groupId"\n    comment="c"\n    comment-type="commentType"\n    reply="{{reply}}">\n  </preview-comment-canvas>\n\n  <preview-comment-canvas\n    ng-if="!isNew() && reply && isCanvas()"\n    group-id="groupId"\n    comment-type="commentType"\n    group-id="groupId"\n    parent-id="{{comment._id}}"\n    reply-form="{{reply}}">\n  </preview-comment-canvas>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/preview-pin/preview-pin.directive.html",'<section class="comment-point pin"\n         ng-class="classes"\n         ng-dblclick="onDblclick($event)"\n         ng-style="getCommentPointStyle()">\n    <!-- {\'selected\' : selectedDelayed, \'adding-comment\' : isNew(), \'resolved\' : comment.resolved.is, \'dragging\' : isDragging, \'top\' : isTop, \'bottom\' : !isTop, \'left\' : isLeft, \'right\' : !isLeft, \'hide\': deleting} -->\n    <section class="comment-pin" ng-mousedown="startDrag($event)" ng-mouseup="endDrag($event)" toggleable>{{index}}</section>\n    <!--\n    <section class="comment-area">\n    \t<section class="comment-pin">{{index}}</section>\n    </section>\n    -->\n    <preview-comment-container ng-if="selected" type="canvas" comment="comment" comment-type="commentType" x="{{x}}" y="{{y}}" ></preview-comment-container>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/select/pvDefaultOption.html",'<a href="" class="comment-type" ng-class="option.className">\n  {{option.text}}\n</a>\n'),$templateCache.put("/scripts/modules/core/directives/select/pvMultiSelect.html",'<div ng-transclude></div>\n\n<form class="search-form">\n  <label class="icon-general-search only-icon-font" for="search-form-generic">Search for the user...</label>\n  <input\n      id="search-form-generic"\n      class="with-icon"\n      type="text"\n      placeholder="Type to search..."\n      ng-model="vm.searchValue"\n      ng-keyup="vm.search()"\n      ng-keydown="$event.stopPropagation()"/>\n  <button class="icon-general-close only-icon-font" type="reset" ng-click="vm.resetSearch()">Clear</button>\n</form>\n\n<ul class="inside-checkbox-list" pv-scroll-to-bottom="scrollToBottom">\n  <li class="fake-checkbox-with-image" ng-repeat="option in vm.filteredOptions track by option.id">\n    <form>\n      <input type="checkbox" id=user_{{$id}} class="state-helper" ng-model="option.checked" ng-change="vm.select(option)">\n      <label class="fake-choose-label fake-checkbox inside-cloud" for=user_{{$id}}>\n        <pv-avatar url="option.avatar" name="option.name"></pv-avatar>\n        <figcaption>{{option.name}}</figcaption>\n      </label>\n    </form>\n  </li>\n</ul>'),$templateCache.put("/scripts/modules/core/directives/select/pvOptionWithShortcut.html",'<a href="" class="comment-type" ng-class="option.className">\n  {{option.text}}\n  <pv-shortcut keys="option.shortcut"></pv-shortcut>\n</a>\n'),$templateCache.put("/scripts/modules/core/directives/select/pvSelect.html",'<menu class="cloud-wrapper" ng-class="{ \'cloud-disabled\': vm.disabled }">\n  <a class="comment-type icon-general-chevron {{ vm.selectedOption.className }}"\n     ng-class="{\'active\' : vm.isDropdownOpen}"\n     ng-click="vm.toggleDropdown()">\n    <span class="underline-helper">{{ vm.selectedOption.text }}</span>\n  </a>\n  <ul ng-if="!vm.disabled" class="cloud standard options-cloud" ng-class="{\'visible\' : vm.isDropdownOpen}">\n    <li ng-repeat="option in vm.options track by $index"\n        ng-class="{ \'selected\': option === vm.selectedOption }"\n        ng-click="vm.selectOption(option)"\n        ng-include="vm.optionTpl || \'/scripts/modules/core/directives/select/pvDefaultOption.html\'">\n    </li>\n    <li ng-transclude></li>\n  </ul>\n</menu>\n'),$templateCache.put("/scripts/modules/core/directives/shortcut/pvShortcut.html",'<small>\n  <span\n    class="custom-color"\n    ng-repeat="key in vm.keys track by $index"\n    ng-class="key.className">\n    {{key.alt}}\n  </span>\n</small>\n'),$templateCache.put("/scripts/modules/core/directives/usabilityTestPluginTip/usabilityTestPluginTip.directive.html",'<section ng-class="{\'visible\': isTipVisible}" class="user-testing-record-info">\n    <p>If you want to record the session, <br>please click <strong>"Start recording"</strong> button.</p>\n    <a ng-click="onClickClose()" class="icon-font-close only-icon-font close-info">close info</a>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/liveShare/configuration.view.html",'<section id="live-share-settings" class="modal-box-content">\n    <article>\n        <h2>Live Presentation</h2>\n        <section class="session-settings standard-list-container options-list">\n            <h3>Session settings</h3>\n            <ul>\n                <li ng-repeat="option in liveShareOptions">\n                    <input id="initial-config-{{$index}}" class="state-helper" ng-model="option.value" type="checkbox" checked>\n                    <label for="initial-config-{{$index}}" class="fake-choose-label fake-checkbox">{{option.name}}</label>\n                </li>\n            </ul>\n        </section>\n        <h3>Link to session</h3>\n        <div ng-class="{\'working\': !inviteUrl}" class="invite-link-container no-button">\n            <input ng-click="onClickLink($event)" type="text" readonly ng-model="inviteUrl">\n        </div>\n        <button ng-click="start()" class="btn-solid blue">Start live session</button>\n    </article>\n    <aside>\n\n    </aside>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/liveShare/finish.view.html",'<section class="live-share-landing full-page-landing visible">\n    <div class="centering-block" ng-switch="type">\n        <h1 class="icon-general-uxpin-logo only-icon-font">UXPin</h1>\n\n        <h2 translate translate-values="{\'projectName\': projectName}">{{message}}</h2>\n        <a ng-href="#" ng-if="backUrl" ng-click="onClickBackToPreview($event)" class="back-to-preview">{{ \'LS_BACK_TO_PREVIEW\' | translate }}</a>\n    </div>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/liveShare/initialize.view.html",'<section class="live-share-landing full-page-landing with-input visible">\n    <div class="centering-block">\n        <h1 class="icon-general-uxpin-logo only-icon-font">UXPin</h1>\n        <section class="progressbar line">\n            <span class="progress" style="width: {{loadingProgress}}%"></span>\n        </section>\n\n        <h2>Loading <strong>{{projectName}}</strong> {{sessionTypeName|translate}}.</h2>\n        <form name="setNameForm" ng-if="loginUrl" ng-submit="onFormSubmit(name)">\n            <fieldset>\n                <p>My name is</p>\n                <input required autofocus type="text" ng-model="name" name="name"><em>*</em>\n                <button ng-disabled="setNameForm.$invalid" type="submit" class="btn-solid blue" ng-class="{\'working\': working}">That\'s me</button>\n                <small class="tip">* To join {{projectName}} live preview session you need to set your name.</small>\n            </fieldset>\n        </form>\n    </div>\n    <section ng-if="loginUrl" class="login-toolbar bottom-position visible">Are you registered UXPin user? <a href="{{loginUrl}}">Please login</a>.</section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/planUpgrade/modal.view.html",'<section id="liveshare-dialogbox" class="visible dialogbox-container with-video modal-box-content">\n    <section class="movie-part">\n        <img src="/img/uxpin-logo.svg" width="72" height="72" alt="" class="logo">\n\n        <a ng-click="closeMovie($event)" class="close-movie action-close-movie">{{\'UM_CLOSE_MOVIE\'|translate}}</a>\n\n        <figure class="movie-cover">\n            <img width="394px" height="400px" src="/img/welcome-modal-pic.jpg" alt="">\n        </figure>\n\n        <youtube-video video-id="video.id" player="video.player" class="movie-container"></youtube-video>\n    </section>\n    <section class="content-part">\n        <h2 translate>{{\'UM_MODAL_HEADER\'|translate}}</h2>\n\n        <p>{{\'UM_MODAL_TEXT\'|translate}}</p>\n\n        <a ng-click="closeModal($event)" class="close-modal-button icon-font-close only-icon-font close-movie action-close-movie">{{\'UM_CLOSE_MODAL\'|translate}}</a>\n\n        <a ng-click="playMovie($event)" class="btn-ghost btn-inline icon-font-play with-icon action-close-dialogbox show-me">{{\'UM_HOW_IT_WORKS\'|translate}}</a>\n\n        <p class="small-tip"><span class="pro-label">{{\'UM_PRO_PLUS\'|translate}}</span> {{\'UM_PRO_PLUS_TEXT\'|translate}}\n          <a ng-click="upgradePlan($event)" href="{{upgradePlanURL}}" class="btn-solid blue upgrade-now">\n            {{\'UM_UPGRADE_NOW\'|translate}}\n          </a>\n        </p>\n    </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/settingsBar/liveShare.view.html",'<li ng-if="isHostSession == true || isUserTestingMode == false" preview-cloud>\n    <a class="live-share-users only-icon-font icon-font-user cursor-follow" preview-cloud-trigger>\n        <span class="tooltip bottom-arrow">{{isUserTestingMode ? \'UT_USERS\' : \'LS_USERS\' | translate}}</span>\n    </a>\n    <ul class="users-list avatars-only horizontal cloud collaborators-cloud">\n        <li ng-repeat="collaborator in collaborators">\n            <div class="user avatar" ng-class="{\'muted\' : collaborator.muted}">\n                <strong>{{collaborator.name | limitTo:1 | uppercase}}</strong>\n                <img ng-if="collaborator.customData.avatar" ng-src="{{collaborator.customData.avatar}}" alt="{{collaborator.name}}">\n                <span class="user-color" style="background: {{collaborator.color}};"></span>\n                <span class="mic-off icon-font-mic-off only-icon-font"></span>\n                <span ng-if="isHostSession && collaborator.type !== \'host\'" ng-click="onClickRemoveUser($event, collaborator.id)" class="delete-user icon-font-rounded-close-outline only-icon-font"></span>\n            </div>\n        </li>\n    </ul>\n</li>\n\n<li ng-if="isUserTestingMode == false && isHostSession == false">\n    <a ng-href="#" ng-click="onClickFollowHost($event)" ng-class="{\'active\': host.isFollowed}" style="background-color: {{host.color}};" class="cursor icon-font-cursor-default only-icon-font" data-show-node="tiny-tooltip">\n        <span class="tooltip bottom-arrow">{{\'LS_FOLLOW_CURSOR\' | translate}}</span>\n    </a>\n</li>\n\n<li ng-if="isHostSession == true" preview-cloud="settingsPanelVisibilityModel">\n    <a ng-click="onClickToggleSettingsPanel($event);" class="only-icon-font icon-font-gear" preview-cloud-trigger>\n        <span ng-if="isUserTestingMode" class="tooltip bottom-arrow right-float">{{\'UT_SETTINGS\' | translate}}</span>\n        <span ng-if="!isUserTestingMode" class="tooltip bottom-arrow">{{\'LS_SETTINGS\' | translate}}</span>\n    </a>\n    <div class="cloud big options-cloud">\n        <section class="standard-list-container session-settings options-list-container">\n            <h3>{{\'LS_SESSION_SETTINGS\' | translate}}:</h3>\n            <ul class="options-list">\n                <li ng-repeat="option in configuration">\n                  <form>\n                    <input ng-change="setOption(option)" class="state-helper" ng-model="option.value" id="live-share-setting-{{$index}}" type="checkbox">\n                    <label for="live-share-setting-{{$index}}" class="fake-choose-label fake-checkbox inside-cloud">{{option.name}}</label>\n                  </form>\n                </li>\n            </ul>\n        </section>\n        <section class="live-share-link">\n            <h3>{{\'LS_LINK_TO_SESSION\' | translate}}</h3>\n            <div class="invite-link-container">\n                <input type="text" ng-click="onClickInut($event)" readonly ng-model="inviteURL" class="url-input dark-style">\n                <button clip-copy="inviteURL" ng-click="onClickCopy($event);" class="copy-link icon-font-link only-icon-font btn-bordered small-size light-blue-style">{{\'LS_COPY\' | translate}}</button>\n                <span class="information" ng-class="{\'visible\': isCopied}">{{\'LS_LINK_HAS_BEEN_COPIED\' | translate}}</span>\n            </div>\n        </section>\n    </div>\n</li>\n\n<li ng-if="isUserTestingMode == false">\n    <a class="mic-off only-icon-font icon-font-mic-off" ng-class="{\'active\' : muted}" ng-click="onClickMute($event)">\n        <span class="tooltip bottom-arrow">{{\'LS_TOGGLE_MUTE\' | translate}}</span>\n    </a>\n</li>\n\n<li ng-if="isHostSession == true || isUserTestingMode == false">\n    <a ng-click="onClickFinishSession($event)" class="exit-live-share only-icon-font icon-font-close">\n        <span class="tooltip bottom-arrow">{{\'LS_LEAVE_SESSION\' | translate}}</span>\n    </a>\n</li>\n'),$templateCache.put("/scripts/modules/core/views/settingsBar/preview.view.html",'<!-- Interactions -->\n<li ng-if="!params.isDocument">\n    <a class="only-icon-font icon-font-thunder" ng-click="onClickHighlight($event)">\n        Highlight interactions\n        <span class="tooltip bottom-arrow">Highlight interactions</span>\n    </a>\n</li>\n\n<!-- Settings -->\n<li ng-if="!params.isUXTestDocument && !params.isExport" class="settings" preview-cloud>\n    <a class="only-icon-font icon-font-autoresize" preview-cloud-trigger>\n        Settings\n        <span class="tooltip bottom-arrow">Settings</span>\n    </a>\n    <section class="settings cloud big options-cloud bottom-arrow">\n        <ul class="options-list">\n            <li ng-if="!params.isDocument">\n              <form>\n                <input type="checkbox" id="settings-responsive" class="state-helper" ng-model="params.isResponsive" ng-change="onResponsive()">\n                <label for="settings-responsive" class="fake-choose-label fake-checkbox inside-cloud">\n                  Auto set breakpoints to match </br>the browser window size\n                </label>\n              </form>\n            </li>\n        </ul>\n    </section>\n</li>\n\n<!-- Share -->\n<li preview-cloud ng-if="!params.isExport">\n    <a class="only-icon-font icon-font-share" preview-cloud-trigger>\n        Share\n        <span class="tooltip bottom-arrow">Share</span>\n    </a>\n    <div class="share-settings-cloud cloud big options-cloud bottom-arrow">\n        <section class="share-settings">\n            <h3>Share settings:</h3>\n            <div class="invite-link-container">\n                <input type="text" ng-click="selectText($event)" readonly ng-model="shareURL" class="url-input dark-style">\n                <button clip-copy="shareURL" ng-click="onClickCopy($event);" class="copy-link icon-font-link only-icon-font btn-bordered small-size light-blue-style">Copy</button>\n                <span class="information" ng-class="{\'visible\': isCopied}">{{\'LS_LINK_HAS_BEEN_COPIED\' | translate}}</span>\n            </div>\n            <ul class="options-list">\n                <li ng-if="!params.isDocument">\n                  <form>\n                    <input id="share-settings-sitemap-and-comments" class="state-helper" type="checkbox" ng-model="params.includeSitemapComments" ng-change="onShareSettingsChanged()">\n                    <label for="share-settings-sitemap-and-comments" class="fake-choose-label fake-checkbox inside-cloud">Include sitemap and comments</label>\n                  </form>\n                </li>\n                <!--\n                <li class="fake-checkbox dark-style password-option">\n                    <input id="share-settings-password" type="checkbox">\n                    <label for="share-settings-password">Set password for guest...</label>\n                    <form action="" class="password-form">\n                        <input type="text" class="dark-style">\n                        <button class="link-style">Set</button>\n                        <a href="#" class="cancel">Cancel</a>\n                    </form>\n                </li>\n                -->\n            </ul>\n        </section>\n    </div>\n</li>\n'),$templateCache.put("/scripts/modules/core/views/settingsBar/settings.view.html",'<menu id="preview-menu"\n      class="item settings-menu"\n      ng-controller="SettingsBarPreviewCtrl"\n      ng-include="\'/scripts/modules/core/views/settingsBar/preview.view.html\'"\n      ng-if="!isLiveShareSession">\n</menu>\n\n<menu id="live-share-menu"\n      class="item settings-menu"\n      ng-controller="SettingsBarLiveShareController"\n      ng-include="\'/scripts/modules/core/views/settingsBar/liveShare.view.html\'"\n      ng-if="isLiveShareSession">\n</menu>\n'),$templateCache.put("/scripts/modules/core/views/usabilityTest/chromeExtensionDownload.view.html",'<section id="user-testing-plugin" class="modal-box-content" ng-if="isChrome">\n    <article>\n        <h2>UXPin Usability Testing (beta) extension for Chrome</h2>\n\n        <p>\n          If you want to create Usability Testing session, you need to install Chrome extension. <br>Please go to Chrome Web Store to install it.\n        </p>\n\n        <section class="plugin-false" ng-if="!isInstalled">\n            <a href="https://chrome.google.com/webstore/detail/uxpin-usability-testing-b/bgibmbhbcdfckbcbdkihlclfildbaehc"\n               class="btn-solid blue"\n               ng-click="verifyInstall()"\n               target="_blank">\n              Install extension from Chrome Web Store\n            </a>\n            <a href="{{helpPageURL}}" target="_blank" class="help">Need help with plugin installation?</a>\n        </section>\n\n        <section class="plugin-true" ng-if="isInstalled">\n            <div class="extension-installed">Extension installed!</div>\n            <button class="btn-solid" ng-click="onClickCreateSession($event)">Create usability test</button>\n        </section>\n    </article>\n</section>\n<section id="user-testing-plugin" class="modal-box-content not-avaible" ng-if="!isChrome">\n    <article>\n        <h2>You need Chrome!</h2>\n        <p>Currently UXPin Usability Testing Beta is supported only by Google Chrome browser. You can download Google Chrome browser <a href="https://www.google.com/intl/en/chrome/browser/" target="_blank">here</a>, and Usability Testing plugin <a href="https://chrome.google.com/webstore/detail/uxpin-usability-testing-b/bgibmbhbcdfckbcbdkihlclfildbaehc" target="_blank">here</a>.</p>\n        <p>Enjoy your test!</p>\n    </article>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/usabilityTest/introduction.view.html",'<section id="user-testing-wizard" class="modal-box-content wizard subject-welcome" ng-if="!isActiveStep(4)">\n    <article class="wizard-content">\n        <div class="steps">\n            <section class="step" ng-class="{\'active\': isActiveStep(1)}">\n                <h2>Welcome to <strong>{{params.projectName}}</strong> Usability Testing </h2>\n                <section class="agreement" ng-bind-html="params.introduction"></section>\n                <section class="wizard-pagination">\n                    <div class="agreement-checkbox">\n                        <input id="agreement" class="state-helper" type="checkbox" ng-model="params.agreement">\n                        <label for="agreement" class="fake-choose-label fake-checkbox">I grant permission to record this session</label>\n                    </div>\n                    <button ng-disabled="!params.agreement" ng-click="onClickNextStep(2)" class="btn-solid next">Next: <b>Tasks</b></button>\n                </section>\n            </section>\n\n            <section class="step" ng-class="{\'active\': isActiveStep(2)}">\n                <h2>Tasks list</h2>\n\n                <ul class="tasks-list" ng-controller="UsabilityTestTasksController">\n                    <li ng-repeat="task in params.tasks">\n                        <h3><span>Task {{$index + 1}}:</span>{{task.title}}</h3>\n                        <p>{{task.content}}</p>\n                    </li>\n                </ul>\n\n                <section class="wizard-pagination">\n                    <button ng-disabled="!params.agreement" ng-click="onClickNextStep(3)" class="btn-solid next">Next: <b>Set camera</b></button>\n                </section>\n            </section>\n\n            <section class="step camera-setup" ng-class="{\'active\': isActiveStep(3)}">\n                <h2>Set your face inside camera area</h2>\n                <section class="camera-access-info icon-font-mic-line-on" ng-class="{\'hidden\' : params.answerVideo}">\n                    <p>Google Chrome needs access to your <strong>microphone</strong> and <strong>camera</strong> <br>to record audio or to embed a camera feed.</p>\n                    <p>Please give access to start recording.</p>\n                </section>\n\n                <section class="camera-access-info icon-font-mic-line-on denied hidden" ng-class="{\'hidden\' : !params.blockVideo}">\n                    <p>You rejected giving media access. Recording usability test wouldn\'t be available.</p>\n\n                    <!-- <p><a href="#">Learn</a> how to enable media access.</p> -->\n                </section>\n\n                <capture-video ng-if="isActiveStep(3)" width="750" height="250"></capture-video>\n\n                <section class="wizard-pagination">\n                    Ready? <button ng-disabled="!params.answerVideo" ng-click="onClickStartSession()" class="btn-solid next">Start session!</button>\n                </section>\n            </section>\n        </div>\n    </article>\n</section>\n'),
$templateCache.put("/scripts/modules/core/views/usabilityTest/pluginConfirm.view.html",""),$templateCache.put("/scripts/modules/core/views/usabilityTest/wizard.view.html",'<section id="user-testing-wizard" class="modal-box-content wizard">\n    <article ng-if="!isActiveStep(4)">\n        <h2>Create usability test: {{params.projectName}}</h2>\n\n        <ul class="wizard-breadcrumbs">\n            <li ng-repeat="step in getStepsWithBreadcrumbs()" ng-class="{\'active\': isActiveStep($index), \'completed\': $index < params.activeStepIndex}">\n                <span class="step-count">{{$index+1}}</span>\n                <span class="step-label">{{step.label}}</span>\n            </li>\n        </ul>\n\n        <section class="wizard-content" id="wizard-content">\n            <div novalidation class="step step-1" ng-class="{\'active\': isActiveStep(0)}" ng-form="forms.step0">\n                <textarea required ng-model="params.steps[0].introduction"></textarea>\n            </div>\n\n            <section class="step step-2" ng-class="{\'active\': isActiveStep(1)}" ng-form="forms.step1">\n                <ul>\n                    <li class="task-container" ng-repeat="task in getStep(1).tasks" ng-class="{\'visible\': !task.deleting}">\n                        <header class="title">\n                            <label for="task-{{$index}}">Task {{$index + 1}}:</label>\n                            <input required type="text" id="task-{{$index}}" ng-model="task.title">\n                            <a ng-href="#" ng-click="onClickDeleteTask($event, $index)" class="icon-font-trash only-icon-font delete"><span class="tooltip small-style">Delete this task</span></a>\n                        </header>\n                        <textarea required ng-model="task.content"></textarea>\n                    </li>\n                    <li class="task-container visible">\n                        <header class="title">\n                            <label for="new-task-title">Task {{getStep(1).tasks.length + 1}}:</label>\n                            <input required autofocus type="text" id="new-task-title" ng-model="getStep(1).newTask.title" placeholder="Enter task name">\n                            <a ng-if="getStep(1).tasks.length || getStep(1).newTask.title || getStep(1).newTask.content" ng-href="#" ng-click="onClickDeleteTask($event)" class="icon-font-trash only-icon-font delete"><span class="tooltip small-style">Delete this task</span></a>\n                        </header>\n                        <textarea required ng-model="getStep(1).newTask.content" placeholder="Enter task description"></textarea>\n                    </li>\n                </ul>\n            </section>\n\n            <section class="step step-3" ng-class="{\'active\': isActiveStep(2)}" ng-form="forms.step2">\n                <section class="standard-list-container options-list-container">\n                    <ul>\n                        <li ng-repeat="option in getStep(2).options">\n                            <input id="option-{{$index}}" class="state-helper" type="checkbox" ng-model="option.value">\n                            <label for="option-{{$index}}" class="fake-choose-label fake-checkbox">{{option.name}}</label>\n                        </li>\n                        <li >\n                            <input id="breakpoint-enable-option" class="state-helper" type="checkbox" ng-model="getStep(2).breakpoints.enabled">\n                            <label for="breakpoint-enable-option" class="fake-choose-label fake-checkbox">{{getStep(2).breakpoints.name}}</label>\n                        </li>\n                    </ul>\n                    <ul class="breakpoints-list">\n                        <li ng-repeat="breakpoint in getStep(2).breakpoints.list" ng-class="{\'inactive\': !getStep(2).breakpoints.enabled}">\n                            <input id="breakpoint-option-{{$index}}" class="state-helper" ng-disabled="!getStep(2).breakpoints.enabled" type="checkbox" ng-model="breakpoint.value">\n                            <label for="breakpoint-option-{{$index}}" class="fake-choose-label fake-checkbox" ng-bind-html="breakpoint.name"></label>\n                        </li>\n                    </ul>\n                </section>\n            </section>\n\n            <div class="step step-4" ng-class="{\'active\': isActiveStep(3)}" ng-form="forms.step3">\n                <div class="invite-link-container no-button" ng-class="{\'working\': !getStep(3).inviteURL}">\n                    <input type="text" readonly id="invite-link" ng-click="onClickInput($event)" ng-model="getStep(3).inviteURL" class="url-input">\n                    <button clip-copy="getStep(3).inviteURL" ng-click="onClickCopy($event);" class="copy-link icon-font-link only-icon-font btn-bordered small-size light-gray-style">{{\'LS_COPY\' | translate}}</button>\n                    <span class="information" ng-class="{\'visible\': params.isCopied}">{{\'LS_LINK_HAS_BEEN_COPIED\' | translate}}</span>\n                </div>\n                <label for="invite-link">Invite by sending a link</label>\n            </div>\n        </section>\n\n        <section class="wizard-pagination">\n            <button class="btn-ghost blue prev"\n                    ng-if="params.activeStepIndex > 0"\n                    ng-click="onClickPrevStep()">\n                Back to: {{getStep(\'prev\').label}}\n            </button>\n\n            <button class="btn-solid blue next"\n                    ng-if="params.activeStepIndex < params.steps.length - 1"\n                    ng-disabled="getStepFormObject().$invalid"\n                    ng-click="onClickNextStep()">\n                <strong>Next:</strong> {{getStep(\'next\').label}}\n            </button>\n\n\t\t\t<button class="fake-link icon-font-plus add-task"\n\t\t\t   ng-if="params.activeStepIndex == 1"\n\t\t\t   ng-disabled="getStepFormObject().$invalid"\n\t\t\t   ng-click="onClickAddNewTask(params.steps[1].newTask)">\n                Add another task\n            </button>\n        </section>\n\n    </article>\n\n    <article class="final-step" ng-if="isActiveStep(4)">\n        <h2>Usability testing is ready to be launched!</h2>\n        <button ng-class="{\'waiting\': params.loading}"\n                class="btn-solid big btn-inline"\n                ng-click="onClickSessionStart()">Start session!</button>\n    </article>\n</section>\n'),$templateCache.put("/scripts/libs/uiBootstrapCustom/views/modal/window.view.html",'<section id="modalBoxWrapper" tabindex="-1" role="dialog" class="modal-box" ng-class="{\'visible\': animate}"> <!--ng-click="close($event)"-->\n    <section class="modal-box-wrapper">\n        <a href="#" class="close-modal-button icon-font-close only-icon-font" ng-click="close($event)">Close modal</a>\n        <div modal-transclude></div>\n    </section>\n</section>\n')}]),angular.module("core").controller("AppViewPromoController",["$rootScope","$scope","localStorageService","deviceDetectorHelper",function($rootScope,$scope,localStorageService,deviceDetectorHelper){"use strict";$scope.isAndroid="Android"===deviceDetectorHelper.getOS().name,localStorageService.set(PreviewEnums.APP_VIEW_PROMO_VIEWED,1),$scope.close=function(){$rootScope.$emit(PreviewEnums.ON_APP_VIEW_PROMO_CLOSE)}}]),angular.module("core").directive("appViewPromo",[function(){"use strict";return{restrict:"E",replace:!0,scope:!0,controller:"AppViewPromoController",templateUrl:"/scripts/modules/core/directives/appViewPromo/appViewPromo.directive.html"}}]),function(){"use strict";function pvAvatar(){return{restrict:"E",scope:{url:"=",name:"="},templateUrl:"/scripts/modules/core/directives/avatar/pvAvatar.html",controller:pvAvatarCtrl,controllerAs:"vm"}}function pvAvatarCtrl($scope){function activate(){$scope.$watch("url",function(newUrl){vm.url=newUrl}),$scope.$watch("name",function(newName){vm.initials=newName?getInitals(newName):""})}function getInitals(name){var nameParts=name.split(" ");return(nameParts[0][0]+(nameParts.length>1?nameParts[1][0]:"")).toUpperCase()}var vm=this;vm.url="",vm.initials="",activate()}angular.module("core").directive("pvAvatar",pvAvatar),pvAvatarCtrl.$inject=["$scope"]}(),function(){"use strict";function pvBreakpoints(){return{restrict:"E",replace:!0,scope:{breakpoints:"="},templateUrl:"/scripts/modules/core/directives/breakpoints/pvBreakpoints.html",controller:pvBreakpointsCtrl,controllerAs:"vm"}}function pvBreakpointsCtrl($rootScope,$scope,PagesService,UsabilityTestService){function activate(){$scope.$watch("breakpoints",function(newBreakpoints){vm.breakpoints=newBreakpoints}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.TESTER_JOINED,testerJoined.bind(this)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,hostStarted.bind(this))}function isActive(id){return id===PagesService.currentBreakpointId}function onClick(id){PagesService.changePageBreakpoint(id)}function isUnlocked(breakpointId){return lockedBreakpoints.indexOf(breakpointId)===-1}function testerJoined(){UsabilityTestService.isHostSession()||lockBreakpoints()}function hostStarted(){UsabilityTestService.isHostSession()&&lockBreakpoints()}function lockBreakpoints(){var availableBreakpoints=UsabilityTestService.getTestData().project.available_breakpoints;lockedBreakpoints=[],_.forEach(availableBreakpoints,function(breakpoint){breakpoint.value||lockedBreakpoints.push(breakpoint.id)})}var vm=this,lockedBreakpoints=[];vm.breakpoints=[],vm.isActive=isActive,vm.onClick=onClick,vm.isUnlocked=isUnlocked,activate()}angular.module("core").directive("pvBreakpoints",pvBreakpoints),pvBreakpointsCtrl.$inject=["$rootScope","$scope","PagesService","UsabilityTestService"]}(),function(){"use strict";function pvCommentForm(){function pvCommentFormCtrl(){function activate(){}activate()}return{restrict:"E",scope:{},templateUrl:"/scripts/modules/core/directives/comment/pvCommentForm.html",controller:pvCommentFormCtrl,controllerAs:"vm"}}angular.module("core").directive("pvCommentForm",pvCommentForm)}(),function(){"use strict";function pvEmailsParser(ValidationHelper){function link(scope,el,attrs,ngModelCtrl){function parser(value){var items=value.split(attrs.pvEmailsParser),emails=[];return _.each(items,function(item){var trimmedItem=item.trim();ValidationHelper.isEmail(trimmedItem)&&emails.push(trimmedItem)}),emails}function formatter(value){var emails=[];return _.isArray(value)?(_.each(value,function(item){var trimmedItem=item.trim();ValidationHelper.isEmail(trimmedItem)&&emails.push(trimmedItem)}),emails.join(",")):""}ngModelCtrl.$parsers.push(parser),ngModelCtrl.$formatters.push(formatter)}return{restrict:"A",require:"ngModel",link:link}}angular.module("core").directive("pvEmailsParser",pvEmailsParser),pvEmailsParser.$inject=["ValidationHelper"]}(),function(){"use strict";function pvEnter(){function link(scope,el,attrs){var ENTER_KEY_CODE=13;el.on("keydown keypress",function(event){event.which===ENTER_KEY_CODE&&(event.preventDefault(),scope.$apply(function(){scope.$eval(attrs.pvEnter)}))})}return{restrict:"A",link:link}}angular.module("core").directive("pvEnter",pvEnter)}(),function(){"use strict";function pvFocusMe($parse,$timeout){function link(scope,el,attrs){var model=$parse(attrs.pvFocusMe);scope.$watch(model,function(value){value&&$timeout(function(){el[0].focus()},0)}),el.on("blur",function(){scope.$apply(function(){model.assign(scope,!1)})})}return{restrict:"A",link:link}}angular.module("core").directive("pvFocusMe",pvFocusMe),pvFocusMe.$inject=["$parse","$timeout"]}(),function(){"use strict";function pvToggler(){function link(scope,el,attrs,controllers){function activate(){ngModelCtrl.$render=renderer,ngModelCtrl.$formatters.push(formatter),ngModelCtrl.$parsers.push(parser),el.on("click",handleClick)}function renderer(){var viewValue=ngModelCtrl.$viewValue;label.text(viewValue)}function formatter(value){return value?attrs.trueLabel:attrs.falseLabel}function parser(newValue){return newValue===attrs.trueLabel}function handleClick(event){event.preventDefault(),event.stopPropagation(),scope.$apply(function(){toggleViewValue()})}function toggleViewValue(){var newViewValue=ngModelCtrl.$viewValue===attrs.trueLabel?attrs.falseLabel:attrs.trueLabel;updateViewValue(newViewValue)}function updateViewValue(value){ngModelCtrl.$setViewValue(value),label.text(value)}var ngModelCtrl=controllers[0],label=el.find("a");activate()}return{restrict:"E",require:["ngModel","?ngChange"],scope:{title:"@",trueLabel:"@",falseLabel:"@"},link:link,templateUrl:"/scripts/modules/core/directives/controls/pvToggler.html"}}angular.module("core").directive("pvToggler",pvToggler)}(),angular.module("core").controller("MediaAccessTipController",["$rootScope","$scope",function($rootScope,$scope){"use strict";$scope.isTipVisible=!1,$scope.isDenied=!1;var showTip=function(){$scope.isTipVisible=!0},hideTip=function(){$scope.isTipVisible=!1},isTipOpen=function(){return $scope.isTipVisible};$scope.onClickClose=function(){hideTip()};var onMediaAccess=$rootScope.$on(PreviewEnums.MEDIA_ACCESS,function(e,value){switch(value){case PreviewEnums.MEDIA_ACCESS_TYPE.REQUEST:showTip();break;case PreviewEnums.MEDIA_ACCESS_TYPE.ALLOWED:hideTip();break;case PreviewEnums.MEDIA_ACCESS_TYPE.DENIED:$scope.$apply(function(){$scope.isDenied=!0}),isTipOpen()||showTip()}});$scope.$on("destroy",function(){onMediaAccess()})}]),angular.module("core").directive("mediaAccessTip",[function(){"use strict";return{restrict:"E",replace:!0,scope:!0,controller:"MediaAccessTipController",templateUrl:"/scripts/modules/core/directives/mediaAccessTip/mediaAccessTip.directive.html"}}]),function(){"use strict";function pvCollaboratorMention(UsersService){function link(scope,el,attrs,pvMentionCtrl){function label(option){return"@"+option.name}function highlight(option){return'<span class="mention">'+label(option)+"</span>"}function encode(option){return"["+option.name+"](mailto:"+option.email+")"}function decode(value){var splited=value.split("](");return{name:splited[0].replace("[",""),email:splited[1].replace(/(\)|mailto:)/gi,"")}}function filter(match,options){var lowerCaseMatch=match[1].toLowerCase();return _.filter(options,function(option){return _.contains(option.name.toLowerCase(),lowerCaseMatch)})}function onMentionsUpdate(mentions){scope.mentions=mentions}pvMentionCtrl.optionsCache=_.toArray(UsersService.collaboratorsMap),pvMentionCtrl.label=label,pvMentionCtrl.highlight=highlight,pvMentionCtrl.filter=filter,pvMentionCtrl.encode=encode,pvMentionCtrl.decode=decode,scope.mentions&&(pvMentionCtrl.onMentionsUpdate=onMentionsUpdate)}return{restrict:"A",require:"pvMention",scope:{mentions:"=?"},link:link}}angular.module("core").directive("pvCollaboratorMention",pvCollaboratorMention),pvCollaboratorMention.$inject=["UsersService"]}(),function(){"use strict";function pvMention(){function compile(el,attrs){var fakeTextarea='<div class="mention-area"></div>';return el.after(fakeTextarea),link}function link(scope,el,attrs,controllers){var ngModelCtrl=controllers[0],pvMentionCtrl=controllers[1];pvMentionCtrl.init(ngModelCtrl)}return{restrict:"A",require:["ngModel","pvMention"],compile:compile,link:link,controller:pvMentionCtrl,controllerAs:"$pvMention"}}function pvMentionCtrl($scope,$element,$attrs,$document,pvMentionsUtils){function init(model){ngModel=model,ngModel.$render=render,ngModel.$parsers.push(parser),ngModel.$formatters.push(formatter),$attrs.ngTrim="false",addListeners()}function addListeners(){$element.on("keyup input change",handleInputChange),$element.on("keydown",handleKeyDown),$element.on("focus",handleFocus),$element.on("scroll",updateScrollPosition)}function label(option){return""}function highlight(option){return""}function encode(option){return""}function decode(text){return{}}function filter(match,options){return[]}function onMentionsUpdate(mentions){}function labelRegExp(option){return new RegExp("\\B"+vm.label(option)+"\\b","gi")}function encodeRegExp(option){var escapedEncode=vm.encode(option).replace(/[|\\{}()[\]^$+*?.]/g,"\\$&");return new RegExp(escapedEncode,"gi")}function caret(){return'<span class="'+CARET_CLASS+'"></span>'}function render(){var viewValue=ngModel.$viewValue||"";renderRealTextarea(viewValue),renderFakeTextarea(viewValue)}function parser(value){return updateScrollPosition(),updateMentions(getParserMentions(value)),renderFakeTextarea(value),_.each(vm.mentions,function(mention){value=value.replace(vm.labelRegExp(mention),vm.encode(mention))}),value.trim()}function formatter(value){return updateMentions(getFormatterMentions(value)),value=(value||"").toString(),_.each(vm.mentions,function(mention){value=value.replace(vm.encodeRegExp(mention),vm.label(mention))}),value}function getParserMentions(value){return _.filter(vm.optionsCache,function(mention){return vm.labelRegExp(mention).test(value)})}function getFormatterMentions(value){var mentions=_.uniq(value.match(DECODE_PATTERN));return _.map(mentions,function(mention){return vm.decode(mention)})}function handleInputChange(){if($element[0].selectionStart===$element[0].selectionEnd){var text=$element.val(),match=PATTERN.exec(text.substr(0,$element[0].selectionStart));$scope.$apply(function(){match?(updateMenuPosition(),vm.search(match)):vm.cancel()})}}function handleKeyDown(event){if(updateScrollPosition(),vm.searching)switch(event.keyCode){case KEY_CODES.ENTER:enter(event);break;case KEY_CODES.ARROW_UP:arrowUp(event);break;case KEY_CODES.ARROW_DOWN:arrowDown(event)}}function handleFocus(){$document.on("mouseup",handleMouseUp)}function handleMouseUp(event){event.target!==$element[0]&&($document.off("mouseup",handleMouseUp),vm.searching&&$scope.$evalAsync(function(){cancel()}))}function updateScrollPosition(){$element.next()[0].scrollTop=$element[0].scrollTop}function search(match){vm.searching=match,vm.options=vm.filter(match,vm.optionsCache),vm.activeOption||(vm.activeOption=_.take(vm.options))}function select(option){addMention(option),ngModel.$setViewValue(replace(option)),ngModel.$render(),$element[0].focus(),vm.cancel()}function enter(event){event.preventDefault(),vm.activeOption&&vm.select(vm.activeOption)}function arrowUp(event){event.preventDefault();var index=vm.options.indexOf(vm.activeOption);vm.activeOption=index>0?vm.options[index-1]:vm.options[vm.options.length-1]}function arrowDown(event){event.preventDefault();var index=vm.options.indexOf(vm.activeOption);vm.activeOption=index<vm.options.length-1?vm.options[index+1]:vm.options[0]}function cancel(){vm.searching=!1,vm.activeOption=null}function replace(option){var search=vm.searching,text=ngModel.$viewValue;return text.substr(0,search.index+search[0].indexOf("@"))+vm.label(option)+" "+text.substr(search.index+search[0].length)}function addMention(mention){vm.mentions.push(mention),vm.onMentionsUpdate(vm.mentions)}function updateMentions(mentions){vm.mentions=mentions,vm.onMentionsUpdate(vm.mentions)}function renderRealTextarea(value){$element.val(value)}function renderFakeTextarea(text){var caretMatch=getCaretMatch(text);caretMatch&&(text=withCaret(caretMatch,text)),text=(text||"").toString(),_.each(vm.mentions,function(mention){text=text.replace(vm.labelRegExp(mention),vm.highlight(mention))}),$element.next().html(text+"<br />")}function getCaretMatch(text){return PATTERN.exec(text.substr(0,$element[0].selectionStart))}function withCaret(match,text){return text.substr(0,match.index+match[0].length)+caret()+text.substr(match.index+match[0].length)}function updateMenuPosition(){vm.menuPosition=getCaretPosition()}function getCaretPosition(){var caret=$element.next()[0].querySelector("."+CARET_CLASS);return{top:pvMentionsUtils.toPixels(caret.offsetTop-$element[0].scrollTop+MARGIN),left:pvMentionsUtils.toPixels(caret.offsetLeft+Math.round(caret.offsetWidth/2))}}var ngModel,PATTERN=/(?:\s+|^)@((\w|@|\.)+(?: \w+)?)$/,DECODE_PATTERN=/\[(.*?)\]\(mailto:(.*?)\)/gi,CARET_CLASS="caret",MARGIN=20,KEY_CODES={ENTER:13,ARROW_UP:38,ARROW_DOWN:40},vm=this;vm.optionsCache=[],vm.options=[],vm.mentions=[],vm.activeOption=null,vm.searching=!1,vm.menuPosition=null,vm.init=init,vm.label=label,vm.labelRegExp=labelRegExp,vm.encodeRegExp=encodeRegExp,vm.highlight=highlight,vm.filter=filter,vm.select=select,vm.encode=encode,vm.decode=decode,vm.search=search,vm.cancel=cancel,vm.onMentionsUpdate=onMentionsUpdate}angular.module("core").directive("pvMention",pvMention),pvMentionCtrl.$inject=["$scope","$element","$attrs","$document","pvMentionsUtils"]}(),function(){"use strict";function pvMentionsUtils(){function toPixels(value){return value+"px"}return{toPixels:toPixels}}angular.module("core").factory("pvMentionsUtils",pvMentionsUtils)}(),function(){"use strict";function pvNotify($document){function link(scope,el,attrs,controllers){function activate(){ngModelCtrl&&(ngModelCtrl.$render=renderer),scope.$on("$destroy",onDestroy)}function renderer(){vm.selected=ngModelCtrl.$viewValue||[],vm.updateFilters()}function toggle(){return vm.isOpen?void closeDropdown():void openDropdown()}function openDropdown(){vm.isOpen||(vm.isOpen=!0,bindEvents(),_.isFunction(scope.onOpen)&&scope.onOpen())}function closeDropdown(){vm.isOpen&&(vm.isOpen=!1,unbindEvents(),_.isFunction(scope.onClose)&&scope.onClose())}function bindEvents(){$document[0].addEventListener("click",onClick,!0),$document.on("keydown",onKeyDown)}function unbindEvents(){$document[0].removeEventListener("click",onClick,!0),$document.off("keydown",onKeyDown)}function selectProjectMembers(){vm.selected=vm.getProjectMembersEmails(),vm.selectFilter("projectMembers"),ngModelCtrl.$setViewValue(vm.selected)}function selectAll(){vm.selected=vm.getAllEmails(),vm.selectFilter("all"),ngModelCtrl.$setViewValue(vm.selected)}function selectNone(){vm.selected=[],vm.selectFilter("none"),ngModelCtrl.$setViewValue(vm.selected)}function onClick(event){el[0].contains(event.target)||scope.$apply(function(){closeDropdown()})}function onKeyDown(event){event.which===KEY_CODES.ESC&&scope.$apply(function(){closeDropdown()})}function onTextareaEnter(){vm.customEmails&&(scope.people=vm.people.concat(vm.getCustomPeople()),vm.customEmails=[],vm.scrollToBottom=!0)}function onDestroy(){unbindEvents()}var KEY_CODES={ESC:27,ENTER:13},vm=scope.vm,ngModelCtrl=controllers[0];vm.selected=[],vm.isOpen=!1,vm.toggle=toggle,vm.closeDropdown=closeDropdown,vm.selectProjectMembers=selectProjectMembers,vm.selectAll=selectAll,vm.selectNone=selectNone,vm.onTextareaEnter=onTextareaEnter,activate()}return{restrict:"E",require:["?ngModel","?ngChange"],scope:{people:"=",onOpen:"&?",onClose:"&?"},templateUrl:"/scripts/modules/core/directives/notify/pvNotify.html",link:link,controller:pvNotifyCtrl,controllerAs:"vm"}}function pvNotifyCtrl($scope){function activate(){$scope.$watch("people",function(newPeople){vm.people=newPeople,vm.projectMembersEmails=getProjectMembersEmails(),vm.updateFilters()})}function isEmailOnList(email){return!!_.find(vm.people,function(person){return person.email===email})}function isAllSelected(){return _.every([vm.people.length>0,vm.people.length===vm.selected.length,vm.people.length!==vm.projectMembersEmails.length])}function isProjectMembersSelected(){var diff=_.difference(vm.projectMembersEmails,vm.selected);return _.every([_.isEmpty(diff),vm.projectMembersEmails.length===vm.selected.length])}function isNoneSelected(){return _.isEmpty(vm.selected)}function getAllEmails(){return _.map(vm.people,function(person){return person.email})}function getProjectMembersEmails(){var emails=[];return _.each(vm.people,function(person){person.isOwner&&emails.push(person.email)}),emails}function getNewPerson(email){return{name:email,email:email,id:MD5(email)}}function getCustomPeople(){var customPeople=[];return _.each(vm.customEmails,function(email){isEmailOnList(email)||customPeople.push(getNewPerson(email))}),customPeople}function selectFilter(name){deselectFilters(),vm.filters[name]=!0}function deselectFilters(){_.each(vm.filters,function(value,key){vm.filters[key]=!1})}function updateFilters(){vm.filters.all=isAllSelected(),vm.filters.projectMembers=isProjectMembersSelected(),vm.filters.none=isNoneSelected()}var vm=this;vm.people=[],vm.projectMembersEmails=[],vm.customEmails=[],vm.scrollToBottom=!1,vm.filters={projectMembers:!1,all:!1,none:!1},vm.isEmailOnList=isEmailOnList,vm.isAllSelected=isAllSelected,vm.isProjectMembersSelected=isProjectMembersSelected,vm.isNoneSelected=isNoneSelected,vm.selectFilter=selectFilter,vm.deselectFilters=deselectFilters,vm.getAllEmails=getAllEmails,vm.getProjectMembersEmails=getProjectMembersEmails,vm.getNewPerson=getNewPerson,vm.getCustomPeople=getCustomPeople,vm.updateFilters=updateFilters,activate()}angular.module("core").directive("pvNotify",pvNotify),pvNotify.$inject=["$document"],pvNotifyCtrl.$inject=["$scope"]}(),function(){"use strict";function PreviewCommentCanvasCtrl($rootScope,$scope,$controller){if($controller("PreviewCommentAbstractCtrl",{$scope:$scope}),$scope.type="canvas",$scope.onResolved=function(value){value&&$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null)},$scope.isNew()){$scope.$on("$destroy",function(){onAddingComment()});var onAddingComment=$rootScope.$on(PreviewEnums.ADDING_COMMENT,function(e,value){$scope.focusMe(value,100)});$scope.parentId||$scope.focusMe(!0,300)}}angular.module("core").controller("PreviewCommentCanvasCtrl",PreviewCommentCanvasCtrl),PreviewCommentCanvasCtrl.$inject=["$rootScope","$scope","$controller"]}(),function(){"use strict";function previewCommentCanvas(){return{restrict:"E",replace:!0,scope:{groupId:"=",comment:"=",commentType:"=",parentId:"@",reply:"@",replyForm:"@",x:"@",y:"@"},controller:"PreviewCommentCanvasCtrl",templateUrl:"/scripts/modules/core/directives/preview-comment/pvComment.html"}}angular.module("core").directive("previewCommentCanvas",previewCommentCanvas)}(),function(){"use strict";function PreviewCommentPanelCtrl($rootScope,$scope,$controller,CommentsService){if($controller("PreviewCommentAbstractCtrl",{$scope:$scope}),$scope.type="panel",$scope.searchFor=CommentsService.searchFor,$scope.onResolved=function(value){},!$scope.isNew()){$scope.$on("$destroy",function(){onSearchComments()});var onSearchComments=$rootScope.$on("searchComments",function(e){$scope.searchFor=CommentsService.searchFor})}}angular.module("core").controller("PreviewCommentPanelCtrl",PreviewCommentPanelCtrl),PreviewCommentPanelCtrl.$inject=["$rootScope","$scope","$controller","CommentsService"]}(),function(){"use strict";function previewCommentPanel(){return{restrict:"E",replace:!0,scope:{groupId:"=",comment:"=",commentType:"=",parentId:"@",reply:"@",replyForm:"@",x:"@",y:"@"},controller:"PreviewCommentPanelCtrl",templateUrl:"/scripts/modules/core/directives/preview-comment/pvComment.html"}}angular.module("core").directive("previewCommentPanel",previewCommentPanel)}(),function(){"use strict";function PreviewCommentAbstractCtrl($rootScope,$scope,$state,$timeout,$filter,ProjectsService,PagesService,DocumentsService,CommentsService,CommentsSettings,UsersService,NotificationsService,NotificationsHelper,CommentsHelper,CommentsState){function activate(){switch($scope.commentMode=getInitialCommentMode(),$scope.state=CommentsState,$scope.parentId&&($scope.parentComment=CommentsService.commentsMap[$scope.parentId]),$scope.commentMode){case COMMENT_MODE.NEW:activateNewMode();break;case COMMENT_MODE.PREVIEW:activatePreviewMode()}}function activateNewMode(){$scope.avatarUrl=UsersService.me.avatar,$scope.userName=UsersService.me.name,$scope.inputPlaceholder=getInputPlaceholder(),$scope.newCommentClick=newCommentClick,$scope.onNotifyOpen=onNotifyOpen,$scope.onNotifyClose=onNotifyClose,addNewModeEvents(),getCurrentNotifications(),updateNotifications(),focusMe(!$scope.replyForm,100)}function activatePreviewMode(){$scope.avatarUrl=$scope.comment.user.avatar,$scope.userName=$scope.comment.user.name,$scope.commentCreatedAt=moment($scope.comment.created_at).fromNow(),$scope.canEdit=CommentsService.canEdit($scope.comment),$scope.canEditContent=CommentsService.canEditContent($scope.comment),addPreviewModeEvents(),CommentsService.getComment($scope.comment._id).then(function(comment){$scope.update(comment)})}function addNewModeEvents(){var onChangeNotifications=$rootScope.$on(PreviewEnums.ON_CHANGE_NOTIFICATIONS,function(event,commentId){commentId&&$scope.parentId===commentId&&getCurrentNotifications()}),onNotificationsUpdate=$rootScope.$on(PreviewEnums.ON_NOTIFICATIONS_UPDATE,function(event,commentId){$scope.replyForm&&$scope.parentId===commentId&&updateNotifications()}),onSetAnonymousName=$rootScope.$on(PreviewEnums.SET_ANONYMOUS_NAME,function(event,name){$scope.inputDisabled=!1,name&&$scope.focusMe(!0,1)});$scope.$on("$destroy",function(){$scope.parentId&&saveNotificationsChanges(),onChangeNotifications(),onNotificationsUpdate(),onSetAnonymousName()})}function addPreviewModeEvents(){var onReplyingComment=$rootScope.$on(PreviewEnums.REPLYING_COMMENT,function(e,id,type,isReplying){$scope.comment._id!==id&&$scope.comment._parent_comment!==id||$scope.type!==type||($scope.isReplying=isReplying)}),onCommentContentUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_CONTENT_UPDATE,function(e,id,content){$scope.comment._id===id&&($scope.comment.comment=content,update($scope.comment))});$scope.$on("$destroy",function(){$scope.commentMode===COMMENT_MODE.EDIT&&exitEditMode(),onReplyingComment(),onCommentContentUpdate()})}function getInitialCommentMode(){return $scope.isNew()?COMMENT_MODE.NEW:COMMENT_MODE.PREVIEW}function getInputPlaceholder(){return $scope.replyForm?INPUT_PLACEHOLDERS.REPLY:INPUT_PLACEHOLDERS.FIRST}function isNew(){return void 0===$scope.comment}function isPreviewMode(){return $scope.commentMode===COMMENT_MODE.PREVIEW}function isEditMode(){return $scope.commentMode===COMMENT_MODE.EDIT}function isFormHidden(){return $scope.state.groupInEditModeId===$scope.groupId}function isEditDisabled(){return null!==$scope.state.groupInEditModeId}function isLoved(){return!$scope.isNew()&&CommentsService.isLoved($scope.comment)}function focusMe(value,delay){value&&($scope.isError=!1),delay>0?$timeout(function(){$scope.focused=value},delay):$scope.focused=value}function loveMe(event){event.stopPropagation(),CommentsService.updateComment($scope.comment._id,{is_loved:!$scope.isLoved()})}function replyMe(event){event.stopPropagation();var id=$scope.comment._parent_comment||$scope.comment._id;$rootScope.$emit(PreviewEnums.REPLYING_COMMENT,id,$scope.type,!$scope.isReplying)}function resolveMe(value){CommentsService.updateCommentResolve($scope.parentComment._id,value)}function editMe(event){event.stopPropagation(),isEditDisabled()||($scope.commentMode=COMMENT_MODE.EDIT,$scope.state.groupInEditModeId=$scope.groupId,$scope.form.text=$scope.comment.comment,focusMe(!0))}function cancelEdit(event){event.stopPropagation(),exitEditMode()}function exitEditMode(){$scope.commentMode=COMMENT_MODE.PREVIEW,$scope.state.groupInEditModeId=null,$scope.resetFormData()}function deleteMe(event){event&&event.stopPropagation(),CommentsService.canEdit($scope.comment)&&($state.includes("**.panel.**")&&!$scope.comment._parent_comment?$rootScope.$emit(PreviewEnums.DELETING_COMMENT,$scope.comment._id,!0):CommentsService.deleteComment($scope.comment._id))}function submitMe(event){event.stopPropagation(),$scope.working||(isNew()?addNewComment():updateCommentContent())}function addNewComment(){if(validate()){UsersService.isAnonymous()||CommentsSettings.setLastUsedCommentType($scope.commentType);var mentions=getMentionsEmails();$scope.working=!0,CommentsService.addComment(getCommentProperties()).then(function(comment){$scope.resetFormData(),$scope.parentId&&!_.isEmpty(mentions)&&emitNotificationsUpdate(),comment._parent_comment||(CommentsService.selectedCommentId=comment._id)})["finally"](function(){$scope.working=!1})}}function updateCommentContent(){if(validate()){var mentions=getMentionsEmails();$scope.working=!0,CommentsService.updateCommentContent($scope.comment._id,$scope.form.text,mentions).then(function(){_.isEmpty(mentions)||emitNotificationsUpdate(),exitEditMode()})["finally"](function(){
$scope.working=!1})}}function getMentionsEmails(){return _.map($scope.form.mentions,function(mention){return mention.email})}function emitNotificationsUpdate(){var commentId=$scope.parentId||$scope.comment._parent_comment||$scope.comment._id;$rootScope.$emit(PreviewEnums.ON_NOTIFICATIONS_UPDATE,commentId)}function update(comment){var text;text=CommentsHelper.encodeMentions(comment.comment),text=$filter("linky")(text,"_blank"),text=CommentsHelper.decodeMentions(text),text=$filter("simpleMarkdown")(text),$scope.previewText=text}function resetFormData(){$scope.form.text="",$scope.form.mentions=[]}function getGroupLength(){return CommentsService.commentsTree[$scope.comment._id].length}function newCommentClick(event){event.stopPropagation()}function onTextareaKeyDown(event){event.stopPropagation(),event.which===KEY_CODES.ENTER&&(event.shiftKey||event.altKey||event.metaKey||event.ctrlKey||(event.preventDefault(),submitMe(event)),(event.altKey||event.metaKey||event.ctrlKey)&&event.preventDefault())}function onTextareaMouseDown(event){event.stopPropagation(),$scope.isError=!1,UsersService.isAnonymous()&&!UsersService.isAnonymousNameSet()&&($scope.inputDisabled=!0,$scope.focusMe(!1,1),$rootScope.$emit(PreviewEnums.ANONYMOUS_ADD_COMMENT))}function onNotifyOpen(){CommentsService.selectedCommentShowNotificationPanel=!0}function onNotifyClose(){CommentsService.selectedCommentShowNotificationPanel=!1,$scope.parentId&&($scope.focusMe(!0,1),saveNotificationsChanges())}function saveNotificationsChanges(){var addedEmails=_.difference($scope.notify.selected,$scope.notify.initialSelected),removedEmails=_.difference($scope.notify.initialSelected,$scope.notify.selected);_.isEmpty(addedEmails)||(NotificationsService.addToNotifications(addedEmails,$scope.parentId),NotificationsHelper.rememberSelection($scope.notify.selected)),_.isEmpty(removedEmails)||(NotificationsService.removeFromNotificationList(removedEmails,$scope.parentId),NotificationsHelper.rememberSelection($scope.notify.selected))}function getCommentProperties(){var properties={project_hash:ProjectsService.currentProjectHash,comment:$scope.form.text,position:{x:$scope.x,y:$scope.y},type:$scope.commentType,collaborators_all:UsersService.collaboratorEmails.length,notify:NotificationsHelper.formatNotify($scope.notify.selected,$scope.form.mentions)};return ProjectsService.isDocument()?$scope.parentId?(properties.id_document=CommentsService.commentsMap[$scope.parentId].id_document,properties._parent_comment=$scope.parentId):properties.id_document=DocumentsService.currentDocumentId:$scope.parentId?(properties.id_page=CommentsService.commentsMap[$scope.parentId].id_page,properties._parent_comment=$scope.parentId):properties.id_page=PagesService.currentPageId,UsersService.isAnonymous()&&(properties.user={name:UsersService.me.name}),properties}function validate(){return $scope.isError=!$scope.form.text,!$scope.isError}function updateNotifications(){NotificationsService.getNotifications().then(getCurrentNotifications)}function getCurrentNotifications(){$scope.notify.people=NotificationsHelper.getNotificationsForComment($scope.parentId,UsersService.collaboratorsMap,UsersService.collaboratorEmails,NotificationsService.notificationsMap),$scope.notify.initialSelected=NotificationsHelper.getSelectedEmails($scope.parentId,UsersService.collaboratorsMap,NotificationsService.notificationsMap),$scope.notify.selected=_.clone($scope.notify.initialSelected)}var INPUT_PLACEHOLDERS={FIRST:"What’s your comment?",REPLY:"What’s your response?"},COMMENT_MODE={NEW:"new",PREVIEW:"preview",EDIT:"edit"},KEY_CODES={ENTER:13};$scope.id="comment-"+MD5((new Date).getTime()),$scope.commentMode=null,$scope.state={},$scope.working=!1,$scope.focused=!1,$scope.isReplying=!1,$scope.isError=!1,$scope.inputDisabled=!1,$scope.inputPlaceholder="",$scope.avatarUrl=null,$scope.avatarInitials=null,$scope.notificationPanel=!1,$scope.textElements={},$scope.parentComment=null,$scope.previewText="",$scope.form={text:"",mentions:[]},$scope.notify={initialSelected:[],selected:[],people:[]},$scope.isNew=isNew,$scope.isEditMode=isEditMode,$scope.isEditDisabled=isEditDisabled,$scope.isPreviewMode=isPreviewMode,$scope.isLoved=isLoved,$scope.isFormHidden=isFormHidden,$scope.focusMe=focusMe,$scope.loveMe=loveMe,$scope.replyMe=replyMe,$scope.resolveMe=resolveMe,$scope.editMe=editMe,$scope.cancelEdit=cancelEdit,$scope.deleteMe=deleteMe,$scope.submitMe=submitMe,$scope.update=update,$scope.resetFormData=resetFormData,$scope.getGroupLength=getGroupLength,$scope.onTextareaMouseDown=onTextareaMouseDown,$scope.onTextareaKeyDown=onTextareaKeyDown,activate()}angular.module("core").controller("PreviewCommentAbstractCtrl",PreviewCommentAbstractCtrl),PreviewCommentAbstractCtrl.$inject=["$rootScope","$scope","$state","$timeout","$filter","ProjectsService","PagesService","DocumentsService","CommentsService","CommentsSettings","UsersService","NotificationsService","NotificationsHelper","CommentsHelper","CommentsState"]}(),function(){"use strict";function PreviewCommentContainerCtrl($rootScope,$scope,$timeout,CommentsService,CommentsSettings,UsersService,AnalyticsService){function activate(){$scope.commentTypesActive=CommentsSettings.commentTypesActive(),$scope.selected=!isNew()&&CommentsService.selectedCommentId===$scope.comment._id,$scope.commentType.options=CommentsSettings.getCommentTypeOptions(),$scope.commentType.selected=isNew()?$scope.initialCommentType:$scope.comment.type,$scope.children=getCommentChildren(),isNew()||(updateClasses(),addOldCommentModeEvents(),isPanel()&&($scope.toggle=toggle,addPanelModeEvents()))}function updateCommentChildren(){$scope.children=getCommentChildren()}function getCommentChildren(){if(!$scope.comment)return[];var childrenIds=CommentsService.commentsTree[$scope.comment._id];return _.map(childrenIds,function(childId){return CommentsService.commentsMap[childId]})}function isNew(){return void 0===$scope.comment}function isPanel(){return"panel"===$scope.type}function isCanvas(){return"canvas"===$scope.type}function isOpen(){return $scope.selected}function handleCommentTypeChange(){$scope.isNew()?$rootScope.$emit(PreviewEnums.ON_COMMENT_TYPE_UPDATE,null,$scope.commentType.selected):CommentsService.updateCommentType($scope.comment._id,$scope.commentType.selected)}function toggle(){var selectedComment=$scope.selected?null:$scope.comment._id;$rootScope.$emit(PreviewEnums.SELECT_COMMENT,selectedComment,$scope.type)}function hide(){$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null)}function addOldCommentModeEvents(){var unbindReplyingCommentEvent=$rootScope.$on(PreviewEnums.REPLYING_COMMENT,function(event,id,type,isReplying){$scope.comment._id===id&&type===$scope.type&&($scope.selected=isReplying,updateClasses())}),unbindAddCommentEvent=$rootScope.$on(PreviewEnums.ADD_COMMENT,function(event,id,parentId){$scope.comment._id===parentId&&(updateClasses(),updateCommentChildren())}),unbindDeleteCommentEvent=$rootScope.$on(PreviewEnums.DELETE_COMMENT,function(event,id){isChildren(id)&&updateCommentChildren()}),unbindSelectCommentEvent=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(event,id){$scope.selected&&$scope.comment._id!==id&&($scope.selected=!1,updateClasses()),$scope.selected||$scope.comment._id!==id||($scope.selected=!0,updateClasses())}),unbindCommentTypeUpdateEvent=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,updateCommentType);$scope.$on("$destroy",function(){unbindSelectCommentEvent(),unbindAddCommentEvent(),unbindDeleteCommentEvent(),unbindReplyingCommentEvent(),unbindCommentTypeUpdateEvent()})}function addPanelModeEvents(){var unbindDeletingCommentEvent=$rootScope.$on(PreviewEnums.DELETING_COMMENT,function(e,id,value){$scope.comment._id===id&&value&&($scope.onClickUndo=onClickUndo,$scope.deleting=!0,$scope.selected=!1,updateClasses(),deletingTimeout=$timeout(function(){$scope.onClickUndo=null,$scope.deleting=!1,$scope.deleted=!0,updateClasses(),$timeout(function(){CommentsService.deleteComment($scope.comment._id)},0)},PreviewEnums.UNDO_TIMEOUT))}),unbindDeleteCommentEvent=$rootScope.$on(PreviewEnums.DELETE_COMMENT,function(event,id){isChildren(id)&&updateCommentChildren()}),unbindKeyDownEvent=$rootScope.$on("keyDown",function(event,keyEvent){if($scope.selected&&8===keyEvent.which){if($scope.comment.user.id!==UsersService.me.id_user)return;$rootScope.$emit(PreviewEnums.DELETING_COMMENT,$scope.comment._id,!0)}}),unbindResolveCommentEvent=$rootScope.$on(PreviewEnums.RESOLVE_COMMENT,function(event,id,value){$scope.comment._id===id&&handleResolveComment(value)}),unbindCommentTypeUpdateEvent=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,updateCommentType);$scope.$on("$destroy",function(){unbindResolveCommentEvent(),unbindDeletingCommentEvent(),unbindDeleteCommentEvent(),unbindKeyDownEvent(),unbindCommentTypeUpdateEvent()})}function isChildren(id){return!!_.find($scope.children,function(child){return child._id===id})}function updateCommentType(event,id,type){$scope.comment._id===id&&($scope.commentType.selected=type)}function updateClasses(){$scope.isNew()||(setClass("selected",$scope.selected),setClass("resolved",$scope.comment.resolved.is),setClass("active",$scope.comment.resolved.is&&$scope.justResolved),setClass("archived",$scope.comment.resolved.is&&!$scope.justResolved),setClass("delete",$scope.deleting||$scope.deleted),setClass("hide",$scope.deleted))}function setClass(className,value){var index=$scope.classes.indexOf(className);value&&index===-1?$scope.classes.push(className):value||index===-1||$scope.classes.splice(index,1)}function handleResolveComment(value){value?($scope.justResolved=!0,updateClasses(),$timeout(function(){$scope.justResolved=!1,updateClasses()},PreviewEnums.SHOW_RESOLVED_TIMEOUT)):updateClasses()}function onClickUndo(event){event.stopPropagation(),deletingTimeout&&($timeout.cancel(deletingTimeout),deletingTimeout=null,$scope.onClickUndo=null,$scope.deleting=!1,updateClasses(),$rootScope.$emit(PreviewEnums.DELETING_COMMENT,$scope.comment._id,!1),AnalyticsService.event(PreviewEnums.KM_EVENTS.DELETE_UNDONE))}var deletingTimeout=null;$scope.selected=!1,$scope.justResolved=!1,$scope.deleting=!1,$scope.deleted=!1,$scope.classes=[],$scope.children=[],$scope.commentType={options:[],selected:null},$scope.isNew=isNew,$scope.isPanel=isPanel,$scope.isCanvas=isCanvas,$scope.isOpen=isOpen,$scope.hide=hide,$scope.toggle=_.noop,$scope.handleCommentTypeChange=handleCommentTypeChange,$scope.commentTypesActive=!1,activate()}angular.module("core").controller("PreviewCommentContainerCtrl",PreviewCommentContainerCtrl),PreviewCommentContainerCtrl.$inject=["$rootScope","$scope","$timeout","CommentsService","CommentsSettings","UsersService","AnalyticsService"]}(),function(){"use strict";function previewCommentContainer(){return{restrict:"E",replace:!0,scope:{comment:"=",initialCommentType:"=commentType",type:"@",x:"@",y:"@"},controller:"PreviewCommentContainerCtrl",templateUrl:"/scripts/modules/core/directives/preview-comment-container/preview-comment-container.directive.html"}}angular.module("core").directive("previewCommentContainer",previewCommentContainer)}(),function(){"use strict";function PreviewCommentGroupCtrl($rootScope,$scope,CommentsService){function activate(){$scope.groupId=getGroupId(),$scope.searchFor=CommentsService.searchFor,$scope.filteredChildren=getFilteredChildren(),$scope.isNew()||addListeners()}function addListeners(){var onCommentChildrenChange=$scope.$watch("commentChildren",function(newChildren,oldChildren){!$scope.toggler.isVisible&&newChildren.length>oldChildren.length&&($scope.toggler.isOpen=!0),updateChildren()}),onSearchComments=$rootScope.$on("searchComments",function(){$scope.searchFor=CommentsService.searchFor,updateChildren()});$scope.$on("$destroy",function(){onCommentChildrenChange(),onSearchComments()})}function isNew(){return void 0===$scope.comment}function isGroup(){return $scope.comment&&CommentsService.isGroup($scope.comment._id)}function isPanel(){return"panel"===$scope.type}function isCanvas(){return"canvas"===$scope.type}function hasSearchFor(text){return""===$scope.searchFor||text.toLocaleLowerCase().indexOf($scope.searchFor)!==-1}function getCheckboxId(){return $scope.comment._id+"-"+$scope.type}function getGroupId(){var id=$scope.comment?$scope.comment._id:"new-comment";return $scope.type+"-"+id}function onTogglerClick(event){event.stopPropagation(),$scope.toggler.isOpen=!$scope.toggler.isOpen,$scope.childrenToDisplay=getChildrenToDisplay()}function updateChildren(){$scope.filteredChildren=getFilteredChildren(),$scope.toggler.isVisible=$scope.filteredChildren.length>MAX_CHILDREN,$scope.toggler.commentsCount=$scope.toggler.isVisible?$scope.filteredChildren.length-1:0,$scope.childrenToDisplay=getChildrenToDisplay()}function commentCountInfo(){return"Show "+$scope.toggler.commentsCount+" more"}function getFilteredChildren(){return $scope.searchFor?_.filter($scope.commentChildren,function(child){return hasSearchFor(child.comment)}):$scope.commentChildren}function getChildrenToDisplay(){if(!$scope.toggler.isVisible||$scope.toggler.isOpen)return $scope.filteredChildren;var comments=[];return comments.push(_.last($scope.filteredChildren)),comments}var MAX_CHILDREN=3;$scope.groupId=null,$scope.childrenToDisplay=[],$scope.filteredChildren=[],$scope.searchFor="",$scope.toggler={isVisible:!1,isOpen:!1,commentsCount:0},$scope.isNew=isNew,$scope.isGroup=isGroup,$scope.isPanel=isPanel,$scope.isCanvas=isCanvas,$scope.hasSearchFor=hasSearchFor,$scope.getCheckboxId=getCheckboxId,$scope.onTogglerClick=onTogglerClick,$scope.commentCountInfo=commentCountInfo,activate()}angular.module("core").controller("PreviewCommentGroupCtrl",PreviewCommentGroupCtrl),PreviewCommentGroupCtrl.$inject=["$rootScope","$scope","CommentsService"]}(),function(){"use strict";function previewCommentGroup(){return{restrict:"E",replace:!0,scope:{comment:"=",commentType:"=",commentChildren:"=",reply:"=",type:"@",x:"@",y:"@"},controller:"PreviewCommentGroupCtrl",templateUrl:"/scripts/modules/core/directives/preview-comment-group/preview-comment-group.directive.html"}}angular.module("core").directive("previewCommentGroup",previewCommentGroup)}(),function(){"use strict";function PreviewPinCtrl($rootScope,$scope,$document,$timeout,CommentsService,CommentsSettings,UsersService,PagesService,DocumentsService,ProjectsService,DOMService){function activate(){commentTypes=CommentsSettings.commentTypes,$scope.selected=$scope.selectedDelayed=$scope.comment&&CommentsService.selectedCommentId===$scope.comment._id,$scope.commentType=getInitialCommentType()}function isOpen(){return $scope.selected}function isNew(){return void 0===$scope.comment}function isTeam(){return $scope.isNew()?$scope.commentType===commentTypes.TEAM:$scope.comment.type===commentTypes.TEAM}function isAnonymousMode(){return UsersService.isAnonymous()}function open(){$scope.selected=!0,$scope.applyVisibility()}function toggle(){$scope.isNew()||$scope.isDragging||($scope.selected=!$scope.selected,$scope.applyVisibility())}function hide(){if($scope.selected)return $scope.selected=!1,$scope.applyVisibility(),!0}function initDrag(){maxWidth=getContentWidth()-PreviewEnums.PIN_RADIUS,maxHeight=getContentHeight(),$scope.isDragging=!0,updateClasses(),$document.on("mouseup",onMouseUp),$rootScope.$emit(PreviewEnums.DRAGGING_COMMENT,!0)}function startDrag(event){CommentsService.canEdit($scope.comment)&&($scope.dragClickPos={x:event.pageX,y:event.pageY},$scope.dragStartPos={x:$scope.comment.position.x,y:$scope.comment.position.y},$scope.dragClickPos&&$scope.dragStartPos&&$document.on("mousemove",onMouseMove))}function endDrag(){$document.unbind("mousemove",onMouseMove)}function onDblclick(event){event.preventDefault()}function onMouseMove(event){var x=$scope.dragStartPos.x+event.pageX-$scope.dragClickPos.x,y=$scope.dragStartPos.y+event.pageY-$scope.dragClickPos.y;$scope.isDragging||initDrag(),x<-PreviewEnums.PIN_RADIUS&&(x=-PreviewEnums.PIN_RADIUS),x>maxWidth&&(x=maxWidth),y>maxHeight&&(y=maxHeight),$scope.$apply(function(){$scope.comment.position.x=x,$scope.comment.position.y=y})}function onMouseUp(){$scope.dragClickPos=null,$document.unbind("mousemove",onMouseMove),$document.unbind("mouseup",onMouseUp),$timeout(function(){$scope.isDragging=!1,updateClasses()},0),computePosition(),CommentsService.updateComment($scope.comment._id,{position:$scope.comment.position}).then(function(comment){$scope.dragStartPos=null},function(error){$scope.comment.position.x=$scope.dragStartPos.x,$scope.comment.position.y=$scope.dragStartPos.y,$scope.dragStartPos=null}),$rootScope.$emit(PreviewEnums.DRAGGING_COMMENT,!1)}function getCommentPointStyle(){return{left:$scope.x+"px",top:$scope.y+"px"}}function getContentId(){return ProjectsService.isDocument()?DocumentsService.currentDocumentId:PagesService.currentPageId}function getContentWidth(){return ProjectsService.isDocument()?parseInt(DocumentsService.currentDocumentProperties.size.width):PagesService.getContentWidth()}function getContentHeight(){return ProjectsService.isDocument()?parseInt(DocumentsService.currentDocumentProperties.size.height):parseInt(PagesService.currentPageProperties.size.height)}function getInitialCommentType(){return $scope.comment?$scope.comment.type?$scope.comment.type:commentTypes.PUBLIC:CommentsSettings.commentTypesActive()?CommentsSettings.getLastUsedCommentType()||commentTypes.TEAM:commentTypes.PUBLIC}function getPreventHideElements(){var elements=[],loginToolbarEl=document.querySelector("section.login-toolbar");return loginToolbarEl&&elements.push(loginToolbarEl),elements}function applyVisibility(){updateClasses(),setSelectedDelayed($scope.selected),$rootScope.$emit(PreviewEnums.SELECT_COMMENT,$scope.selected?$scope.comment._id:null,"canvas")}function setSelectedDelayed(value){$timeout(function(){$scope.selectedDelayed=value,updateClasses()},0)}function updateIndex(){$scope.index=CommentsService.getIndex(getContentId(),$scope.comment._id)}function computePosition(){$scope.selected&&$timeout(function(){var groupSelector,commentX,commentY;if($scope.isNew())commentX=parseInt($scope.x),commentY=parseInt($scope.y),groupSelector="section.pin > #group-new-canvas";else{var id=$scope.comment._id,comment=CommentsService.commentsMap[id];commentX=comment.position.x,commentY=comment.position.y,groupSelector="section.pin > #group-"+id+"-canvas"}var group=document.querySelectorAll(groupSelector)[0],bb=group.getBoundingClientRect(),commentW=bb.width+PreviewEnums.COMMENT_FORM_DELTA_X-PreviewEnums.PIN_RADIUS,commentH=bb.height+PreviewEnums.COMMENT_FORM_DELTA_Y-PreviewEnums.PIN_RADIUS,containerW=DOMService.getContainerDimensions().width,contentW=getContentWidth(),width=contentW+(containerW>contentW?(containerW-contentW)/2:0),height=getContentHeight();$scope.isLeft=commentX+commentW<width,$scope.isTop=commentY+commentH<height,updateClasses()},0)}function updateClasses(){setClass("selected",$scope.selectedDelayed),setClass("adding-comment",$scope.isNew()),setClass("resolved",!$scope.isNew()&&$scope.comment.resolved.is),setClass("dragging",$scope.isDragging),setClass("top",$scope.isTop),setClass("bottom",!$scope.isTop),setClass("left",$scope.isLeft),setClass("right",!$scope.isLeft),setClass("hide",$scope.deleting),setClass("comment-team",$scope.isTeam()),setClass("comment-public",!$scope.isTeam())}function setClass(className,value){var index=$scope.classes.indexOf(className);value&&index===-1?$scope.classes.push(className):value||index===-1||$scope.classes.splice(index,1)}var maxWidth=0,maxHeight=0,commentTypes=[];if($scope.selected=!1,$scope.isDragging=!1,$scope.commentType=null,$scope.dragStartPos=null,$scope.dragClickPos=null,$scope.isTop=!0,$scope.isLeft=!0,$scope.deleting=!1,$scope.classes=[],$scope.toggle=toggle,$scope.hide=hide,$scope.getPreventHideElements=getPreventHideElements,$scope.open=open,$scope.isOpen=isOpen,$scope.applyVisibility=applyVisibility,$scope.startDrag=startDrag,$scope.endDrag=endDrag,$scope.getCommentPointStyle=getCommentPointStyle,$scope.isNew=isNew,$scope.isTeam=isTeam,$scope.onDblclick=onDblclick,$scope.isAnonymousMode=isAnonymousMode,activate(),$scope.isNew()){$scope.selected=!1;var onAddingComment=$rootScope.$on(PreviewEnums.ADDING_COMMENT,function(event,value){$scope.selected=value,updateClasses(),setSelectedDelayed($scope.selected),value&&(computePosition(),$scope.index=CommentsService.getIndex(getContentId()))}),onNewCommentTypeUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,function(event,id,type){$scope.commentType=type,updateClasses()});$scope.$on("$destroy",function(){onAddingComment(),onNewCommentTypeUpdate()})}else{var onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(event,id){$scope.selected&&$scope.comment._id!==id&&($scope.selected=!1,setSelectedDelayed($scope.selected)),$scope.selected||$scope.comment._id!==id||($scope.selected=!0,setSelectedDelayed($scope.selected))}),onSelected=$scope.$watch("selected",function(newValue,oldValue){!oldValue&&newValue&&computePosition()}),onDeletingComment=$rootScope.$on(PreviewEnums.DELETING_COMMENT,function(event,id,value){$scope.comment._id===id&&($scope.selected=$scope.selectedDelayed=!1,$scope.deleting=value,updateClasses())}),onResolveComment=$rootScope.$on(PreviewEnums.RESOLVE_COMMENT,function(event,id,value){$scope.comment._id===id&&updateClasses()}),onCommentTypeUpdate=$rootScope.$on(PreviewEnums.ON_COMMENT_TYPE_UPDATE,function(event,id){$scope.comment._id===id&&updateClasses()}),onDeleteComment=$rootScope.$on(PreviewEnums.DELETE_COMMENT,updateIndex),onSortComments=$rootScope.$on(PreviewEnums.SORT_COMMENTS,updateIndex);$scope.$on("$destroy",function(){onSelectComment(),onSelected(),onDeletingComment(),onResolveComment(),onCommentTypeUpdate(),onDeleteComment(),onSortComments()}),updateIndex(),computePosition(),updateClasses()}}angular.module("core").controller("PreviewPinCtrl",PreviewPinCtrl),PreviewPinCtrl.$inject=["$rootScope","$scope","$document","$timeout","CommentsService","CommentsSettings","UsersService","PagesService","DocumentsService","ProjectsService","DOMService"]}(),function(){"use strict";function previewPin(){function link(scope,element,attrs){function toggleElement(){var parent=element[0].parentNode;if(parent)return parent.querySelector(".comments-group")}scope.toggleElement=toggleElement}return{restrict:"E",replace:!0,scope:{comment:"=",x:"@",y:"@"},controller:"PreviewPinCtrl",templateUrl:"/scripts/modules/core/directives/preview-pin/preview-pin.directive.html",link:link}}angular.module("core").directive("previewPin",previewPin)}(),function(){"use strict";function pvMultiSelect(){function link(scope,el,attrs,controllers){function activate(){ngModelCtrl&&(ngModelCtrl.$render=renderer)}function renderer(){vm.selected=ngModelCtrl.$viewValue||[],vm.updateSelection()}function select(option){if(option.checked)vm.selected.push(option.email);else{var index=vm.selected.indexOf(option.email);vm.selected.splice(index,1)}ngModelCtrl&&ngModelCtrl.$setViewValue(_.clone(vm.selected))}var vm=scope.vm,ngModelCtrl=controllers[0];vm.selected=[],vm.select=select,activate()}return{restrict:"E",require:["?ngModel","?ngChange"],scope:{options:"=",scrollToBottom:"=?"},templateUrl:"/scripts/modules/core/directives/select/pvMultiSelect.html",link:link,controller:pvMultiSelectCtrl,controllerAs:"vm",transclude:!0}}function pvMultiSelectCtrl($scope){function activate(){$scope.$watch("options",function(newOptions){vm.options=newOptions,vm.filteredOptions=filterOptions(vm.searchValue),updateSelection()})}function search(){vm.filteredOptions=vm.searchValue?filterOptions(vm.searchValue):vm.options}function resetSearch(){vm.searchValue="",vm.filteredOptions=vm.options}function filterOptions(value){return _.filter(vm.options,function(option){return option.name.toLowerCase().indexOf(value.trim().toLowerCase())>-1})}function updateSelection(){_.each(vm.options,function(option){option.checked=vm.selected.indexOf(option.email)>-1})}var vm=this;vm.options=[],vm.filteredOptions=[],vm.searchValue="",vm.search=search,vm.resetSearch=resetSearch,vm.updateSelection=updateSelection,activate()}angular.module("core").directive("pvMultiSelect",pvMultiSelect),pvMultiSelectCtrl.$inject=["$scope"]}(),function(){"use strict";function pvSelect($document){function link(scope,el,attrs,controllers){function activate(){ngModelCtrl&&(ngModelCtrl.$render=renderer,ngModelCtrl.$formatters.push(formatter),ngModelCtrl.$parsers.push(parser),scope.$watch("vm.selectedOption",updateViewValue)),scope.$on("$destroy",handleDestroy)}function renderer(){vm.selectedOption=ngModelCtrl.$viewValue}function formatter(value){if(value)return _.find(scope.options,function(option){return option.value===value})||{}}function parser(newValue){return newValue.value}function updateViewValue(newOption,oldOption){newOption!==oldOption&&ngModelCtrl.$setViewValue(newOption)}function toggleDropdown(){return vm.isDropdownOpen?void closeDropdown():void openDropdown()}function openDropdown(){vm.disabled||vm.isDropdownOpen||(vm.isDropdownOpen=!0,bindDropdownEvents())}function closeDropdown(){vm.isDropdownOpen&&(vm.isDropdownOpen=!1,unbindDropdownEvents())}function handleDestroy(){unbindDropdownEvents()}function bindDropdownEvents(){$document.on("click",handleClick),$document.on("keydown",handleKeydown)}function unbindDropdownEvents(){$document.off("click",handleClick),$document.off("keydown",handleKeydown)}function handleClick(event){el[0].contains(event.target)||scope.$apply(function(){closeDropdown()})}function handleKeydown(event){var keyCode=event.keyCode;keyCode!==KEY_CODES.ENTER&&keyCode!==KEY_CODES.ESC||scope.$apply(function(){closeDropdown()})}var KEY_CODES={ESC:27,ENTER:13},vm=scope.vm,ngModelCtrl=controllers[0];vm.selectedOption={},vm.isDropdownOpen=!1,vm.toggleDropdown=toggleDropdown,vm.openDropdown=openDropdown,vm.closeDropdown=closeDropdown,activate()}return{restrict:"E",require:["?ngModel","?ngChange"],scope:{options:"=",disabled:"=?",optionTpl:"@?"},templateUrl:"/scripts/modules/core/directives/select/pvSelect.html",link:link,controller:pvSelectCtrl,controllerAs:"vm",transclude:!0}}function pvSelectCtrl($scope){function activate(){$scope.$watch("options",function(newOptions){vm.options=newOptions}),$scope.$watch("disabled",function(newValue){vm.disabled=newValue}),$scope.optionTpl&&$scope.$watch("optionTpl",function(newValue){vm.optionTpl="/scripts/modules/core/directives/select/"+newValue})}function selectOption(option){vm.selectedOption=option,vm.closeDropdown()}var vm=this;vm.options=[],vm.disabled=!1,vm.selectOption=selectOption,activate()}angular.module("core").directive("pvSelect",pvSelect),pvSelect.$inject=["$document"],pvSelectCtrl.$inject=["$scope"]}(),function(){"use strict";function pvShortcut(){return{restrict:"E",scope:{keys:"="},templateUrl:"/scripts/modules/core/directives/shortcut/pvShortcut.html",controller:pvShortcutCtrl,controllerAs:"vm"}}function pvShortcutCtrl($scope){function activate(){$scope.$watch("keys",function(newValue){vm.keys=_.map(newValue,function(value){return formatKey(value)})})}function formatKey(value){var lowerCaseValue=value.toLowerCase();return"undefined"==typeof ICON_KEYS[lowerCaseValue]?{alt:value}:_.extend({className:"only-icon-font icon-font-"+ICON_KEYS[lowerCaseValue].icon},ICON_KEYS[lowerCaseValue])}var ICON_KEYS={cmd:{icon:"cmd-key",alt:"cmd"},shift:{icon:"shift-key",alt:"shift"}},vm=this;vm.keys=[],activate()}angular.module("core").directive("pvShortcut",pvShortcut),pvShortcutCtrl.$inject=["$scope"]}(),angular.module("core").controller("UsabilityTestPluginTipController",["$q","$scope","$rootScope","localStorageService","UsabilityTestService","ChromeExtensionService",function($q,$scope,$rootScope,localStorageService,UsabilityTestService,ChromeExtensionService){"use strict";var PLUGIN_MESSAGE_KEY="pluginTipDisplayed";$scope.isTipVisible=UsabilityTestService.isHostSession();var showTipRequestDefer=$q.defer(),grantMediaAccessDefer=$q.defer();$q.all([showTipRequestDefer.promise,grantMediaAccessDefer.promise]).then(function(){showTip()}),UsabilityTestService.isHostSession()&&showTipRequestDefer.resolve();var setPluginMessageDisplayed=function(){localStorageService.set(PLUGIN_MESSAGE_KEY,1)},closeTip=function(){setPluginMessageDisplayed(),$scope.$$phase?$scope.isTipVisible=!1:$scope.$apply(function(){$scope.isTipVisible=!1})},showTip=function(){$scope.isTipVisible=!0};$scope.onClickClose=function(){closeTip()};try{ChromeExtensionService.onMessage(function(request){"startRecording"===request.action&&closeTip()})}catch(e){window.console.error(e)}UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,function(){UsabilityTestService.isHostSession()&&showTipRequestDefer.resolve()}),$rootScope.$on(PreviewEnums.MEDIA_ACCESS,function(e,value){value===PreviewEnums.MEDIA_ACCESS_TYPE.ALLOWED&&grantMediaAccessDefer.resolve()})}]),angular.module("core").directive("usabilityTestPluginTip",[function(){"use strict";return{restrict:"E",replace:!0,scope:!0,controller:"UsabilityTestPluginTipController",templateUrl:"/scripts/modules/core/directives/usabilityTestPluginTip/usabilityTestPluginTip.directive.html"}}]);
//# sourceMappingURL=maps/app.js.map
